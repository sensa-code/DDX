<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>éŒ¯èª¤å®šä½å™¨</title>
<style>
body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
.success { color: #4ec9b0; }
.error { color: #f48771; }
.info { color: #9cdcfe; }
pre { background: #2d2d2d; padding: 10px; border-radius: 5px; overflow-x: auto; }
h2 { color: #569cd6; }
</style>
</head>
<body>
<h1>ğŸ” JavaScript éŒ¯èª¤å®šä½å™¨</h1>
<div id="output"></div>

<script>
const output = document.getElementById('output');

function log(msg, className = '') {
  const div = document.createElement('div');
  div.className = className;
  div.textContent = msg;
  output.appendChild(div);
}

function logHTML(html) {
  const div = document.createElement('div');
  div.innerHTML = html;
  output.appendChild(div);
}

log('é–‹å§‹è¼‰å…¥ä¸»æª”æ¡ˆ...', 'info');

// ä½¿ç”¨ fetch è¼‰å…¥æª”æ¡ˆ
fetch('vet-differential-diagnosis-v2.html')
  .then(response => response.text())
  .then(html => {
    log('âœ… æª”æ¡ˆè¼‰å…¥æˆåŠŸ', 'success');

    // æå– script å…§å®¹
    const scriptMatch = html.match(/<script>([\s\S]*?)<\/script>/);
    if (!scriptMatch) {
      log('âŒ æ‰¾ä¸åˆ° <script> æ¨™ç±¤', 'error');
      return;
    }

    const script = scriptMatch[1];
    const lines = script.split('\n');
    log(`ğŸ“Š ç¸½å…± ${lines.length} è¡Œ JavaScript ä»£ç¢¼`, 'info');

    // å˜—è©¦åŸ·è¡Œ
    log('\nå˜—è©¦åŸ·è¡Œ JavaScript...', 'info');

    try {
      const func = new Function(script);
      log('âœ… JavaScript èªæ³•å®Œå…¨æ­£ç¢ºï¼', 'success');

      // åŸ·è¡Œçœ‹çœ‹
      try {
        func();
        log('âœ… åŸ·è¡ŒæˆåŠŸï¼', 'success');
      } catch (execError) {
        log('âš ï¸ èªæ³•æ­£ç¢ºä½†åŸ·è¡Œæ™‚å‡ºéŒ¯: ' + execError.message, 'info');
      }

    } catch (syntaxError) {
      log('âŒ ç™¼ç¾èªæ³•éŒ¯èª¤:', 'error');
      log('éŒ¯èª¤è¨Šæ¯: ' + syntaxError.message, 'error');

      // å˜—è©¦å¾éŒ¯èª¤è¨Šæ¯æå–è¡Œè™Ÿ
      const match = syntaxError.stack.match(/anonymous>:(\d+):(\d+)/);

      if (match) {
        const errorLine = parseInt(match[1]) - 1; // Function() æœƒåŠ ä¸ŠåŒ…è£
        const errorCol = parseInt(match[2]);

        log(`\nğŸ“ éŒ¯èª¤ä½ç½®: ç¬¬ ${errorLine} è¡Œ, ç¬¬ ${errorCol} åˆ—`, 'error');

        // é¡¯ç¤ºéŒ¯èª¤é™„è¿‘çš„ä»£ç¢¼
        logHTML('<h2>éŒ¯èª¤é™„è¿‘çš„ä»£ç¢¼:</h2>');
        const pre = document.createElement('pre');
        let code = '';

        for (let i = Math.max(0, errorLine - 5); i < Math.min(lines.length, errorLine + 5); i++) {
          const marker = i === errorLine ? '>>> ' : '    ';
          const lineNum = String(i + 1).padStart(5, ' ');
          code += `${marker}${lineNum}: ${lines[i]}\n`;
        }

        pre.textContent = code;
        output.appendChild(pre);

        // åˆ†æéŒ¯èª¤é¡å‹
        logHTML('<h2>éŒ¯èª¤åˆ†æ:</h2>');

        if (syntaxError.message.includes('Unexpected string')) {
          log('ğŸ” "Unexpected string" é€šå¸¸è¡¨ç¤º:', 'info');
          log('  1. ç‰©ä»¶å±¬æ€§ä¹‹é–“ç¼ºå°‘é€—è™Ÿ', 'info');
          log('  2. å¼•è™Ÿæœªæ­£ç¢ºé–‰åˆ', 'info');
          log('  3. å­—ä¸²å…§æœ‰æœªè½‰ç¾©çš„å¼•è™Ÿ', 'info');

          // æª¢æŸ¥éŒ¯èª¤è¡Œ
          const errLine = lines[errorLine];
          log(`\nå•é¡Œè¡Œ: ${errLine}`, 'info');

          if (errorLine > 0) {
            const prevLine = lines[errorLine - 1];
            log(`å‰ä¸€è¡Œ: ${prevLine}`, 'info');

            // æª¢æŸ¥å‰ä¸€è¡Œæ˜¯å¦ç¼ºå°‘é€—è™Ÿ
            if (prevLine.trim().endsWith('}') && !prevLine.trim().endsWith('},')) {
              log('âš ï¸ å¯èƒ½åŸå› : å‰ä¸€è¡Œçš„ } å¾Œé¢ç¼ºå°‘é€—è™Ÿ!', 'error');
              log(`å»ºè­°ä¿®å¾©: å°‡ç¬¬ ${errorLine} è¡Œçš„ } æ”¹ç‚º },`, 'info');
            }
          }
        }

      } else {
        log('ç„¡æ³•å¾éŒ¯èª¤è¨Šæ¯ä¸­æå–è¡Œè™Ÿ', 'error');
        log('å®Œæ•´éŒ¯èª¤å †ç–Š:', 'info');
        const pre = document.createElement('pre');
        pre.textContent = syntaxError.stack;
        output.appendChild(pre);
      }
    }
  })
  .catch(error => {
    log('âŒ è¼‰å…¥æª”æ¡ˆå¤±æ•—: ' + error.message, 'error');
    log('è«‹ç¢ºä¿æ­¤ HTML æª”æ¡ˆèˆ‡ vet-differential-diagnosis-v2.html åœ¨åŒä¸€ç›®éŒ„', 'info');
  });
</script>

</body>
</html>
