<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>小動物鑑別診斷輔助系統 v2.0</title>
<style>
  :root {
    --primary: #2c6e49;
    --primary-light: #4c956c;
    --primary-dark: #1b4332;
    --accent: #f4a261;
    --bg: #fafaf8;
    --card-bg: #ffffff;
    --text: #264653;
    --text-light: #6b7280;
    --border: #d1d5db;
    --danger: #e76f51;
    --info: #457b9d;
    --tag-dog: #3b82f6;
    --tag-cat: #f59e0b;
    --tag-both: #8b5cf6;
    --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
    --emergency: #dc2626;
    --urgent: #ea580c;
    --semi-urgent: #ca8a04;
    --non-urgent: #16a34a;
  }
  /* Dark mode */
  [data-theme="dark"] {
    --primary: #4c956c; --primary-light: #6bb88a; --primary-dark: #a7d7c5;
    --bg: #1a1a2e; --card-bg: #16213e; --text: #e0e0e0; --text-light: #9ca3af;
    --border: #374151; --info: #7db8d4; --shadow: 0 1px 3px rgba(0,0,0,0.3);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.4);
  }
  .skip-link { position: absolute; top: -40px; left: 0; background: var(--primary); color: white; padding: 0.5rem 1rem; z-index: 200; transition: top 0.2s; border-radius: 0 0 4px 0; }
  .skip-link:focus { top: 0; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
  header { background: linear-gradient(135deg, var(--primary-dark), var(--primary)); color: white; padding: 1.2rem 2rem; box-shadow: var(--shadow-lg); position: sticky; top: 0; z-index: 100; }
  [data-theme="dark"] header { background: linear-gradient(135deg, #0f3460, #16213e); }
  header h1 { font-size: 1.4rem; font-weight: 700; cursor: pointer; }
  header p { font-size: 0.82rem; opacity: 0.85; }
  .header-row { display: flex; justify-content: space-between; align-items: center; gap: 0.5rem; }
  .header-actions { display: flex; gap: 0.4rem; align-items: center; }
  .header-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); color: white; padding: 0.4rem 0.8rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; white-space: nowrap; }
  .header-btn:hover { background: rgba(255,255,255,0.3); }
  .app-container { display: flex; flex: 1; overflow: hidden; min-height: 0; }

  /* Sidebar */
  .sidebar { width: 320px; min-width: 320px; background: var(--card-bg); border-right: 1px solid var(--border); overflow-y: auto; padding: 0.5rem 0; transition: transform 0.3s ease; z-index: 90; flex-shrink: 0; min-height: 0; }
  .sidebar-section { margin-bottom: 0.25rem; }
  .sidebar-section-title { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-light); padding: 0.5rem 1.25rem; cursor: pointer; display: flex; align-items: center; gap: 0.4rem; user-select: none; border-radius: 4px; margin: 0 0.5rem; }
  .sidebar-section-title:hover { background: #f0fdf4; }
  [data-theme="dark"] .sidebar-section-title:hover { background: rgba(255,255,255,0.05); }
  .sidebar-section-title .arrow { transition: transform 0.3s ease; font-size: 0.7rem; display: inline-block; transform: rotate(0deg); }
  .sidebar-section:not(.collapsed) .sidebar-section-title .arrow { transform: rotate(90deg); }
  .sidebar-section.collapsed .sidebar-section-title .arrow { transform: rotate(0deg); }
  /* UX-12: Sidebar collapse animation */
  .sidebar-section .symptom-list-wrap { overflow: hidden; transition: max-height 0.3s ease; }
  .sidebar-section.collapsed .symptom-list-wrap { max-height: 0 !important; }
  .sidebar-section-title .count { font-size: 0.65rem; color: var(--text-light); opacity: 0.7; margin-left: auto; }
  .symptom-btn { display: block; width: 100%; text-align: left; padding: 0.5rem 1.25rem; border: none; background: transparent; cursor: pointer; font-size: 0.88rem; color: var(--text); transition: all 0.15s; border-left: 3px solid transparent; }
  .symptom-btn:hover { background: #f0fdf4; border-left-color: var(--primary-light); }
  [data-theme="dark"] .symptom-btn:hover { background: rgba(255,255,255,0.05); }
  .symptom-btn.active { background: #ecfdf5; border-left-color: var(--primary); font-weight: 600; color: var(--primary-dark); }
  [data-theme="dark"] .symptom-btn.active { background: rgba(76,149,108,0.15); }
  .symptom-btn:focus-visible { outline: 2px solid var(--primary); outline-offset: -2px; }
  .symptom-btn .en-name { font-size: 0.72rem; color: var(--text-light); display: block; }

  /* Mobile sidebar */
  .sidebar-toggle { display: none; position: fixed; top: 0.9rem; left: 1rem; z-index: 150; background: var(--primary); color: white; border: none; padding: 0.5rem 0.7rem; border-radius: 6px; font-size: 1.2rem; cursor: pointer; }
  .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 80; }
  .sidebar-overlay.active { display: block; }

  /* Main content */
  .main-content { flex: 1; padding: 1.5rem 2rem; overflow-y: auto; height: 100%; }
  .search-bar { position: sticky; top: 0; z-index: 50; margin-bottom: 0.5rem; background: var(--bg); padding-top: 0.5rem; }
  .search-bar input { width: 100%; padding: 0.7rem 2.5rem 0.7rem 2.75rem; border: 2px solid var(--border); border-radius: 10px; font-size: 0.95rem; outline: none; transition: border-color 0.2s; background: var(--card-bg); color: var(--text); }
  .search-bar input[type="search"]::-webkit-search-cancel-button { -webkit-appearance: none; display: none; }
  .search-bar input:focus { border-color: var(--primary); }
  .search-bar .search-icon { position: absolute; left: 0.9rem; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.1rem; }
  /* UX-09: Search clear button */
  .search-clear { position: absolute; right: 0.7rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-light); font-size: 1.2rem; cursor: pointer; display: none; padding: 0.2rem 0.4rem; border-radius: 50%; }
  .search-clear:hover { background: rgba(0,0,0,0.08); color: var(--text); }
  .search-clear.visible { display: block; }
  .search-hint { font-size: 0.78rem; color: var(--info); padding: 0.2rem 0 0.8rem 0.5rem; display: none; }
  .search-hint.visible { display: block; }
  /* Search results dropdown */
  .search-results { background: var(--card-bg); border: 2px solid var(--primary); border-top: none; border-radius: 0 0 10px 10px; max-height: 300px; overflow-y: auto; display: none; margin-top: -0.3rem; margin-bottom: 0.5rem; box-shadow: var(--shadow-lg); }
  .search-results.visible { display: block; }
  .search-result-item { padding: 0.5rem 1rem; cursor: pointer; font-size: 0.88rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .search-result-item:hover, .search-result-item.focused { background: #f0fdf4; }
  [data-theme="dark"] .search-result-item:hover, [data-theme="dark"] .search-result-item.focused { background: rgba(255,255,255,0.05); }
  .search-result-item .sr-en { font-size: 0.72rem; color: var(--text-light); }
  .search-result-item .sr-count { font-size: 0.68rem; color: var(--info); }

  /* Filter bar */
  .filter-bar { display: flex; gap: 0.4rem; margin-bottom: 1rem; flex-wrap: wrap; align-items: center; }
  .filter-bar label { font-size: 0.82rem; font-weight: 600; color: var(--text-light); margin-right: 0.15rem; }
  .filter-chip { padding: 0.3rem 0.75rem; border-radius: 20px; border: 1.5px solid var(--border); background: var(--card-bg); cursor: pointer; font-size: 0.78rem; transition: all 0.15s; font-weight: 500; color: var(--text); }
  .filter-chip:hover { border-color: var(--primary-light); }
  .filter-chip:focus-visible { outline: 2px solid var(--primary); outline-offset: 1px; }
  .filter-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
  .filter-chip.active-dog { background: var(--tag-dog); color: white; border-color: var(--tag-dog); }
  .filter-chip.active-cat { background: var(--tag-cat); color: white; border-color: var(--tag-cat); }
  .filter-divider { width: 1px; height: 1.5rem; background: var(--border); margin: 0 0.3rem; }
  /* Sort toggle */
  .sort-toggle { margin-left: auto; display: flex; gap: 0.25rem; }
  .sort-btn { padding: 0.2rem 0.55rem; border-radius: 4px; border: 1px solid var(--border); background: var(--card-bg); cursor: pointer; font-size: 0.72rem; color: var(--text-light); transition: all 0.15s; }
  .sort-btn.active { background: var(--info); color: white; border-color: var(--info); }

  /* Tabs */
  .tab-bar { display: flex; gap: 0; margin-bottom: 1.2rem; border-bottom: 2px solid var(--border); position: sticky; top: 52px; z-index: 49; background: var(--bg); }
  .tab-btn { padding: 0.55rem 1rem; border: none; background: transparent; cursor: pointer; font-size: 0.85rem; font-weight: 500; color: var(--text-light); border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.15s; }
  .tab-btn:hover { color: var(--primary); }
  .tab-btn:focus-visible { outline: 2px solid var(--primary); outline-offset: -2px; }
  .tab-btn.active { color: var(--primary-dark); border-bottom-color: var(--primary); font-weight: 700; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* Welcome */
  .welcome { text-align: center; padding: 2rem; color: var(--text-light); }
  .welcome .icon { font-size: 3rem; margin-bottom: 0.5rem; }
  .welcome h2 { font-size: 1.3rem; color: var(--text); margin-bottom: 0.3rem; }
  .welcome p { max-width: 500px; margin: 0 auto 1.2rem; font-size: 0.88rem; }
  .welcome-stats { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
  .welcome-stat { text-align: center; }
  .welcome-stat .num { font-size: 1.6rem; font-weight: 700; color: var(--primary-dark); display: block; }
  .welcome-stat .label { font-size: 0.75rem; color: var(--text-light); }
  .quick-start { text-align: left; max-width: 600px; margin: 0 auto; }
  .quick-start h3 { font-size: 0.9rem; color: var(--text); margin-bottom: 0.5rem; }
  .quick-links { display: flex; flex-wrap: wrap; gap: 0.4rem; }
  .quick-link { padding: 0.35rem 0.75rem; border-radius: 20px; border: 1.5px solid var(--border); background: var(--card-bg); cursor: pointer; font-size: 0.82rem; transition: all 0.15s; color: var(--text); }
  .quick-link:hover { border-color: var(--primary); background: #f0fdf4; }
  .quick-link.emergency { border-color: var(--emergency); color: var(--emergency); }
  .quick-link.emergency:hover { background: #fef2f2; }

  /* Symptom detail */
  .symptom-header { margin-bottom: 1.2rem; }
  .symptom-header h2 { font-size: 1.5rem; color: var(--primary-dark); margin-bottom: 0.1rem; }
  .symptom-header .en { font-size: 0.95rem; color: var(--text-light); font-style: italic; margin-bottom: 0.6rem; }
  .symptom-header .description { font-size: 0.9rem; color: var(--text); background: #f0fdf4; border-left: 4px solid var(--primary); padding: 0.65rem 1rem; border-radius: 0 6px 6px 0; }
  [data-theme="dark"] .symptom-header .description { background: rgba(76,149,108,0.1); }

  /* Related symptoms bar */
  .related-bar { background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 0.6rem 1rem; margin-bottom: 1rem; font-size: 0.82rem; }
  [data-theme="dark"] .related-bar { background: rgba(69,123,157,0.15); border-color: rgba(69,123,157,0.3); }
  .related-bar strong { color: var(--info); }
  .related-bar a { color: var(--primary); cursor: pointer; text-decoration: underline; margin: 0 0.15rem; }
  .related-bar a:hover { color: var(--primary-dark); }
  .related-bar a:focus-visible { outline: 2px solid var(--primary); outline-offset: 1px; }

  /* Stats */
  .stats-bar { display: flex; gap: 0.8rem; margin-bottom: 0.8rem; font-size: 0.78rem; color: var(--text-light); flex-wrap: wrap; align-items: center; }
  .stat-item { display: flex; align-items: center; gap: 0.25rem; }
  .stat-emergency { color: var(--emergency); font-weight: 600; }
  .expand-all-btn { margin-left: auto; padding: 0.15rem 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--card-bg); cursor: pointer; font-size: 0.72rem; color: var(--text-light); }
  .expand-all-btn:hover { border-color: var(--primary); color: var(--primary); }

  /* Category groups */
  .category-group { margin-bottom: 1.2rem; animation: fadeIn 0.2s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
  .category-title { font-size: 1rem; font-weight: 700; color: var(--primary-dark); margin-bottom: 0.6rem; padding-bottom: 0.3rem; border-bottom: 2px solid var(--primary-light); display: flex; align-items: center; gap: 0.4rem; }

  /* Dx cards */
  .dx-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.4rem; box-shadow: var(--shadow); cursor: pointer; transition: box-shadow 0.15s, border-color 0.15s; }
  .dx-card:hover { box-shadow: var(--shadow-lg); border-color: var(--primary-light); }
  .dx-card:focus-visible { outline: 2px solid var(--primary); outline-offset: 1px; }
  .dx-card.expanded { border-color: var(--primary); background: #fefffe; }
  [data-theme="dark"] .dx-card.expanded { background: rgba(76,149,108,0.05); }
  .dx-card.freq-common { border-left: 3px solid var(--danger); }
  .dx-card.freq-uncommon { border-left: 3px solid var(--accent); }
  .dx-card.freq-rare { border-left: 3px solid #d1d5db; opacity: 0.85; }
  .dx-card.has-urgency-emergency { border-left: 4px solid var(--emergency); background: rgba(220,38,38,0.04); }
  .dx-card.has-urgency-urgent { border-left: 4px solid var(--urgent); background: rgba(234,88,12,0.03); }
  [data-theme="dark"] .dx-card.has-urgency-emergency { background: rgba(220,38,38,0.08); }
  [data-theme="dark"] .dx-card.has-urgency-urgent { background: rgba(234,88,12,0.06); }
  .dx-card-header { display: flex; justify-content: space-between; align-items: flex-start; }
  .dx-name { font-weight: 600; font-size: 0.92rem; }
  .dx-name-en { font-size: 0.78rem; color: var(--text-light); font-style: italic; }
  .dx-tags { display: flex; gap: 0.25rem; flex-shrink: 0; margin-left: 0.5rem; flex-wrap: wrap; justify-content: flex-end; }
  .tag { font-size: 0.62rem; padding: 0.12rem 0.4rem; border-radius: 4px; font-weight: 700; text-transform: uppercase; white-space: nowrap; }
  .tag-dog { background: #dbeafe; color: var(--tag-dog); }
  .tag-cat { background: #fef3c7; color: #b45309; }
  .tag-common { background: #fef2f2; color: var(--danger); }
  .tag-uncommon { background: #fff7ed; color: var(--accent); }
  .tag-rare { background: #f3f4f6; color: #6b7280; }
  [data-theme="dark"] .tag-dog { background: rgba(59,130,246,0.2); color: #93bbfd; }
  [data-theme="dark"] .tag-cat { background: rgba(245,158,11,0.2); color: #fbbf24; }
  [data-theme="dark"] .tag-common { background: rgba(231,111,81,0.2); color: #f87171; }
  [data-theme="dark"] .tag-uncommon { background: rgba(244,162,97,0.2); color: #fbbf24; }
  [data-theme="dark"] .tag-rare { background: rgba(107,114,128,0.2); color: #9ca3af; }

  /* Urgency badges */
  .urgency-badge { font-size: 0.6rem; padding: 0.15rem 0.5rem; border-radius: 10px; font-weight: 700; color: white; white-space: nowrap; }
  .urgency-emergency { background: var(--emergency); animation: pulse 2s infinite; }
  .urgency-urgent { background: var(--urgent); }
  .urgency-semi-urgent { background: var(--semi-urgent); color: #1a1a1a; }
  .urgency-non-urgent { background: var(--non-urgent); }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }

  /* UX-04: Dx detail with animation */
  .dx-detail { max-height: 0; overflow: hidden; transition: max-height 0.35s ease, padding-top 0.35s ease, margin-top 0.35s ease; font-size: 0.85rem; line-height: 1.7; padding-top: 0; margin-top: 0; }
  .dx-card.expanded .dx-detail { max-height: 800px; padding-top: 0.65rem; margin-top: 0.65rem; border-top: 1px solid #e5e7eb; }
  .dx-detail-section { margin-bottom: 0.5rem; }
  .dx-detail-section strong { color: var(--primary-dark); font-size: 0.8rem; display: block; margin-bottom: 0.15rem; }
  .dx-detail-section ul { margin-left: 1.2rem; }
  .dx-detail-section li { margin-bottom: 0.1rem; }
  .workup-tier { margin-bottom: 0.3rem; }
  .workup-tier-label { font-size: 0.72rem; font-weight: 700; padding: 0.1rem 0.4rem; border-radius: 3px; display: inline-block; margin-bottom: 0.2rem; }
  .tier1-label { background: #dcfce7; color: #166534; }
  .tier2-label { background: #dbeafe; color: #1e40af; }
  .dx-expand-icon { font-size: 0.7rem; color: var(--text-light); transition: transform 0.3s; margin-left: 0.3rem; }
  .dx-card.expanded .dx-expand-icon { transform: rotate(180deg); }

  /* Multi-symptom panel */
  .multi-symptom-panel { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 1.1rem; margin-bottom: 1.2rem; box-shadow: var(--shadow); }
  .multi-symptom-panel h3 { font-size: 0.95rem; margin-bottom: 0.6rem; color: var(--primary-dark); }
  .selected-symptoms { display: flex; flex-wrap: wrap; gap: 0.35rem; min-height: 1.8rem; margin-bottom: 0.6rem; align-items: center; }
  .selected-tag { background: var(--primary); color: white; padding: 0.25rem 0.6rem; border-radius: 15px; font-size: 0.78rem; display: flex; align-items: center; gap: 0.25rem; }
  .selected-tag .remove { cursor: pointer; font-weight: bold; opacity: 0.8; }
  .selected-tag .remove:hover { opacity: 1; }
  .clear-all-btn { background: var(--danger); color: white; border: none; padding: 0.25rem 0.6rem; border-radius: 15px; font-size: 0.72rem; cursor: pointer; font-weight: 600; }
  .clear-all-btn:hover { opacity: 0.85; }
  .multi-search { margin-bottom: 0.5rem; }
  .multi-search input { width: 100%; padding: 0.4rem 0.7rem; border: 1.5px solid var(--border); border-radius: 6px; font-size: 0.82rem; background: var(--card-bg); color: var(--text); outline: none; }
  .multi-search input:focus { border-color: var(--primary); }
  .multi-results { margin-top: 0.8rem; }
  .multi-results h4 { font-size: 0.9rem; color: var(--primary-dark); margin-bottom: 0.4rem; }
  .match-score { display: inline-block; background: var(--accent); color: white; padding: 0.08rem 0.45rem; border-radius: 10px; font-size: 0.7rem; font-weight: 700; margin-left: 0.3rem; }
  .match-bar { display: inline-block; height: 6px; border-radius: 3px; background: var(--primary); margin-left: 0.4rem; vertical-align: middle; }

  /* Lab buttons grouped */
  .lab-group-title { font-size: 0.75rem; font-weight: 700; color: var(--text-light); margin: 0.5rem 0 0.25rem 0; }

  /* Disclaimer */
  .disclaimer { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 0.65rem 1rem; font-size: 0.78rem; color: #92400e; margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: flex-start; gap: 0.5rem; }
  .disclaimer.hidden { display: none; }
  .disclaimer-dismiss { background: none; border: 1px solid #92400e; color: #92400e; padding: 0.2rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.72rem; white-space: nowrap; flex-shrink: 0; }
  .disclaimer-dismiss:hover { background: rgba(146,64,14,0.1); }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar-toggle { display: block; }
    header { padding-left: 3.5rem; }
    .app-container { flex-direction: column; }
    .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 85vw; max-width: 320px; transform: translateX(-100%); z-index: 90; box-shadow: var(--shadow-lg); }
    .sidebar.open { transform: translateX(0); }
    .main-content { padding: 1rem; }
    .header-actions { flex-wrap: wrap; }
  }
  /* UX-07: Print only current tab */
  @media print {
    header { position: static; }
    .sidebar, .sidebar-toggle, .search-bar, .search-hint, .search-results, .filter-bar, .tab-bar, .related-bar, .header-actions, .sort-toggle, .expand-all-btn { display: none !important; }
    .dx-card { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
    .dx-card .dx-detail { max-height: none !important; padding-top: 0.65rem !important; margin-top: 0.65rem !important; border-top: 1px solid #ccc !important; overflow: visible !important; }
    .tab-content.active { display: block !important; }
    .tab-content:not(.active) { display: none !important; }
    .disclaimer { display: block !important; }
    .disclaimer-dismiss { display: none !important; }
    body::after { content: "列印日期: " attr(data-print-date); display: block; text-align: right; font-size: 0.7rem; color: #999; margin-top: 1rem; }
  }
</style>
</head>
<body>
<a href="#main-content" class="skip-link">跳至主要內容</a>
<header role="banner">
  <div class="header-row">
    <div>
      <h1 onclick="state.activeSymptom=null;document.title='小動物鑑別診斷輔助系統 v2.0';renderWelcome();updateHash();document.querySelector('.main-content').scrollTop=0;" title="回到首頁">&#x1F3E5; 小動物鑑別診斷輔助系統</h1>
      <p>Differential Diagnosis in Small Animal Medicine &mdash; 臨床症狀導向查詢工具 v2.0</p>
    </div>
    <div class="header-actions">
      <button class="header-btn" id="themeToggle" title="切換深色/淺色模式" aria-label="切換深色或淺色模式">&#x1F319; 深色模式</button>
      <button class="header-btn" id="exportBtn" title="匯出目前資料為 JSON" aria-label="匯出資料為 JSON">&#x1F4E5; 匯出</button>
      <button class="header-btn" id="printBtn" title="列印目前頁面內容" aria-label="列印目前頁面">&#x1F5A8; 列印</button>
    </div>
  </div>
</header>
<button class="sidebar-toggle" id="sidebarToggle" aria-label="開啟側欄選單">&#x2630;</button>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div class="app-container">
  <nav class="sidebar" id="sidebar" role="navigation" aria-label="症狀導航"></nav>
  <main class="main-content" id="main-content" role="main">
    <div class="search-bar" role="search">
      <span class="search-icon">&#x1F50D;</span>
      <input type="search" id="globalSearch" placeholder="搜尋症狀或疾病（支援俗語：拉肚子、頭歪、肚子痛…）按 / 快速搜尋" autocomplete="off" autofocus aria-label="搜尋症狀或疾病" />
      <button class="search-clear" id="searchClear" aria-label="清除搜尋">&times;</button>
    </div>
    <div class="search-hint" id="searchHint"></div>
    <div class="search-results" id="searchResults" role="listbox" aria-label="搜尋結果"></div>
    <div class="tab-bar" role="tablist" aria-label="查詢模式">
      <button class="tab-btn active" data-tab="single" role="tab" aria-selected="true" aria-controls="tab-single">單一症狀查詢</button>
      <button class="tab-btn" data-tab="multi" role="tab" aria-selected="false" aria-controls="tab-multi">多症狀交叉比對</button>
      <button class="tab-btn" data-tab="lab" role="tab" aria-selected="false" aria-controls="tab-lab">&#x1F9EA; 實驗室數據查詢</button>
    </div>
    <div class="tab-content active" id="tab-single" role="tabpanel">
      <div id="welcome" class="welcome"></div>
      <div id="symptomDetail" style="display:none;"></div>
    </div>
    <div class="tab-content" id="tab-multi" role="tabpanel">
      <div class="multi-symptom-panel">
        <h3>&#x1F4CB; 選擇觀察到的臨床症狀（可複選）</h3>
        <div class="selected-symptoms" id="selectedSymptoms"><span style="color:var(--text-light);font-size:0.85rem;">點擊左側症狀或下方按鈕加入...</span></div>
        <div class="multi-search"><input type="text" id="multiSymptomSearch" placeholder="篩選症狀..." aria-label="篩選多症狀列表" /></div>
        <div id="multiSymptomButtons" style="display:flex;flex-wrap:wrap;gap:0.35rem;"></div>
      </div>
      <div class="multi-results" id="multiResults"></div>
    </div>
    <div class="tab-content" id="tab-lab" role="tabpanel">
      <div class="multi-symptom-panel">
        <h3>&#x1F9EA; 選擇異常的實驗室檢查結果</h3>
        <p style="font-size:0.82rem;color:var(--text-light);margin-bottom:0.6rem;">選擇血檢/尿檢異常項目，系統將反向列出可能疾病。可複選進行交叉比對。</p>
        <div class="selected-symptoms" id="selectedLabs"><span style="color:var(--text-light);font-size:0.85rem;">點擊下方檢驗項目加入...</span></div>
        <div id="labButtons"></div>
      </div>
      <div class="multi-results" id="labResults"></div>
    </div>
    <div class="disclaimer" id="disclaimer">
      <div><strong>&#x26A0;&#xFE0F; 免責聲明：</strong>本系統僅為輔助參考工具，不應單獨作為診斷依據。資料參考：Gough &amp; Murphy (2015) 2nd Ed; Thompson (2024) 4th Ed.</div>
      <button class="disclaimer-dismiss" id="disclaimerDismiss" title="本次使用期間不再顯示">我瞭解，不再顯示</button>
    </div>
  </main>
</div>
<script>
// ======= SEARCH SYNONYMS =======
const SYNONYMS = {
  "拉肚子":"腹瀉","軟便":"腹瀉","吐":"嘔吐","嘔":"嘔吐","喝很多水":"多尿/多渴","尿很多":"多尿/多渴",
  "頭歪一邊":"頭歪斜","頭歪":"頭歪斜","一直轉圈":"共濟失調","抓癢":"搔癢","一直舔":"搔癢","皮膚癢":"搔癢",
  "腳痛":"跛行","走路怪怪的":"跛行","肚子脹大":"腹部膨大","眼睛白白的":"失明","抽筋":"癲癇發作","倒地":"昏厥",
  "沒精神":"虛弱","懶懶的":"虛弱","不吃東西":"厭食","不吃":"厭食","肚子痛":"急性腹痛","腹痛":"急性腹痛",
  "abdominal pain":"急性腹痛","head tilt":"頭歪斜","pallor":"蒼白","petechiae":"瘀斑","nystagmus":"眼球震顫",
  "stridor":"喘鳴","halitosis":"口臭","edema":"水腫","oedema":"水腫","otitis":"外耳炎","ear infection":"外耳炎",
  "嘔血":"吐血","拉血":"血便","尿血":"血尿","流鼻血":"鼻出血","打噴嚏":"噴嚏","咳":"咳嗽","喘":"呼吸困難",
  "掉毛":"脫毛","眼睛紅":"紅眼","一直喝水":"多尿/多渴","吃很多":"多食","變瘦":"體重減輕","變胖":"體重增加",
  "抽搐":"癲癇發作","口水":"流涎","發燒":"體溫過高","口臭":"口臭","心跳快":"心搏過速","心跳慢":"心搏過緩",
  "耳朵癢":"外耳炎","耳朵臭":"外耳炎","腫塊":"皮膚腫塊","長東西":"皮膚腫塊","臉歪":"顏面神經麻痺",
  "尿不出來":"少尿","沒有尿":"少尿","瘦":"體重減輕","消瘦":"肌肉萎縮",
  "CKD":"多尿/多渴","IMHA":"蒼白/發紺","DKA":"嘔吐","GDV":"腹部膨大","PSS":"癲癇發作",
  "FIP":"腹水","FeLV":"體重減輕","FIV":"體重減輕","IVDD":"輕癱/癱瘓","BOAS":"喘鳴",
  "PU/PD":"多尿/多渴","PUPD":"多尿/多渴","HBC":"跛行","RTA":"跛行",
  "DCM":"昏厥","HCM":"心雜音","AKI":"少尿","IMTP":"瘀斑","DIC":"瘀斑",
  "FLUTD":"頻尿","FCE":"輕癱/癱瘓",
  "多喝":"多尿/多渴","喝水多":"多尿/多渴","發育不良":"生長遲滯","長不大":"生長遲滯","耳朵":"外耳炎",
  "GI":"嘔吐","CNS":"癲癇發作","URT":"喘鳴/吸氣音異常","MCT":"皮膚腫塊","OCD":"跛行",
  "UTI":"頻尿/排尿困難","CHF":"呼吸困難","CPV":"嘔吐","HGE":"腹瀉","AHDS":"腹瀉",
  "AD":"搔癢（皮膚）","atopy":"搔癢（皮膚）","Demodex":"搔癢（皮膚）"
};

// ======= RELATED SYMPTOMS =======
const RELATED_SYMPTOMS = {
  "vomiting":["diarrhoea","anorexia","abdominal-pain","weight-loss","melaena"],
  "diarrhoea":["vomiting","weight-loss","haematochezia","anorexia"],
  "polyuria-polydipsia":["weight-loss","polyphagia","weakness"],
  "dyspnoea":["coughing","exercise-intolerance","syncope","pallor-cyanosis"],
  "seizures":["ataxia","coma-stupor","blindness","trembling","weakness"],
  "anorexia":["vomiting","weight-loss","weakness","hyperthermia","jaundice"],
  "weakness":["syncope","exercise-intolerance","anorexia","pallor-cyanosis"],
  "jaundice":["anorexia","vomiting","abdominal-distension"],
  "abdominal-pain":["vomiting","anorexia","abdominal-distension","hyperthermia"],
  "head-tilt":["nystagmus","ataxia","vomiting","horner-syndrome"],
  "pallor-cyanosis":["weakness","syncope","exercise-intolerance","dyspnoea"],
  "skin-pruritus":["alopecia","otitis-externa"],
  "coughing":["dyspnoea","exercise-intolerance","syncope"],
  "lameness":["polyarthritis","weakness"],
  "haematuria":["pollakiuria","abdominal-pain"],
  "ataxia":["head-tilt","nystagmus","paresis-paralysis","seizures"],
  "lymphadenopathy":["weight-loss","hyperthermia","anorexia"],
  "nystagmus":["head-tilt","ataxia","vomiting"],
  "petechiae-ecchymoses":["pallor-cyanosis","epistaxis","haematuria"],
  "tachycardia-bradycardia":["syncope","weakness","dyspnoea"],
  "oliguria-anuria":["abdominal-pain","vomiting","weakness"],
  "otitis-externa":["skin-pruritus","head-tilt","alopecia"],
  "stertor-stridor":["dyspnoea","coughing"],
  "halitosis-stomatitis":["ptyalism","anorexia","weight-loss"],
  "peripheral-oedema":["ascites","weakness","cachexia-muscle-wasting"],
  "horner-syndrome":["head-tilt","facial-nerve-paralysis","nystagmus"],
  "cutaneous-masses":["lymphadenopathy","weight-loss"],
  "facial-nerve-paralysis":["head-tilt","horner-syndrome","otitis-externa"],
  "cachexia-muscle-wasting":["weight-loss","weakness","anorexia"],
  "sneezing":["epistaxis","coughing","dyspnoea"],
  "epistaxis":["sneezing","petechiae-ecchymoses","pallor-cyanosis"],
  "regurgitation":["vomiting","dysphagia","coughing"],
  "ptyalism":["dysphagia","vomiting","seizures"],
  "haematemesis":["melaena","vomiting","pallor-cyanosis"],
  "melaena":["haematemesis","vomiting","pallor-cyanosis","weakness"],
  "constipation":["faecal-tenesmus","abdominal-pain"],
  "alopecia":["skin-pruritus","otitis-externa"],
  "heart-murmur":["exercise-intolerance","syncope","coughing","dyspnoea"],
  "ascites":["abdominal-distension","dyspnoea","weakness","peripheral-oedema"],
  "blindness":["seizures","ataxia","red-eye"],
  "exercise-intolerance":["coughing","dyspnoea","weakness","syncope"],
  "pollakiuria":["haematuria","abdominal-pain","urinary-incontinence"],
  "polyarthritis":["lameness","hyperthermia","weakness"]
};

// ======= LAB DB =======
const LAB_DB = { abnormalities: [
  { id:"anaemia-regenerative", zhName:"再生性貧血", enName:"Regenerative Anaemia", category:"血液學",
    differentials:[
      {zh:"免疫介導性溶血性貧血",en:"IMHA",species:"both",freq:"common",category:"免疫",urgency:"emergency",detail:"Coombs 陽性，球形紅血球，自凝現象。",workup:["CBC＋血抹片","Coombs 試驗","網狀紅血球計數","膽紅素"]},
      {zh:"急性出血",en:"Acute haemorrhage",species:"both",freq:"common",category:"多系統",urgency:"emergency",detail:"外傷、脾臟腫瘤破裂、凝血障礙。",workup:["PT/aPTT","腹部超音波","FAST scan"]},
      {zh:"血液寄生蟲",en:"Tick-borne disease (Haemoparasites)",species:"both",freq:"uncommon",category:"感染",urgency:"urgent",detail:"Babesia（犬）、M. haemofelis（貓）。",workup:["血液抹片","PCR"]},
      {zh:"洋蔥/大蒜中毒",en:"Allium toxicosis",species:"both",freq:"uncommon",category:"中毒",urgency:"urgent",detail:"Heinz body 溶血性貧血。",workup:["血抹片","暴露史"]}
    ]},
  { id:"anaemia-non-regenerative", zhName:"非再生性貧血", enName:"Non-regenerative Anaemia", category:"血液學",
    differentials:[
      {zh:"慢性腎臟病",en:"Chronic kidney disease (CKD)",species:"both",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"EPO 分泌不足。",workup:["BUN/Cre/SDMA","尿比重"]},
      {zh:"慢性發炎/感染",en:"Anaemia of chronic disease",species:"both",freq:"common",category:"多系統",urgency:"non-urgent",detail:"鐵利用障礙。",workup:["鐵蛋白","原發病檢查"]},
      {zh:"骨髓疾病",en:"Bone marrow disease",species:"both",freq:"uncommon",category:"血液",urgency:"urgent",detail:"再生不良性貧血、骨髓纖維化、白血病。",workup:["骨髓抽吸/切片"]},
      {zh:"FeLV",en:"FeLV infection",species:"cat",freq:"common",category:"感染",urgency:"semi-urgent",detail:"骨髓抑制。",workup:["FeLV 抗原檢測"]}
    ]},
  { id:"thrombocytopenia", zhName:"血小板減少", enName:"Thrombocytopenia", category:"血液學",
    differentials:[
      {zh:"免疫介導性血小板減少",en:"IMTP",species:"both",freq:"common",category:"免疫",urgency:"urgent",detail:"犬最常見後天性血小板減少原因。",workup:["CBC","血抹片","骨髓"]},
      {zh:"壁蝨傳染病",en:"Tick-borne disease (Haemoparasites)",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"Ehrlichia、Anaplasma。",workup:["4Dx SNAP","PCR"]},
      {zh:"DIC",en:"DIC",species:"both",freq:"uncommon",category:"多系統",urgency:"emergency",detail:"消耗性凝血病變。",workup:["PT/aPTT","D-dimer","血抹片"]}
    ]},
  { id:"elevated-alt-alp", zhName:"肝指數升高(ALT/ALP)", enName:"Elevated Hepatic Enzymes", category:"生化",
    differentials:[
      {zh:"藥物/毒素",en:"Drug/Toxin-induced",species:"both",freq:"common",category:"中毒",urgency:"semi-urgent",detail:"苯巴比妥、類固醇（犬ALP顯著升高）、NSAIDs。",workup:["用藥史","停藥後追蹤"]},
      {zh:"肝炎",en:"Hepatitis / Cholangiohepatitis",species:"both",freq:"common",category:"肝膽",urgency:"semi-urgent",detail:"急慢性肝炎。犬：銅蓄積性。貓：膽管炎。",workup:["膽汁酸","超音波","肝臟切片"]},
      {zh:"庫欣氏症",en:"Hyperadrenocorticism (Cushing's)",species:"dog",freq:"common",category:"內分泌",urgency:"non-urgent",detail:"ALP顯著升高。",workup:["LDDS","ACTH 刺激"]},
      {zh:"肝脂肪沉積",en:"Hepatic lipidosis",species:"cat",freq:"common",category:"肝膽",urgency:"urgent",detail:"貓特有。厭食後脂肪堆積。",workup:["超音波","肝臟細胞學"]},
      {zh:"膽道疾病",en:"Biliary disease",species:"both",freq:"common",category:"肝膽",urgency:"semi-urgent",detail:"膽管炎、膽結石。",workup:["超音波","膽紅素"]},
      {zh:"鉤端螺旋體",en:"Leptospirosis",species:"dog",freq:"uncommon",category:"感染",urgency:"urgent",detail:"同時侵犯肝腎。ALT/ALP+BUN/Cre同步升高是重要線索。",workup:["Leptospira PCR","MAT效價"]}
    ]},
  { id:"azotaemia", zhName:"腎指數升高(BUN/Cre)", enName:"Azotaemia", category:"生化",
    differentials:[
      {zh:"腎前性（脫水）",en:"Pre-renal",species:"both",freq:"common",category:"代謝",urgency:"semi-urgent",detail:"脫水導致腎灌流不足。",workup:["尿比重","補液反應"]},
      {zh:"慢性腎臟病",en:"Chronic kidney disease (CKD)",species:"both",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"腎臟結構損傷。",workup:["尿比重","UPC","SDMA","腎臟超音波"]},
      {zh:"急性腎損傷",en:"Acute kidney injury (AKI)",species:"both",freq:"common",category:"腎臟",urgency:"emergency",detail:"毒素、感染、缺血。",workup:["尿量監測","電解質","超音波"]},
      {zh:"腎後性（阻塞）",en:"Post-renal",species:"both",freq:"common",category:"泌尿",urgency:"emergency",detail:"尿道阻塞、膀胱破裂。",workup:["理學檢查","X光","電解質"]},
      {zh:"鉤端螺旋體",en:"Leptospirosis",species:"dog",freq:"uncommon",category:"感染",urgency:"urgent",detail:"人畜共通。同時侵犯肝腎，導致急性腎損傷+肝炎。",workup:["Leptospira PCR","MAT效價","CBC","肝指數"]},
      {zh:"腎臟淋巴瘤",en:"Renal lymphoma",species:"cat",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"貓最常見腎臟腫瘤。雙側腎臟腫大、腎功能惡化。",workup:["腎臟超音波","細針抽吸細胞學","尿液細胞學"]}
    ]},
  { id:"hyperglycaemia", zhName:"高血糖", enName:"Hyperglycaemia", category:"生化",
    differentials:[
      {zh:"糖尿病",en:"Diabetes mellitus",species:"both",freq:"common",category:"內分泌",urgency:"semi-urgent",detail:"持續性高血糖伴糖尿。",workup:["果糖胺","尿液分析"]},
      {zh:"壓力性高血糖",en:"Stress hyperglycaemia",species:"cat",freq:"common",category:"生理",urgency:"non-urgent",detail:"貓極度常見。",workup:["果糖胺（正常）"]},
      {zh:"庫欣氏症",en:"Hyperadrenocorticism (Cushing's)",species:"dog",freq:"common",category:"內分泌",urgency:"non-urgent",detail:"皮質醇拮抗胰島素。",workup:["LDDS","ACTH"]}
    ]},
  { id:"hypoglycaemia", zhName:"低血糖", enName:"Hypoglycaemia", category:"生化",
    differentials:[
      {zh:"胰島素瘤",en:"Insulinoma",species:"dog",freq:"common",category:"腫瘤",urgency:"urgent",detail:"低血糖伴不適當高胰島素。",workup:["血糖/胰島素同步","腹部超音波"]},
      {zh:"敗血症",en:"Sepsis",species:"both",freq:"common",category:"感染",urgency:"emergency",detail:"葡萄糖消耗增加。",workup:["CBC","血液培養","乳酸"]},
      {zh:"肝功能衰竭",en:"Hepatic failure",species:"both",freq:"uncommon",category:"肝膽",urgency:"urgent",detail:"肝醣儲存不足。",workup:["肝指數","膽汁酸"]},
      {zh:"幼犬低血糖",en:"Juvenile hypoglycaemia",species:"dog",freq:"common",category:"代謝",urgency:"urgent",detail:"肝醣儲備不足。",workup:["年齡評估","餵食頻率"]}
    ]},
  { id:"hyperkalaemia", zhName:"高血鉀", enName:"Hyperkalaemia", category:"電解質",
    differentials:[
      {zh:"尿道阻塞",en:"Urethral obstruction",species:"both",freq:"common",category:"泌尿",urgency:"emergency",detail:"公貓急診。心律不整危險。",workup:["理學檢查","ECG","電解質"]},
      {zh:"愛迪生氏症",en:"Hypoadrenocorticism (Addison's)",species:"dog",freq:"common",category:"內分泌",urgency:"urgent",detail:"醛固酮缺乏。Na/K<27。",workup:["Na/K比值","ACTH刺激"]},
      {zh:"急性腎衰竭",en:"Acute kidney injury (AKI)",species:"both",freq:"common",category:"腎臟",urgency:"emergency",detail:"少尿/無尿期。",workup:["BUN/Cre","尿量"]}
    ]},
  { id:"hypokalaemia", zhName:"低血鉀", enName:"Hypokalaemia", category:"電解質",
    differentials:[
      {zh:"嘔吐/腹瀉",en:"GI losses",species:"both",freq:"common",category:"消化",urgency:"semi-urgent",detail:"消化道流失鉀。",workup:["電解質監測"]},
      {zh:"慢性腎臟病",en:"Chronic kidney disease (CKD)",species:"cat",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"貓CKD常伴低血鉀。頸部腹屈。",workup:["BUN/Cre","尿比重"]},
      {zh:"利尿劑使用",en:"Diuretic therapy",species:"both",freq:"common",category:"醫源性",urgency:"non-urgent",detail:"Furosemide 等。",workup:["用藥史"]}
    ]},
  { id:"hypercalcaemia", zhName:"高血鈣", enName:"Hypercalcaemia", category:"電解質",
    differentials:[
      {zh:"淋巴瘤",en:"Lymphoma",species:"both",freq:"common",category:"腫瘤",urgency:"urgent",detail:"腫瘤相關高血鈣最常見原因。",workup:["淋巴結細胞學","PTHrP"]},
      {zh:"原發性副甲狀腺亢進",en:"Primary hyperparathyroidism",species:"dog",freq:"uncommon",category:"內分泌",urgency:"semi-urgent",detail:"PTH不適當升高。",workup:["離子鈣","PTH","頸部超音波"]},
      {zh:"維生素D中毒",en:"Vitamin D toxicosis",species:"both",freq:"uncommon",category:"中毒",urgency:"emergency",detail:"鼠藥（cholecalciferol）。",workup:["暴露史"]}
    ]},
  { id:"hypoalbuminaemia", zhName:"低白蛋白血症", enName:"Hypoalbuminaemia", category:"生化",
    differentials:[
      {zh:"蛋白質流失性腸病",en:"Protein-losing enteropathy (PLE)",species:"dog",freq:"common",category:"消化",urgency:"semi-urgent",detail:"腸道流失白蛋白。",workup:["腸道切片"]},
      {zh:"蛋白質流失性腎病",en:"PLN",species:"dog",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"腎絲球損傷。",workup:["UPC","腎臟切片"]},
      {zh:"肝合成不足",en:"Hepatic failure",species:"both",freq:"common",category:"肝膽",urgency:"urgent",detail:"嚴重肝病。",workup:["膽汁酸","肝臟超音波"]}
    ]},
  { id:"hyperglobulinaemia", zhName:"高球蛋白血症", enName:"Hyperglobulinaemia", category:"生化",
    differentials:[
      {zh:"Ehrlichia感染",en:"Ehrlichiosis",species:"dog",freq:"common",category:"感染",urgency:"semi-urgent",detail:"多克隆球蛋白升高。",workup:["4Dx SNAP","血清蛋白電泳"]},
      {zh:"FIP",en:"Feline infectious peritonitis (FIP)",species:"cat",freq:"common",category:"感染",urgency:"urgent",detail:"A/G ratio<0.4。",workup:["A/G比值","Rivalta"]},
      {zh:"多發性骨髓瘤",en:"Multiple myeloma",species:"both",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"單克隆球蛋白。",workup:["血清蛋白電泳","骨髓切片"]}
    ]},
  { id:"proteinuria", zhName:"蛋白尿", enName:"Proteinuria", category:"尿液",
    differentials:[
      {zh:"腎絲球疾病",en:"Glomerular disease",species:"both",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"UPC>2.0。",workup:["UPC","血壓","腎臟切片"]},
      {zh:"泌尿道感染",en:"Urinary tract infection (UTI)",species:"both",freq:"common",category:"感染",urgency:"non-urgent",detail:"炎症性蛋白尿。",workup:["尿液培養"]},
      {zh:"高血壓",en:"Systemic hypertension",species:"both",freq:"common",category:"心血管",urgency:"semi-urgent",detail:"腎絲球高壓損傷。",workup:["血壓測量"]}
    ]},
  { id:"elevated-t4", zhName:"T4升高", enName:"Elevated T4 (Total / Free)", category:"內分泌",
    differentials:[
      {zh:"甲狀腺亢進",en:"Hyperthyroidism",species:"cat",freq:"common",category:"內分泌",urgency:"semi-urgent",detail:"中老年貓最常見內分泌疾病。體重減輕、多食、心搏過速。",workup:["Total T4","Free T4","甲狀腺掃描","心臟超音波"]},
      {zh:"甲狀腺腫瘤",en:"Thyroid neoplasia",species:"dog",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"犬甲狀腺癌。頸部腫塊。",workup:["細針抽吸","頸部超音波","CT","TSH"]},
      {zh:"非甲狀腺疾病假性升高",en:"Non-thyroidal illness (euthyroid sick)",species:"both",freq:"uncommon",category:"代謝",urgency:"semi-urgent",detail:"嚴重全身性疾病恢復期T4可偽高。需搭配Free T4、TSH判讀。",workup:["Free T4","TSH","排除其他疾病"]}
    ]}
]};

// ======= MAIN DB =======
const DB = { symptoms: [
// ---- 1.1 全身性、系統性與代謝 ----
    {
      id: "polyuria-polydipsia",
      zhName: "多尿/多渴",
      enName: "Polyuria / Polydipsia",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "飲水量與排尿量異常增加。犬正常飲水量約 50-60 mL/kg/day，貓約 45 mL/kg/day；超過此值應懷疑 PU/PD。",
      differentials: [
        { zh: "糖尿病", en: "Diabetes mellitus", species: "both", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "血糖持續升高導致滲透性利尿。常伴隨多食、體重減輕。犬多為第一型，貓多為第二型。",
          workup: ["血糖測定", "尿液分析（糖尿）", "果糖胺（fructosamine）", "糖化血色素"] },
        { zh: "慢性腎臟病", en: "Chronic kidney disease (CKD)", species: "both", freq: "common", category: "腎臟/泌尿", urgency: "semi-urgent",
          detail: "腎臟濃縮能力下降，貓尤其常見。IRIS 分期有助於嚴重度評估。",
          workup: ["BUN / Creatinine / SDMA", "尿比重（USG）", "UPC 比值", "腎臟超音波"] },
        { zh: "庫欣氏症", en: "Hyperadrenocorticism (Cushing's)", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "腎上腺皮質醇過量，抑制 ADH 作用。常見皮膚變薄、腹部膨大、喘息。",
          workup: ["ACTH 刺激試驗", "低劑量 Dexamethasone 抑制試驗", "尿皮質醇/肌酸酐比值", "腹部超音波"] },
        { zh: "甲狀腺亢進", en: "Hyperthyroidism", species: "cat", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "中老年貓常見，T4 升高導致代謝率增加、腎血流增加。",
          workup: ["Total T4", "Free T4", "甲狀腺掃描"] },
        { zh: "高血鈣症", en: "Hypercalcaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "鈣離子干擾腎小管濃縮功能。常見原因包括腫瘤（淋巴瘤）、原發性副甲狀腺亢進、維生素 D 中毒。",
          workup: ["離子鈣", "PTH", "PTHrP", "胸/腹腔影像學"] },
        { zh: "子宮蓄膿", en: "Pyometra", species: "both", freq: "common", category: "生殖", urgency: "urgent",
          detail: "未絕育母犬/母貓。開放型(open-cervix)有陰道分泌物；閉鎖型(closed-cervix)更危急。氣腫型(emphysematous)含氣體產氣菌感染預後差。無菌型(sterile)培養陰性仍需手術。",
          workup: ["腹部超音波", "CBC（白血球增多）", "腹部 X 光"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "uncommon", category: "肝膽", urgency: "semi-urgent",
          detail: "嚴重肝病影響尿素循環及水分代謝。",
          workup: ["肝指數（ALT, ALP, GGT）", "膽汁酸", "白蛋白", "肝臟超音波"] },
        { zh: "尿崩症（中樞型）", en: "Central diabetes insipidus", species: "both", freq: "rare", category: "內分泌", urgency: "semi-urgent",
          detail: "ADH 分泌不足，導致大量稀釋尿。極度多尿（USG < 1.005）。",
          workup: ["水分限制試驗（需住院監控）", "Desmopressin 試驗", "腦部 MRI"] },
        { zh: "尿崩症（腎因型）", en: "Nephrogenic diabetes insipidus", species: "both", freq: "rare", category: "腎臟/泌尿", urgency: "semi-urgent",
          detail: "腎小管對 ADH 反應不良。可為先天性或繼發於其他疾病（低血鉀、高血鈣等）。",
          workup: ["Desmopressin 試驗（無反應）", "電解質", "腎臟切片"] },
        { zh: "心因性多渴", en: "Psychogenic polydipsia", species: "dog", freq: "uncommon", category: "行為", urgency: "non-urgent",
          detail: "排除器質性原因後的行為性過度飲水，常見於大型犬。",
          workup: ["漸進式水分限制試驗", "排除其他原因"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent",
          detail: "腎上腺皮質功能低下，醛固酮缺乏導致鈉流失、鉀滯留。",
          workup: ["電解質（Na/K 比值）", "ACTH 刺激試驗", "基礎皮質醇"] },
        { zh: "醫源性（藥物）", en: "Drug-induced / Iatrogenic", species: "both", freq: "common", category: "其他", urgency: "non-urgent",
          detail: "類固醇、利尿劑、抗癲癇藥（苯巴比妥）、甲狀腺素補充過量等均可導致 PU/PD。",
          workup: ["詳細用藥史回顧"] },
        { zh: "腎盂腎炎", en: "Bacterial pyelonephritis", species: "both", freq: "uncommon", category: "感染", urgency: "urgent",
          detail: "上泌尿道細菌感染。發燒、腰痛、PU/PD。可致急性腎損傷。",
          workup: ["尿液培養", "腎臟超音波", "CBC"] }
      ]
    },
    {
      id: "weight-loss",
      zhName: "體重減輕",
      enName: "Weight Loss",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "非刻意的體重下降，通常超過正常體重的 10% 即有臨床意義。需區分食慾正常或降低。",
      differentials: [
        { zh: "糖尿病", en: "Diabetes mellitus", species: "both", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "胰島素不足導致葡萄糖無法被利用，身體分解脂肪與蛋白質。常伴多食、多尿。",
          workup: ["血糖", "尿液分析", "果糖胺"] },
        { zh: "甲狀腺亢進", en: "Hyperthyroidism", species: "cat", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "代謝率亢進導致消耗增加。中老年貓常見，常伴多食、心跳過快。",
          workup: ["Total T4", "Free T4", "心臟超音波"] },
        { zh: "腫瘤", en: "Neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent",
          detail: "惡性腫瘤引起惡病質（cachexia），腫瘤消耗營養並產生炎症因子。",
          workup: ["影像學（X 光、超音波、CT）", "細胞學/組織病理學", "CBC"] },
        { zh: "慢性腎臟病", en: "Chronic kidney disease (CKD)", species: "both", freq: "common", category: "腎臟/泌尿", urgency: "semi-urgent",
          detail: "尿毒症導致食慾下降、蛋白質流失。",
          workup: ["BUN/Cre/SDMA", "UPC", "尿比重"] },
        { zh: "胰外分泌功能不足", en: "Exocrine pancreatic insufficiency (EPI)", species: "both", freq: "uncommon", category: "消化", urgency: "non-urgent",
          detail: "消化酵素缺乏導致脂肪與蛋白質吸收不良。常見大量脂肪便。德國牧羊犬好發。",
          workup: ["TLI（Trypsin-like immunoreactivity）", "糞便檢查"] },
        { zh: "炎症性腸病", en: "Inflammatory bowel disease (IBD)", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "腸道慢性發炎導致吸收不良，常伴嘔吐、腹瀉。",
          workup: ["腸道切片（內視鏡或手術）", "低白蛋白血症", "Cobalamin/Folate"] },
        { zh: "寄生蟲感染", en: "Intestinal parasites", species: "both", freq: "common", category: "感染", urgency: "semi-urgent",
          detail: "腸道寄生蟲（鉤蟲、蛔蟲、鞭蟲等）導致營養流失，幼年動物尤其明顯。",
          workup: ["糞便浮游法", "糞便抗原檢測"] },
        { zh: "慢性感染", en: "Chronic infection", species: "both", freq: "uncommon", category: "感染", urgency: "semi-urgent",
          detail: "持續性感染（如 FIV、FeLV、慢性膿瘍）消耗體力。",
          workup: ["FIV/FeLV 篩檢", "血液培養", "影像學"] },
        { zh: "心臟病（心因性惡病質）", en: "Cardiac cachexia", species: "both", freq: "uncommon", category: "心血管", urgency: "urgent",
          detail: "嚴重心臟病導致組織灌流不足及炎症因子增加。",
          workup: ["心臟超音波", "NT-proBNP", "胸腔 X 光"] },
        { zh: "蛋白質流失性腸病", en: "Protein-losing enteropathy (PLE)", species: "dog", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "腸道大量流失蛋白質，低白蛋白血症、低球蛋白血症。",
          workup: ["白蛋白/球蛋白", "腸道切片", "糞便 α1-PI"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "uncommon", category: "肝膽", urgency: "semi-urgent",
          detail: "慢性肝病影響蛋白質合成及代謝。",
          workup: ["肝指數", "膽汁酸", "白蛋白", "肝臟超音波"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent", detail: "「偉大的偽裝者」。慢性體重減輕、反覆腸胃道症狀。", workup: ["電解質（Na/K ratio）", "ACTH 刺激試驗"] },
        { zh: "胰臟腺癌", en: "Pancreatic adenocarcinoma", species: "both", freq: "rare", category: "腫瘤", urgency: "urgent", detail: "預後差。體重減輕、嘔吐、腹部疼痛。常發現時已轉移。", workup: ["腹部超音波", "CT", "超音波引導切片"] }
      ]
    },
    {
      id: "weight-gain",
      zhName: "體重增加",
      enName: "Weight Gain",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "非預期的體重增加。需區分真正的脂肪堆積與液體蓄積（腹水、水腫）。",
      differentials: [
        { zh: "肥胖（攝取過量）", en: "Obesity (overfeeding)", species: "both", freq: "common", category: "營養", urgency: "non-urgent",
          detail: "最常見原因。熱量攝取超過消耗，絕育動物風險更高。",
          workup: ["體態評分（BCS）", "飲食史與熱量計算"] },
        { zh: "甲狀腺低下", en: "Hypothyroidism", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "代謝率降低。常伴皮膚症狀（脫毛、皮膚增厚）、嗜睡。犬好發，貓極罕見。",
          workup: ["Total T4", "Free T4", "TSH"] },
        { zh: "庫欣氏症", en: "Hyperadrenocorticism (Cushing's)", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "皮質醇過量促進脂肪重新分布（腹部肥胖）。可能合併 PU/PD。",
          workup: ["LDDS", "ACTH 刺激試驗", "腹部超音波"] },
        { zh: "腹水", en: "Ascites", species: "both", freq: "uncommon", category: "多系統", urgency: "urgent",
          detail: "腹腔液體蓄積。原因包括右心衰竭、肝病、低白蛋白、腫瘤、FIP。",
          workup: ["腹腔穿刺與液體分析", "超音波", "白蛋白"] },
        { zh: "水腫", en: "Oedema", species: "both", freq: "uncommon", category: "多系統", urgency: "semi-urgent",
          detail: "組織間液蓄積。可能為局部或全身性。",
          workup: ["白蛋白", "心臟評估", "淋巴系統評估"] },
        { zh: "妊娠", en: "Pregnancy", species: "both", freq: "common", category: "生殖", urgency: "non-urgent",
          detail: "未絕育母畜的可能性需首先排除。",
          workup: ["腹部超音波", "Relaxin 測試"] },
        { zh: "醫源性（藥物）", en: "Drug-induced / Iatrogenic", species: "both", freq: "common", category: "其他", urgency: "non-urgent",
          detail: "類固醇長期使用、某些抗癲癇藥可導致體重增加。",
          workup: ["用藥史回顧"] }
      ]
    },
    {
      id: "polyphagia",
      zhName: "多食",
      enName: "Polyphagia",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "食慾異常亢進，進食量明顯超過正常。需區分是否伴隨體重減輕或增加。",
      differentials: [
        { zh: "糖尿病", en: "Diabetes mellitus", species: "both", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "細胞無法利用葡萄糖，身體持續處於「飢餓」狀態。多食但體重減輕。",
          workup: ["血糖", "尿液分析", "果糖胺"] },
        { zh: "甲狀腺亢進", en: "Hyperthyroidism", species: "cat", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "代謝率增加，能量消耗加速。多食但體重減輕。",
          workup: ["Total T4", "Free T4"] },
        { zh: "胰外分泌功能不足", en: "Exocrine pancreatic insufficiency (EPI)", species: "both", freq: "uncommon", category: "消化", urgency: "non-urgent",
          detail: "食物無法被消化吸收，動物持續飢餓。伴大量軟便/脂肪便。",
          workup: ["TLI"] },
        { zh: "庫欣氏症", en: "Hyperadrenocorticism (Cushing's)", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent",
          detail: "皮質醇過量刺激食慾。多食伴體重增加。",
          workup: ["LDDS", "ACTH 刺激試驗"] },
        { zh: "藥物引起", en: "Drug-induced / Iatrogenic", species: "both", freq: "common", category: "其他", urgency: "non-urgent",
          detail: "類固醇、苯巴比妥（phenobarbital）、抗組織胺等可增加食慾。",
          workup: ["用藥史回顧"] },
        { zh: "吸收不良", en: "Malabsorption", species: "both", freq: "uncommon", category: "消化", urgency: "semi-urgent",
          detail: "腸道疾病（IBD、淋巴管擴張等）導致營養無法吸收。",
          workup: ["Cobalamin/Folate", "腸道切片", "白蛋白"] },
        { zh: "行為性多食", en: "Behavioral polyphagia", species: "both", freq: "common", category: "行為", urgency: "non-urgent",
          detail: "競爭性進食、焦慮、無聊等心理因素。排除器質性原因後考慮。",
          workup: ["行為評估", "排除其他原因"] }
      ]
    },
    {
      id: "anorexia",
      zhName: "厭食/食慾不振",
      enName: "Anorexia / Inappetence",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "食慾部分或完全喪失。為最常見的非特異性臨床症狀之一，幾乎所有系統性疾病均可導致。貓超過 3 天未進食需警惕肝脂肪沉積。",
      differentials: [
        { zh: "感染性疾病", en: "Infectious disease", species: "both", freq: "common", category: "感染", urgency: "urgent",
          detail: "發燒導致食慾下降。細菌、病毒、黴菌感染均可。",
          workup: ["CBC", "體溫", "感染篩檢"] },
        { zh: "疼痛", en: "Pain", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent",
          detail: "各種來源的疼痛均可抑制食慾。需仔細理學檢查找出疼痛源。",
          workup: ["疼痛評估量表", "理學檢查", "影像學"] },
        { zh: "腎臟疾病", en: "Renal disease", species: "both", freq: "common", category: "腎臟/泌尿", urgency: "semi-urgent",
          detail: "尿毒症引起噁心、口腔潰瘍。",
          workup: ["BUN/Cre/SDMA", "電解質"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "common", category: "肝膽", urgency: "semi-urgent",
          detail: "肝功能異常導致毒素蓄積、噁心。",
          workup: ["肝指數", "膽汁酸", "白蛋白"] },
        { zh: "腸胃道疾病", en: "Gastrointestinal disease", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "噁心、嘔吐、腹痛等均可導致厭食。",
          workup: ["影像學", "內視鏡", "糞便檢查"] },
        { zh: "腫瘤", en: "Neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent",
          detail: "腫瘤相關惡病質、疼痛、器官壓迫均可導致食慾下降。",
          workup: ["影像學", "細胞學"] },
        { zh: "口腔疾病", en: "Oral disease", species: "both", freq: "common", category: "口腔", urgency: "non-urgent",
          detail: "牙周病、口炎（貓尤其常見）、口腔腫瘤導致進食疼痛。",
          workup: ["口腔檢查（需鎮靜）", "口腔 X 光"] },
        { zh: "心理/環境因素", en: "Psychological/Environmental", species: "both", freq: "common", category: "行為", urgency: "non-urgent",
          detail: "壓力、環境變化、食物變更。貓尤其敏感。",
          workup: ["環境與生活史"] },
        { zh: "心臟病", en: "Cardiac disease", species: "both", freq: "uncommon", category: "心血管", urgency: "urgent",
          detail: "充血性心衰竭導致臟器灌流不足、腸道水腫。",
          workup: ["心臟超音波", "NT-proBNP", "胸腔 X 光"] },
        { zh: "胰臟炎", en: "Pancreatitis", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "腹痛、噁心為主要原因。犬症狀通常較貓明顯。",
          workup: ["fPLI/cPLI（Spec fPL/cPL）", "腹部超音波"] }
      ]
    },
    {
      id: "failure-to-grow",
      zhName: "生長遲滯",
      enName: "Failure to Grow",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "幼年動物未能達到預期的體型與體重。需與同窩/同品種幼畜比較。",
      differentials: [
        { zh: "門脈系統分流", en: "Portosystemic shunt (PSS)", species: "both", freq: "uncommon", category: "肝膽", urgency: "urgent",
          detail: "先天性血管異常，門靜脈血液繞過肝臟。常見嘔吐、神經症狀（特別在進食後）。",
          workup: ["膽汁酸（前/後餐）", "血氨", "腹部超音波/CT 血管攝影"] },
        { zh: "先天性心臟病", en: "Congenital heart disease", species: "both", freq: "uncommon", category: "心血管", urgency: "urgent",
          detail: "PDA、主動脈瓣狹窄、肺動脈瓣狹窄等影響生長。",
          workup: ["心臟超音波", "胸腔 X 光", "心電圖"] },
        { zh: "寄生蟲感染", en: "Intestinal parasites", species: "both", freq: "common", category: "感染", urgency: "semi-urgent",
          detail: "大量腸道寄生蟲導致營養流失與貧血。",
          workup: ["糞便檢查", "CBC"] },
        { zh: "營養不良", en: "Malnutrition", species: "both", freq: "common", category: "營養", urgency: "semi-urgent",
          detail: "飲食不當、餵食不足或品質不佳。",
          workup: ["飲食史", "營養評估"] },
        { zh: "巨食道/持續性右主動脈弓", en: "Megaoesophagus / PRAA", species: "dog", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "食道擴張導致吞嚥困難及反流，營養攝取不足。",
          workup: ["胸腔 X 光（含鋇劑）", "內視鏡"] },
        { zh: "內分泌疾病", en: "Endocrine disease", species: "both", freq: "rare", category: "內分泌", urgency: "semi-urgent",
          detail: "先天性甲狀腺低下、垂體侏儒症等。",
          workup: ["甲狀腺功能", "GH/IGF-1"] },
        { zh: "腎臟發育不全", en: "Renal dysplasia", species: "both", freq: "rare", category: "腎臟/泌尿", urgency: "urgent",
          detail: "先天性腎臟發育異常導致早期腎功能不全。",
          workup: ["BUN/Cre", "尿比重", "腎臟超音波/切片"] }
      ]
    },
    {
      id: "syncope",
      zhName: "昏厥/虛脫",
      enName: "Syncope / Collapse",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "突發性、暫時性的意識喪失或全身無力倒下。需與癲癇發作區分：昏厥通常恢復迅速且無後發性混亂。",
      differentials: [
        { zh: "心律不整", en: "Cardiac arrhythmia", species: "both", freq: "common", category: "心血管", urgency: "urgent",
          detail: "嚴重心搏過緩或過速導致心輸出量驟降。常為運動或興奮時發生。",
          workup: ["心電圖", "24 小時 Holter 監測", "心臟超音波"] },
        { zh: "心臟結構性疾病", en: "Structural heart disease", species: "both", freq: "common", category: "心血管", urgency: "urgent",
          detail: "瓣膜疾病、心肌病、心包膜積液導致心輸出量不足。",
          workup: ["心臟超音波", "胸腔 X 光", "NT-proBNP"] },
        { zh: "癲癇", en: "Epilepsy / Seizures", species: "both", freq: "common", category: "神經", urgency: "urgent",
          detail: "需與真正的昏厥區分。癲癇常有前兆、抽搐、大小便失禁、發作後混亂。",
          workup: ["神經學檢查", "腦部 MRI", "腦脊髓液分析", "腦電圖"] },
        { zh: "低血糖", en: "Hypoglycaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "胰島素瘤、肝功能不全、敗血症、幼犬/小型犬。",
          workup: ["血糖", "胰島素濃度", "腹部超音波"] },
        { zh: "電解質異常", en: "Electrolyte imbalance", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "嚴重低鉀、高鉀、低鈉、低鈣均可導致虛脫。",
          workup: ["血清電解質全套", "離子鈣"] },
        { zh: "血管迷走神經性昏厥", en: "Vasovagal syncope", species: "dog", freq: "uncommon", category: "神經", urgency: "semi-urgent",
          detail: "迷走神經過度興奮導致心率減慢、血壓下降。",
          workup: ["排除其他心臟疾病", "臨床監測"] },
        { zh: "肺動脈高壓", en: "Pulmonary hypertension", species: "dog", freq: "uncommon", category: "心血管", urgency: "urgent",
          detail: "運動時右心輸出量不足。常見於慢性呼吸道或心臟疾病。",
          workup: ["心臟超音波（三尖瓣逆流速度）", "胸腔 X 光"] },
        { zh: "貧血", en: "Anaemia", species: "both", freq: "uncommon", category: "血液", urgency: "semi-urgent",
          detail: "嚴重貧血導致組織缺氧。",
          workup: ["CBC/PCV", "血液抹片", "網狀紅血球"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent",
          detail: "「偉大的偽裝者」。急性腎上腺危機可致休克、虛脫。低鈉高鉀是重要線索。",
          workup: ["電解質（Na/K ratio）", "ACTH 刺激試驗", "基礎皮質醇"] }
      ]
    },
    {
      id: "weakness",
      zhName: "虛弱/無力",
      enName: "Weakness",
      section: "1.1",
      sectionName: "全身性／系統性／代謝",
      description: "運動耐受力下降或全身性無力。可為持續性或間歇性。需與跛行、共濟失調區分。",
      differentials: [
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "urgent",
          detail: "神經肌肉接合處自體抗體阻斷 ACh 受體。運動後加重，休息後改善。可伴巨食道。",
          workup: ["AChR 抗體效價", "Edrophonium 試驗", "胸腔 X 光（胸腺瘤）"] },
        { zh: "貧血", en: "Anaemia", species: "both", freq: "common", category: "血液", urgency: "semi-urgent",
          detail: "紅血球減少導致組織缺氧。原因包括溶血、出血、骨髓疾病。",
          workup: ["CBC/PCV", "網狀紅血球", "血液抹片", "Coombs 試驗"] },
        { zh: "心血管疾病", en: "Cardiac disease", species: "both", freq: "common", category: "心血管", urgency: "urgent",
          detail: "心輸出量不足導致全身灌流不足。",
          workup: ["心臟超音波", "胸腔 X 光", "心電圖"] },
        { zh: "低血鉀症", en: "Hypokalaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "鉀離子過低影響肌肉收縮。貓可見頸部腹屈。常見於 CKD、嘔吐/腹瀉後。",
          workup: ["血清鉀", "電解質全套"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent",
          detail: "急性腎上腺危機可表現為嚴重虛弱、休克。",
          workup: ["電解質", "ACTH 刺激試驗", "基礎皮質醇"] },
        { zh: "多發性肌炎", en: "Polymyositis", species: "dog", freq: "rare", category: "神經肌肉", urgency: "urgent",
          detail: "免疫介導性肌肉發炎。全身僵硬、疼痛、無力。",
          workup: ["CK", "肌肉切片", "肌電圖"] },
        { zh: "內分泌疾病", en: "Endocrine disease", species: "both", freq: "uncommon", category: "內分泌", urgency: "semi-urgent",
          detail: "甲狀腺低下（犬）、低血糖、電解質異常等。",
          workup: ["甲狀腺功能", "血糖", "電解質"] },
        { zh: "神經系統疾病", en: "Neurological disease", species: "both", freq: "uncommon", category: "神經", urgency: "urgent",
          detail: "脊髓疾病、多發性神經病變等可表現為全身無力。",
          workup: ["神經學檢查", "脊髓影像學（MRI）", "腦脊髓液"] },
        { zh: "遺傳性肌強直症", en: "Hereditary myotonia", species: "dog", freq: "rare", category: "神經肌肉", urgency: "non-urgent", detail: "肌肉收縮後延遲放鬆。Chow Chow、Miniature Schnauzer等品種。運動後僵硬改善。", workup: ["肌電圖（EMG）", "基因檢測", "CK"] }
      ]
    },

    // ---- 1.2 消化道/腹腔 ----
    {
      id: "ptyalism",
      zhName: "流涎/唾液分泌過多",
      enName: "Ptyalism / Hypersalivation",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "唾液分泌異常增多或因吞嚥障礙導致口水外溢。需區分真性分泌過多與假性流涎（無法吞嚥）。",
      differentials: [
        { zh: "口腔疾病", en: "Oral disease", species: "both", freq: "common", category: "口腔", urgency: "non-urgent",
          detail: "牙周病、口炎（貓慢性口齦炎尤其常見）、口腔腫瘤、口腔異物。",
          workup: ["口腔檢查（需鎮靜）", "口腔 X 光", "切片"] },
        { zh: "噁心", en: "Nausea", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "任何引起噁心的原因均可導致流涎。腸胃道疾病、藥物副作用、暈車。",
          workup: ["根據伴隨症狀進一步檢查"] },
        { zh: "食道疾病", en: "Oesophageal disease", species: "both", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "食道炎、食道異物、食道狹窄、巨食道導致吞嚥困難。",
          workup: ["胸腔 X 光", "鋇劑吞嚥", "內視鏡"] },
        { zh: "中毒", en: "Toxin exposure", species: "both", freq: "uncommon", category: "中毒", urgency: "emergency",
          detail: "腐蝕性物質、某些植物（百合科等）、殺蟲劑（有機磷）。",
          workup: ["暴露史", "毒物篩檢", "膽鹼酯酶活性"] },
        { zh: "神經系統疾病", en: "Neurological disease", species: "both", freq: "rare", category: "神經", urgency: "urgent",
          detail: "顏面神經麻痺、三叉神經病變、狂犬病（需考量地區流行狀況）。",
          workup: ["神經學檢查", "腦部 MRI"] },
        { zh: "唾液腺疾病", en: "Salivary gland disease", species: "both", freq: "rare", category: "口腔", urgency: "non-urgent",
          detail: "唾液腺囊腫（sialocele）、唾液腺炎。",
          workup: ["觸診", "超音波", "穿刺細胞學"] },
        { zh: "疼痛", en: "Pain", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent",
          detail: "嚴重疼痛（特別是頭頸部區域）可引起流涎反應。",
          workup: ["理學檢查", "疼痛定位"] }
      ]
    },

    // ---- Additional symptoms from book's extended TOC ----
    {
      id: "vomiting",
      zhName: "嘔吐",
      enName: "Vomiting",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "胃內容物的主動排出。需與反流（regurgitation，被動、無腹部收縮）區分。急性 vs 慢性嘔吐的鑑別方向不同。",
      differentials: [
        { zh: "腸胃道異物", en: "GI foreign body", species: "both", freq: "common", category: "消化", urgency: "urgent",
          detail: "線性異物在貓特別常見。可導致腸阻塞或穿孔。",
          workup: ["腹部 X 光", "腹部超音波", "內視鏡"] },
        { zh: "胰臟炎", en: "Pancreatitis", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "犬通常症狀明顯（嘔吐、腹痛），貓症狀可能較隱匿。",
          workup: ["fPLI/cPLI", "腹部超音波"] },
        { zh: "腎臟疾病", en: "Renal disease", species: "both", freq: "common", category: "腎臟/泌尿", urgency: "semi-urgent",
          detail: "尿毒症刺激化學受體觸發區（CRTZ）。",
          workup: ["BUN/Cre/SDMA", "電解質"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "common", category: "肝膽", urgency: "semi-urgent",
          detail: "肝功能不全導致毒素蓄積。",
          workup: ["肝指數", "膽汁酸"] },
        { zh: "炎症性腸病", en: "Inflammatory bowel disease (IBD)", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "慢性嘔吐的常見原因，需切片確診。",
          workup: ["內視鏡切片", "Cobalamin/Folate"] },
        { zh: "腸套疊", en: "Intussusception", species: "both", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "腸段套入鄰近腸段，幼年動物較常見。",
          workup: ["腹部超音波（靶環徵象）"] },
        { zh: "藥物/中毒", en: "Drug/Toxin", species: "both", freq: "common", category: "中毒", urgency: "urgent",
          detail: "NSAIDs、化療藥物、百合（貓）、巧克力、葡萄/葡萄乾等。",
          workup: ["暴露史", "藥物史"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent",
          detail: "「偉大的偽裝者」，可模仿多種腸胃道疾病。",
          workup: ["電解質（Na/K ratio）", "ACTH 刺激試驗"] },
        { zh: "腸道腫瘤", en: "GI neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "淋巴瘤（貓最常見的腸道腫瘤）、腺癌等。",
          workup: ["超音波", "內視鏡切片或手術切片"] },
        { zh: "食物不良反應", en: "Food adverse reaction", species: "both", freq: "common", category: "過敏", urgency: "non-urgent", detail: "餐後嘔吐，慢性嘔吐常見病因。需排除飲食試驗8-12週確診。", workup: ["排除飲食試驗（8-12週）", "食物過敏原檢測"] },
        { zh: "犬小病毒", en: "Canine parvovirus (CPV)", species: "dog", freq: "common", category: "感染", urgency: "emergency", detail: "幼犬急診。嚴重嘔吐、出血性腹瀉、白血球減少。未打疫苗幼犬需高度懷疑。", workup: ["CPV SNAP 快篩", "CBC（白血球減少）", "電解質"] },
        { zh: "胃潰瘍", en: "Gastric ulceration", species: "both", freq: "uncommon", category: "消化", urgency: "urgent", detail: "NSAIDs、肥大細胞瘤、肝病。可致嘔血。", workup: ["內視鏡", "糞便潛血"] },
        { zh: "胃擴張扭轉(GDV)", en: "GDV", species: "dog", freq: "common", category: "急診", urgency: "emergency", detail: "大型深胸犬急診。非產性乾嘔/嘔吐、腹部急性膨大、休克。需立即手術。", workup: ["腹部X光", "急診手術"] },
        { zh: "貓嗜酸球性硬化性纖維增生", en: "Feline eosinophilic sclerosing fibroplasia (FGESF)", species: "cat", freq: "rare", category: "消化", urgency: "urgent", detail: "貓罕見腸道發炎性疾病。慢性嘔吐、體重減輕、內視鏡下黏膜腫塊。", workup: ["內視鏡切片", "組織病理", "腹部超音波"] }
      ]
    },
    {
      id: "diarrhoea",
      zhName: "腹瀉",
      enName: "Diarrhoea",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "糞便次數增加、含水量增加或量增加。需區分小腸型與大腸型腹瀉，有助於縮小鑑別範圍。",
      differentials: [
        { zh: "飲食不當", en: "Dietary indiscretion", species: "both", freq: "common", category: "消化", urgency: "non-urgent",
          detail: "最常見的急性腹瀉原因。食物變更、垃圾翻食。",
          workup: ["飲食史", "通常自限性"] },
        { zh: "寄生蟲", en: "Intestinal parasites", species: "both", freq: "common", category: "感染", urgency: "semi-urgent",
          detail: "梨形鞭毛蟲、球蟲、鉤蟲、蛔蟲、鞭蟲等。",
          workup: ["糞便浮游法", "糞便抗原"] },
        { zh: "炎症性腸病", en: "Inflammatory bowel disease (IBD)", species: "both", freq: "common", category: "消化", urgency: "semi-urgent",
          detail: "慢性腹瀉的重要鑑別。需排除食物反應性腸病。",
          workup: ["排除飲食、內視鏡切片"] },
        { zh: "胰外分泌功能不足", en: "Exocrine pancreatic insufficiency (EPI)", species: "both", freq: "uncommon", category: "消化", urgency: "non-urgent",
          detail: "大量黃色脂肪便，德國牧羊犬好發。",
          workup: ["TLI"] },
        { zh: "食物過敏/不耐受", en: "Food adverse reaction", species: "both", freq: "common", category: "免疫", urgency: "non-urgent",
          detail: "對特定蛋白質或成分的不良反應。",
          workup: ["排除飲食試驗（8-12 週）"] },
        { zh: "感染性腸炎", en: "Infectious enteritis", species: "both", freq: "common", category: "感染", urgency: "urgent",
          detail: "犬小病毒、犬冠狀病毒、貓瘟、沙門氏菌等。",
          workup: ["糞便 PCR/抗原", "CBC"] },
        { zh: "腸道腫瘤", en: "GI neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "老年動物的慢性腹瀉需考慮。",
          workup: ["超音波", "切片"] },
        { zh: "蛋白質流失性腸病", en: "Protein-losing enteropathy (PLE)", species: "dog", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "腹瀉伴低白蛋白血症。約克夏梗好發。",
          workup: ["白蛋白", "腸道切片"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent",
          detail: "間歇性腹瀉，常被誤診為單純腸胃道問題。",
          workup: ["電解質", "ACTH 刺激試驗"] },
        { zh: "壓力性結腸炎", en: "Stress colitis", species: "dog", freq: "common", category: "消化", urgency: "non-urgent", detail: "寄宿、旅行、手術後。大腸型腹瀉，帶黏液或鮮血。通常自限性。", workup: ["病史", "排除其他原因"] },
        { zh: "急性出血性腸病症候群", en: "Acute haemorrhagic diarrhoea syndrome (AHDS)", species: "dog", freq: "uncommon", category: "消化", urgency: "emergency", detail: "急性大量血便、血容比升高。舊稱HGE。", workup: ["PCV/TP（血容比升高是特徵）", "排除其他出血原因"] }
      ]
    },
    {
      id: "coughing",
      zhName: "咳嗽",
      enName: "Coughing",
      section: "1.3",
      sectionName: "呼吸道",
      description: "突然、強力的空氣排出以清除呼吸道。犬較常見，貓咳嗽常被誤認為嘔吐動作。需區分乾咳 vs 濕咳、日間 vs 夜間。",
      differentials: [
        { zh: "犬舍咳（犬傳染性氣管支氣管炎）", en: "Kennel cough (CIRD)", species: "dog", freq: "common", category: "感染", urgency: "non-urgent",
          detail: "高度傳染性，典型乾咳（鵝叫聲）。Bordetella、犬副流感等。",
          workup: ["臨床診斷為主", "PCR panel"] },
        { zh: "充血性心衰竭", en: "Congestive heart failure (CHF)", species: "dog", freq: "common", category: "心血管", urgency: "urgent",
          detail: "左心房擴大壓迫主支氣管，或肺水腫。夜間或運動後加重。貓心臟病較少咳嗽。",
          workup: ["胸腔 X 光", "心臟超音波", "NT-proBNP"] },
        { zh: "氣管塌陷", en: "Tracheal collapse", species: "dog", freq: "common", category: "呼吸", urgency: "semi-urgent",
          detail: "小型犬好發（約克夏、博美、吉娃娃）。典型「鵝叫」咳嗽，興奮時加重。",
          workup: ["頸胸 X 光（吸氣/呼氣）", "透視", "支氣管鏡"] },
        { zh: "貓氣喘", en: "Feline asthma", species: "cat", freq: "common", category: "呼吸", urgency: "semi-urgent",
          detail: "下呼吸道過敏性疾病。咳嗽、喘息、呼吸困難。",
          workup: ["胸腔 X 光（支氣管紋路增強）", "BAL（支氣管肺泡灌洗）"] },
        { zh: "肺炎", en: "Pneumonia", species: "both", freq: "uncommon", category: "感染", urgency: "urgent",
          detail: "細菌性、吸入性、黴菌性。濕咳、發燒、精神沉鬱。",
          workup: ["胸腔 X 光", "BAL", "培養與敏感試驗"] },
        { zh: "肺部腫瘤", en: "Pulmonary neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "原發性或轉移性。老年動物慢性咳嗽需考慮。",
          workup: ["三向位胸腔 X 光", "CT", "細胞學"] },
        { zh: "慢性支氣管炎", en: "Chronic bronchitis", species: "dog", freq: "common", category: "呼吸", urgency: "semi-urgent",
          detail: "持續 2 個月以上的每日咳嗽，排除其他原因。中老年小型犬常見。",
          workup: ["胸腔 X 光", "BAL"] },
        { zh: "心絲蟲", en: "Heartworm disease", species: "both", freq: "uncommon", category: "感染", urgency: "urgent",
          detail: "流行地區需考慮。貓可能僅有少數蟲體即產生嚴重症狀。",
          workup: ["抗原測試（犬）", "抗體測試（貓）", "胸腔 X 光"] }
      ]
    },
    {
      id: "dyspnoea",
      zhName: "呼吸困難",
      enName: "Dyspnoea",
      section: "1.3",
      sectionName: "呼吸道",
      description: "呼吸費力或呼吸窘迫。為緊急臨床情況，需迅速評估。觀察呼吸模式有助於定位：吸氣性（上呼吸道）vs 呼氣性（下呼吸道）。",
      differentials: [
        { zh: "充血性心衰竭", en: "Congestive heart failure (CHF)", species: "both", freq: "common", category: "心血管", urgency: "urgent",
          detail: "肺水腫（犬較常見）或胸腔積液（貓較常見）。",
          workup: ["胸腔 X 光", "心臟超音波", "NT-proBNP"] },
        { zh: "胸腔積液", en: "Pleural effusion", species: "both", freq: "common", category: "多系統", urgency: "urgent",
          detail: "限制性呼吸型態。原因包括心臟病、腫瘤、FIP、乳糜胸、膿胸。",
          workup: ["胸腔超音波", "胸腔穿刺與液體分析"] },
        { zh: "肺炎", en: "Pneumonia", species: "both", freq: "common", category: "感染", urgency: "urgent",
          detail: "肺實質化減少氣體交換面積。",
          workup: ["胸腔 X 光", "BAL", "培養"] },
        { zh: "氣胸", en: "Pneumothorax", species: "both", freq: "uncommon", category: "呼吸", urgency: "emergency",
          detail: "外傷性或自發性。急性呼吸困難、呼吸音減弱。",
          workup: ["胸腔 X 光", "胸腔穿刺"] },
        { zh: "短頭犬阻塞性呼吸道症候群", en: "BOAS", species: "dog", freq: "common", category: "呼吸", urgency: "semi-urgent",
          detail: "短頭犬種（法鬥、巴哥、英鬥）。鼻孔狹窄、軟顎過長、氣管發育不全。",
          workup: ["臨床評估", "喉鏡/支氣管鏡（鎮靜下）"] },
        { zh: "貓氣喘（急性發作）", en: "Feline asthma", species: "cat", freq: "common", category: "呼吸", urgency: "urgent",
          detail: "嚴重支氣管痙攣導致呼氣性呼吸困難。",
          workup: ["胸腔 X 光", "對支氣管擴張劑的反應"] },
        { zh: "肺部腫瘤", en: "Pulmonary neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "大面積佔位或伴隨胸腔積液。",
          workup: ["胸腔 X 光/CT", "細胞學"] },
        { zh: "喉部麻痺", en: "Laryngeal paralysis", species: "dog", freq: "uncommon", category: "呼吸", urgency: "urgent",
          detail: "老年大型犬好發。吸氣性喘鳴，運動與熱環境時加重。",
          workup: ["喉鏡檢查（輕度鎮靜下）"] },
        { zh: "橫膈膜疝氣", en: "Diaphragmatic hernia", species: "both", freq: "uncommon", category: "消化", urgency: "urgent",
          detail: "外傷或先天性。腹腔臟器進入胸腔壓迫肺臟。",
          workup: ["胸腔 X 光", "超音波"] }
      ]
    },
    {
      id: "skin-pruritus",
      zhName: "搔癢（皮膚）",
      enName: "Pruritus",
      section: "1.4",
      sectionName: "皮膚",
      description: "持續性搔抓、舔舐、啃咬皮膚。犬貓最常見的皮膚問題主訴之一。需評估分布區域、季節性、對治療的反應。",
      differentials: [
        { zh: "跳蚤過敏性皮膚炎", en: "Flea allergy dermatitis (FAD)", species: "both", freq: "common", category: "寄生蟲/過敏", urgency: "non-urgent",
          detail: "全球最常見的過敏性皮膚病。犬好發腰薦部，貓可見粟粒狀皮膚炎。少數跳蚤即可引發。",
          workup: ["體外寄生蟲檢查", "嚴格除蚤試驗（8-12 週）"] },
        { zh: "異位性皮膚炎", en: "Atopic dermatitis", species: "dog", freq: "common", category: "過敏", urgency: "non-urgent",
          detail: "環境過敏原引起。好發面部、耳朵、肢端、腹側。常有季節性（後可能變為全年性）。",
          workup: ["排除其他原因", "皮內試驗或血清 IgE"] },
        { zh: "食物不良反應", en: "Food adverse reaction", species: "both", freq: "common", category: "過敏", urgency: "non-urgent",
          detail: "非季節性搔癢，可累及耳朵和腸胃道。",
          workup: ["排除飲食試驗（新型蛋白質或水解蛋白，8-12 週）"] },
        { zh: "疥癬", en: "Sarcoptic mange (Scabies)", species: "dog", freq: "uncommon", category: "寄生蟲", urgency: "semi-urgent",
          detail: "劇烈搔癢，好發耳緣、肘部、跗關節。高度傳染性。",
          workup: ["皮膚刮搔（敏感度低）", "試驗性治療", "血清抗體"] },
        { zh: "耳疥蟲", en: "Otodectes (ear mites)", species: "both", freq: "common", category: "寄生蟲", urgency: "non-urgent",
          detail: "深色耳垢、搔耳。幼年動物常見。",
          workup: ["耳鏡檢查", "耳垢顯微鏡檢"] },
        { zh: "皮黴菌症", en: "Dermatophytosis", species: "both", freq: "uncommon", category: "感染", urgency: "non-urgent",
          detail: "不一定搔癢，但某些動物可有明顯搔癢。圓形脫毛區。",
          workup: ["伍德燈", "DTM 培養", "PCR"] },
        { zh: "細菌性皮膚感染", en: "Bacterial pyoderma", species: "dog", freq: "common", category: "感染", urgency: "non-urgent",
          detail: "常為繼發於過敏的二次感染。膿疱、痂皮、表皮環。",
          workup: ["細胞學", "培養與敏感試驗（深層或反覆感染時）"] },
        { zh: "馬拉色菌皮膚炎", en: "Malassezia dermatitis", species: "dog", freq: "common", category: "感染", urgency: "non-urgent",
          detail: "酵母菌過度增生，油膩、惡臭。常繼發於過敏。",
          workup: ["皮膚細胞學（壓印抹片）"] },
        { zh: "蠕形蟎", en: "Demodicosis (Demodex)", species: "both", freq: "uncommon", category: "寄生蟲", urgency: "semi-urgent", detail: "典型為非搔癢性但繼發細菌感染後搔癢。貓D. gatoi為搔癢性。需深層皮膚刮搔確診。", workup: ["深層皮膚刮搔", "毛髮拔取鏡檢", "皮膚切片"] },
        { zh: "貓利什曼病", en: "Feline leishmaniosis", species: "cat", freq: "rare", category: "感染", urgency: "semi-urgent", detail: "地中海地區流行。皮膚結節、潰瘍、脫毛。需考慮旅遊史。", workup: ["皮膚切片", "Leishmania PCR", "血清學"] }
      ]
    },
    {
      id: "lameness",
      zhName: "跛行",
      enName: "Lameness",
      section: "1.7",
      sectionName: "肌肉骨骼",
      description: "步態異常，表現為某一肢或多肢負重異常。需區分承重性跛行 vs 懸盪性跛行、前肢 vs 後肢、急性 vs 慢性。",
      differentials: [
        { zh: "十字韌帶斷裂", en: "Cranial cruciate ligament rupture", species: "dog", freq: "common", category: "骨科", urgency: "semi-urgent",
          detail: "犬最常見的後肢跛行原因之一。可急性（外傷）或慢性退化。",
          workup: ["脛骨前推試驗", "脛骨壓迫試驗", "膝關節 X 光"] },
        { zh: "骨關節炎", en: "Osteoarthritis (OA)", species: "both", freq: "common", category: "骨科", urgency: "non-urgent",
          detail: "退化性關節疾病。老年動物漸進性跛行，活動後改善但長時間活動後加重。",
          workup: ["X 光", "關節液分析"] },
        { zh: "髖關節發育不良", en: "Hip dysplasia", species: "dog", freq: "common", category: "骨科", urgency: "non-urgent",
          detail: "大型犬好發。後肢跛行、兔跳步態、起身困難。",
          workup: ["骨盆 X 光（PennHIP 或 OFA）"] },
        { zh: "膝蓋骨脫位", en: "Patellar luxation", species: "dog", freq: "common", category: "骨科", urgency: "non-urgent",
          detail: "小型犬好發內側脫位。間歇性跛行、跳躍步態。",
          workup: ["觸診", "膝關節 X 光"] },
        { zh: "骨折", en: "Fracture", species: "both", freq: "common", category: "骨科", urgency: "urgent",
          detail: "急性嚴重跛行，外傷史。",
          workup: ["X 光（含對側比較）"] },
        { zh: "骨腫瘤", en: "Bone neoplasia", species: "dog", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "骨肉瘤好發大型犬的長骨遠端/近端。進行性跛行、疼痛腫脹。",
          workup: ["X 光（溶骨性病灶）", "胸腔 X 光（轉移）", "切片"] },
        { zh: "免疫介導性多發性關節炎", en: "Immune-mediated polyarthritis (IMPA)", species: "both", freq: "uncommon", category: "免疫", urgency: "urgent",
          detail: "多關節腫脹、疼痛、發燒。可能找不到感染原因。",
          workup: ["關節液分析（多關節）", "ANA", "RF"] },
        { zh: "全骨炎", en: "Panosteitis", species: "dog", freq: "uncommon", category: "骨科", urgency: "non-urgent",
          detail: "青年大型犬的自限性骨炎。「遊走性跛行」，輪流影響不同肢。",
          workup: ["長骨 X 光（骨內密度增加）"] },
        { zh: "肘關節發育不良", en: "Elbow dysplasia", species: "dog", freq: "common", category: "骨科", urgency: "semi-urgent", detail: "大型犬幼年期前肢跛行最常見原因之一。包含冠突內側疾病、UAP、OCD。", workup: ["X光", "CT（更敏感）", "關節鏡"] },
        { zh: "離散性骨軟骨炎", en: "Osteochondritis dissecans (OCD)", species: "dog", freq: "uncommon", category: "骨科", urgency: "semi-urgent", detail: "年輕大型犬（4-9月齡）。肩關節最常見，也可影響肘、膝、跗關節。", workup: ["X光", "CT/MRI", "關節鏡"] }
      ]
    },
    {
      id: "seizures",
      zhName: "癲癇發作",
      enName: "Seizures",
      section: "1.5",
      sectionName: "神經系統",
      description: "大腦皮質異常放電導致的陣發性、非自主性活動。需記錄發作型態、持續時間、頻率、發作前後行為。",
      differentials: [
        { zh: "原發性（特發性）癲癇", en: "Idiopathic epilepsy", species: "dog", freq: "common", category: "神經", urgency: "semi-urgent",
          detail: "排除性診斷。通常 1-5 歲間首次發作。發作間期神經學檢查正常。某些品種好發。",
          workup: ["完整血液學/生化排除代謝原因", "腦部 MRI", "腦脊髓液（正常）"] },
        { zh: "顱內腫瘤", en: "Intracranial neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent",
          detail: "老年動物首次癲癇發作需高度懷疑。腦膜瘤（犬貓）、膠質瘤（犬）。",
          workup: ["腦部 MRI（增強）", "腦脊髓液"] },
        { zh: "腦炎", en: "Encephalitis", species: "both", freq: "uncommon", category: "感染/免疫", urgency: "urgent",
          detail: "感染性（犬瘟熱、FIP、弓形蟲）或免疫介導性（GME、NME、NLE）。",
          workup: ["腦脊髓液", "腦部 MRI", "感染篩檢"] },
        { zh: "肝性腦病", en: "Hepatic encephalopathy", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "肝功能不全（PSS 或嚴重肝病）導致氨等毒素蓄積。餐後加重。",
          workup: ["膽汁酸", "血氨", "肝臟超音波"] },
        { zh: "低血糖", en: "Hypoglycaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "胰島素瘤、肝病、敗血症、幼犬。",
          workup: ["血糖", "胰島素"] },
        { zh: "中毒", en: "Toxin exposure", species: "both", freq: "uncommon", category: "中毒", urgency: "urgent",
          detail: "鼠藥（metaldehyde、bromethalin）、鉛、有機磷、木糖醇等。",
          workup: ["暴露史", "毒物篩檢"] },
        { zh: "腦血管事件", en: "Cerebrovascular accident (Stroke)", species: "both", freq: "uncommon", category: "神經", urgency: "emergency",
          detail: "急性發作的不對稱神經缺損。梗塞或出血。",
          workup: ["腦部 MRI"] },
        { zh: "先天性腦部異常", en: "Congenital brain malformation", species: "both", freq: "rare", category: "神經", urgency: "semi-urgent",
          detail: "水腦症、平腦症等。幼年動物。",
          workup: ["腦部 MRI/CT", "超音波（開放囟門）"] },
        { zh: "門脈系統分流 (PSS)", en: "Portosystemic shunt (PSS)", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent",
          detail: "先天性或後天性。幼年動物餐後癲癇發作高度懷疑。與肝性腦病相關但需獨立考慮。",
          workup: ["膽汁酸（餐前餐後）", "血氨", "肝臟超音波", "CT 血管攝影"] },
        { zh: "低血鈣", en: "Hypocalcaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "emergency", detail: "子癇（哺乳母犬/貓）、副甲狀腺低下、PLE。顏面抽搐→全身癲癇。可治療病因。", workup: ["離子鈣", "PTH", "總鈣", "白蛋白"] }
      ]
    },
    {
      id: "polyarthritis",
      zhName: "多發性關節炎/關節腫脹",
      enName: "Polyarthritis",
      section: "1.7",
      sectionName: "肌肉骨骼",
      description: "多個關節同時出現發炎、腫脹、疼痛。可為感染性或非感染性（免疫介導性）。",
      differentials: [
        { zh: "免疫介導性多發性關節炎", en: "Immune-mediated polyarthritis (IMPA)", species: "both", freq: "common", category: "免疫", urgency: "urgent",
          detail: "最常見的多關節炎原因。發燒、多關節疼痛腫脹、跛行。",
          workup: ["多關節關節液分析", "ANA", "血液培養（排除感染）"] },
        { zh: "系統性紅斑狼瘡", en: "Systemic lupus erythematosus (SLE)", species: "dog", freq: "rare", category: "免疫", urgency: "urgent",
          detail: "多系統自體免疫疾病，關節炎為常見表現之一。",
          workup: ["ANA", "Coombs", "UPC", "關節液"] },
        { zh: "感染性關節炎", en: "Septic arthritis", species: "both", freq: "uncommon", category: "感染", urgency: "urgent",
          detail: "細菌（最常見）、黴菌、萊姆病。通常單關節但可多關節。",
          workup: ["關節液（培養、細胞學）", "萊姆病篩檢"] },
        { zh: "藥物反應", en: "Drug-induced / Iatrogenic", species: "both", freq: "rare", category: "其他", urgency: "non-urgent",
          detail: "某些藥物可引起關節炎樣反應。",
          workup: ["用藥史", "停藥後觀察"] }
      ]
    },
    {
      id: "gagging",
      zhName: "乾嘔/作嘔",
      enName: "Gagging / Retching",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "反覆作嘔但未產生嘔吐物。需與真正的嘔吐及咳嗽區分。可能涉及咽喉、食道或呼吸道疾病。",
      differentials: [
        { zh: "咽喉炎", en: "Pharyngitis / Laryngitis", species: "both", freq: "common", category: "感染/發炎", urgency: "non-urgent", detail: "咽喉發炎為最常見原因之一。可能繼發於上呼吸道感染。", workup: ["口咽檢查（需鎮靜）", "喉鏡檢查"] },
        { zh: "鼻咽息肉", en: "Nasopharyngeal polyp", species: "cat", freq: "common", category: "感染/發炎", urgency: "semi-urgent", detail: "貓常見，從中耳或耳咽管長出的息肉，造成呼吸及吞嚥困難。", workup: ["口咽檢查", "耳鏡", "頭部 X 光/CT"] },
        { zh: "喉頭麻痺", en: "Laryngeal paralysis", species: "dog", freq: "common", category: "神經", urgency: "urgent", detail: "老年大型犬好發。聲帶無法外展導致吸氣性喘鳴及作嘔。", workup: ["喉鏡檢查（輕度鎮靜下）", "胸腔 X 光"] },
        { zh: "咽喉異物", en: "Pharyngeal foreign body", species: "both", freq: "common", category: "物理性", urgency: "urgent", detail: "骨頭、魚刺、木棒碎片等卡在咽喉。急性發作。", workup: ["口咽檢查", "X 光", "內視鏡"] },
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "urgent", detail: "神經肌肉接合處自體免疫疾病，影響吞嚥功能。", workup: ["AChR 抗體", "Edrophonium 試驗", "胸腔 X 光（排除胸腺瘤）"] },
        { zh: "呼吸道疾病（咳痰）", en: "Respiratory disease (expectoration)", species: "both", freq: "common", category: "呼吸", urgency: "semi-urgent", detail: "支氣管炎、肺水腫等導致咳痰後作嘔。", workup: ["胸腔 X 光", "支氣管鏡"] },
        { zh: "腫瘤", en: "Neoplasia (pharyngeal/tonsillar)", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent", detail: "咽喉或扁桃腺腫瘤造成機械性阻塞。", workup: ["口咽檢查", "細胞學/切片", "CT"] }
      ]
    },
    {
      id: "dysphagia",
      zhName: "吞嚥困難",
      enName: "Dysphagia",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "進食或飲水時出現吞嚥困難。可分為口腔期、咽期及食道期吞嚥困難。",
      differentials: [
        { zh: "口腔疾病", en: "Oral disease", species: "both", freq: "common", category: "口腔", urgency: "non-urgent", detail: "牙周病、嚴重齒齦炎、口腔潰瘍等造成進食疼痛。", workup: ["口腔檢查（需鎮靜）", "口腔 X 光"] },
        { zh: "異物阻塞", en: "Foreign body obstruction", species: "both", freq: "common", category: "物理性", urgency: "urgent", detail: "口腔、咽喉或食道異物。急性發作。", workup: ["口腔/咽喉檢查", "X 光", "內視鏡"] },
        { zh: "口腔腫瘤", en: "Oral / pharyngeal neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "口腔或咽喉腫瘤造成機械性阻塞或疼痛。", workup: ["口腔檢查", "細胞學/切片", "CT"] },
        { zh: "咀嚼肌炎", en: "Masticatory myositis", species: "dog", freq: "uncommon", category: "免疫", urgency: "urgent", detail: "咀嚼肌自體免疫性發炎，無法張口或閉口疼痛。", workup: ["2M 抗體", "肌肉切片", "CK"] },
        { zh: "三叉神經疾病", en: "Trigeminal nerve disease", species: "both", freq: "uncommon", category: "神經", urgency: "urgent", detail: "三叉神經炎導致下顎下垂（dropped jaw），無法閉口。", workup: ["神經學檢查", "腦部 MRI"] },
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "urgent", detail: "影響咽喉肌肉導致吞嚥障礙。可能伴隨巨食道。", workup: ["AChR 抗體", "Edrophonium 試驗"] },
        { zh: "顳下顎關節疾病", en: "Temporomandibular joint disease", species: "both", freq: "uncommon", category: "骨關節", urgency: "non-urgent", detail: "關節炎、脫臼或骨折影響張口閉口。", workup: ["頭部 X 光", "CT"] },
        { zh: "狂犬病", en: "Rabies", species: "both", freq: "rare", category: "感染", urgency: "emergency", detail: "流行區域需考慮。咽喉肌肉麻痺導致吞嚥困難。", workup: ["病史（咬傷史）", "法定通報"] }
      ]
    },
    {
      id: "regurgitation",
      zhName: "反流/逆流",
      enName: "Regurgitation",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "被動地將未消化食物從食道排出，不伴隨腹部用力。需與嘔吐區分：反流無前兆噁心，食物未消化且多為管狀。",
      differentials: [
        { zh: "巨食道", en: "Megaoesophagus", species: "both", freq: "common", category: "食道", urgency: "urgent", detail: "食道擴張失去蠕動功能。先天性或後天性。後天性需排除重症肌無力。", workup: ["胸腔 X 光", "鋇劑攝影", "AChR 抗體"] },
        { zh: "食道異物", en: "Oesophageal foreign body", species: "both", freq: "common", category: "物理性", urgency: "urgent", detail: "骨頭、玩具等卡在食道。急性發作，可能造成食道穿孔。", workup: ["胸腔 X 光", "內視鏡"] },
        { zh: "食道炎", en: "Oesophagitis", species: "both", freq: "common", category: "發炎", urgency: "semi-urgent", detail: "麻醉後胃酸逆流、誤食腐蝕性物質、慢性嘔吐等原因。", workup: ["內視鏡", "食道切片"] },
        { zh: "食道狹窄", en: "Oesophageal stricture", species: "both", freq: "uncommon", category: "食道", urgency: "semi-urgent", detail: "食道炎癒合後纖維化導致管腔狹窄。", workup: ["鋇劑攝影", "內視鏡"] },
        { zh: "血管環異常", en: "Vascular ring anomaly (PRAA)", species: "dog", freq: "uncommon", category: "先天性", urgency: "urgent", detail: "持續性右主動脈弓等先天異常壓迫食道。斷奶後開始出現症狀。", workup: ["胸腔 X 光（含鋇劑）", "CT 血管攝影"] },
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "urgent", detail: "局灶型重症肌無力可僅影響食道肌肉，導致巨食道。", workup: ["AChR 抗體", "Edrophonium 試驗"] },
        { zh: "甲狀腺低下", en: "Hypothyroidism", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent", detail: "可能繼發巨食道或食道運動障礙。", workup: ["Total T4", "Free T4", "TSH"] },
        { zh: "食道腫瘤", en: "Oesophageal neoplasia", species: "both", freq: "rare", category: "腫瘤", urgency: "urgent", detail: "原發性食道腫瘤較罕見，轉移性壓迫較常見。", workup: ["內視鏡＋切片", "CT"] }
      ]
    },
    {
      id: "melaena",
      zhName: "黑便",
      enName: "Melaena",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "排出黑色柏油狀糞便，代表上消化道（胃或小腸前段）出血。血液經胃酸消化後變黑。",
      differentials: [
        { zh: "胃腸道潰瘍", en: "GI ulceration (NSAIDs/steroids)", species: "both", freq: "common", category: "消化道", urgency: "urgent", detail: "最常見原因。NSAIDs 及類固醇為主要藥物誘因。也見於壓力性潰瘍及尿毒症。", workup: ["用藥史", "內視鏡", "BUN/Cre"] },
        { zh: "胃腸道腫瘤", en: "GI neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腺癌、淋巴瘤、平滑肌瘤/肉瘤等。", workup: ["腹部超音波", "內視鏡＋切片"] },
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "common", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒（老鼠藥）、DIC、血小板減少症、von Willebrand 病等。", workup: ["PT/aPTT", "血小板計數", "BMBT"] },
        { zh: "胃炎/腸炎", en: "Gastritis / Enteritis", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "急性或慢性胃腸道發炎可導致黏膜出血。", workup: ["糞便檢查", "內視鏡"] },
        { zh: "腸道寄生蟲", en: "Intestinal parasites", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "鉤蟲等吸血性寄生蟲。幼年動物尤其常見。", workup: ["糞便浮游法"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "uncommon", category: "肝膽", urgency: "semi-urgent", detail: "肝病導致凝血因子合成不足或門脈高壓。", workup: ["肝指數", "膽汁酸", "PT/aPTT"] },
        { zh: "吞嚥血液", en: "Swallowed blood", species: "both", freq: "common", category: "其他", urgency: "non-urgent", detail: "鼻出血、口腔出血或呼吸道出血被吞下後造成黑便假象。", workup: ["口腔/鼻腔檢查"] },
        { zh: "休克/敗血症", en: "Shock", species: "both", freq: "uncommon", category: "多系統", urgency: "emergency", detail: "黏膜灌流不足導致胃腸道缺血性損傷。", workup: ["血壓", "乳酸", "血液培養"] }
      ]
    },
    {
      id: "haematemesis",
      zhName: "吐血",
      enName: "Haematemesis",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "嘔吐物含血。鮮血代表近期活動性出血；咖啡渣樣（digested blood）代表血液已被胃酸部分消化。",
      differentials: [
        { zh: "胃腸道潰瘍", en: "GI ulceration", species: "both", freq: "common", category: "消化道", urgency: "urgent", detail: "NSAIDs、類固醇、壓力、尿毒症等引起。胃十二指腸潰瘍為主要來源。", workup: ["內視鏡", "用藥史", "BUN/Cre"] },
        { zh: "胃腸道腫瘤", en: "GI neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腺癌、淋巴瘤等侵蝕血管。", workup: ["腹部超音波", "內視鏡＋切片"] },
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "common", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒、DIC、血小板減少等。", workup: ["PT/aPTT", "血小板計數"] },
        { zh: "出血性胃腸炎", en: "Haemorrhagic gastroenteritis (HGE)", species: "dog", freq: "common", category: "消化道", urgency: "urgent", detail: "急性血性嘔吐與腹瀉，PCV 急劇升高。小型犬好發。", workup: ["CBC（PCV）", "糞便檢查", "電解質"] },
        { zh: "胃炎", en: "Gastritis", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "急性或慢性胃炎伴黏膜糜爛出血。", workup: ["內視鏡＋切片"] },
        { zh: "異物（胃擴張/扭轉後）", en: "Post GDV / Foreign body", species: "dog", freq: "common", category: "消化道", urgency: "emergency", detail: "胃擴張扭轉後胃壁缺血壞死導致出血。", workup: ["腹部 X 光", "腹部超音波"] },
        { zh: "全身性肥大細胞增生", en: "Systemic mastocytosis", species: "both", freq: "rare", category: "腫瘤", urgency: "urgent", detail: "組織胺過量刺激胃酸分泌，導致胃潰瘍。", workup: ["肥大細胞腫瘤篩檢", "胃鏡"] }
      ]
    },
    {
      id: "haematochezia",
      zhName: "血便（鮮血便）",
      enName: "Haematochezia",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "糞便中含鮮紅色血液，表示下消化道（結腸、直腸、肛門區域）出血。",
      differentials: [
        { zh: "結腸炎", en: "Colitis", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "急性或慢性結腸發炎，常伴黏液便及裏急後重。", workup: ["糞便檢查", "結腸鏡＋切片"] },
        { zh: "腸道寄生蟲", en: "Intestinal parasites", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "鞭蟲、鉤蟲等大腸寄生蟲。", workup: ["糞便浮游法"] },
        { zh: "肛周疾病", en: "Perianal disease", species: "both", freq: "common", category: "肛門/直腸", urgency: "non-urgent", detail: "肛門腺疾病、肛門瘻管、肛周腫瘤、直腸脫垂等。", workup: ["肛門/直腸檢查"] },
        { zh: "炎症性腸病", en: "Inflammatory bowel disease (IBD)", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "慢性免疫介導性腸道發炎。", workup: ["結腸鏡＋切片", "Cobalamin/Folate"] },
        { zh: "結直腸腫瘤", en: "Colorectal neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent", detail: "腺瘤性息肉、腺癌、淋巴瘤等。", workup: ["結腸鏡＋切片", "腹部超音波"] },
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "uncommon", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒、DIC、血小板疾病。", workup: ["PT/aPTT", "血小板計數"] },
        { zh: "腸套疊", en: "Intussusception", species: "both", freq: "common", category: "消化道", urgency: "urgent", detail: "腸段套入鄰近腸段，幼年動物常見。可能伴隨嘔吐、腹痛。", workup: ["腹部超音波", "腹部 X 光"] },
        { zh: "出血性胃腸炎", en: "Haemorrhagic gastroenteritis (HGE)", species: "dog", freq: "common", category: "消化道", urgency: "urgent", detail: "急性血性腹瀉，小型犬好發。", workup: ["CBC", "電解質"] }
      ]
    },
    {
      id: "constipation",
      zhName: "便秘/糞便嵌塞",
      enName: "Constipation / Obstipation",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "排便困難或無法排便。Obstipation 指嚴重的頑固性便秘。貓比犬更常見。",
      differentials: [
        { zh: "特發性巨結腸", en: "Idiopathic megacolon", species: "cat", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "貓最常見的便秘原因。結腸平滑肌功能障礙。", workup: ["腹部 X 光", "直腸檢查"] },
        { zh: "骨盆骨折後狹窄", en: "Pelvic fracture narrowing", species: "both", freq: "common", category: "骨科", urgency: "non-urgent", detail: "骨盆骨折癒合後骨盆腔狹窄，壓迫結腸。", workup: ["骨盆 X 光"] },
        { zh: "異物/飲食不當", en: "Foreign material / Diet", species: "both", freq: "common", category: "飲食", urgency: "non-urgent", detail: "吞食骨頭、毛髮、異物。低纖維飲食。", workup: ["飲食史", "腹部 X 光"] },
        { zh: "前列腺疾病", en: "Prostatic disease", species: "dog", freq: "common", category: "泌尿生殖", urgency: "semi-urgent", detail: "前列腺腫大壓迫直腸（良性增生、膿瘍、腫瘤）。", workup: ["直腸觸診", "腹部超音波"] },
        { zh: "腰薦椎疾病", en: "Lumbosacral disease", species: "both", freq: "common", category: "神經", urgency: "semi-urgent", detail: "影響排便神經支配。", workup: ["神經學檢查", "腰薦椎 X 光/MRI"] },
        { zh: "肛門/直腸疼痛", en: "Anal/rectal pain", species: "both", freq: "common", category: "肛門/直腸", urgency: "non-urgent", detail: "肛門腺炎、肛門瘻管、直腸腫瘤等導致排便疼痛性抑制。", workup: ["肛門/直腸檢查"] },
        { zh: "甲狀腺低下", en: "Hypothyroidism", species: "dog", freq: "common", category: "內分泌", urgency: "semi-urgent", detail: "代謝率降低導致腸道蠕動減慢。", workup: ["Total T4", "Free T4", "TSH"] },
        { zh: "藥物引起", en: "Drug-induced / Iatrogenic", species: "both", freq: "uncommon", category: "其他", urgency: "non-urgent", detail: "鴉片類、抗膽鹼藥、鋁制酸劑等。", workup: ["用藥史"] },
        { zh: "脫水", en: "Dehydration", species: "both", freq: "common", category: "多系統", urgency: "non-urgent", detail: "水分攝取不足或流失過多。", workup: ["理學檢查", "電解質"] }
      ]
    },
    {
      id: "faecal-tenesmus",
      zhName: "排便裏急後重",
      enName: "Faecal Tenesmus / Dyschezia",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "排便時持續用力但排出量少或無法排出。常伴隨疼痛表現。需與泌尿系統的裏急後重區分。",
      differentials: [
        { zh: "肛門腺疾病", en: "Anal sac disease", species: "both", freq: "common", category: "肛門/直腸", urgency: "non-urgent", detail: "肛門腺炎、膿瘍、嵌塞為最常見原因。", workup: ["肛門腺觸診與表達"] },
        { zh: "結直腸疾病", en: "Colorectal disease (colitis, neoplasia)", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "結腸炎、直腸息肉、腫瘤、異物等。", workup: ["直腸檢查", "結腸鏡"] },
        { zh: "肛門瘻管", en: "Anal furunculosis / Perianal fistula", species: "dog", freq: "common", category: "肛門/直腸", urgency: "semi-urgent", detail: "德國牧羊犬好發。肛周深部竇道及潰瘍。", workup: ["肛周視診", "鎮靜下檢查"] },
        { zh: "會陰疝", en: "Perineal hernia", species: "dog", freq: "common", category: "外科", urgency: "semi-urgent", detail: "骨盆膈肌無力導致直腸偏位。未絕育公犬好發。", workup: ["肛周觸診", "超音波"] },
        { zh: "前列腺疾病", en: "Prostatic disease", species: "dog", freq: "common", category: "泌尿生殖", urgency: "semi-urgent", detail: "腫大的前列腺壓迫直腸。", workup: ["直腸觸診", "超音波"] },
        { zh: "便秘/糞便嵌塞", en: "Constipation / Obstipation", species: "both", freq: "common", category: "消化道", urgency: "non-urgent", detail: "糞便過硬或腸道阻塞。", workup: ["腹部 X 光", "直腸檢查"] },
        { zh: "骨盆骨折", en: "Pelvic fracture", species: "both", freq: "uncommon", category: "骨科", urgency: "urgent", detail: "急性骨折疼痛或癒合後骨盆腔狹窄。", workup: ["骨盆 X 光"] }
      ]
    },
    {
      id: "faecal-incontinence",
      zhName: "糞便失禁",
      enName: "Faecal Incontinence",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "無法控制排便。可分為肛門括約肌功能不全及儲存型失禁。",
      differentials: [
        { zh: "腰薦椎疾病", en: "Lumbosacral disease", species: "both", freq: "common", category: "神經", urgency: "semi-urgent", detail: "腰薦椎狹窄、椎間盤疾病壓迫馬尾神經。", workup: ["神經學檢查", "腰薦椎 MRI"] },
        { zh: "退化性脊髓病", en: "Degenerative myelopathy (CDRM)", species: "dog", freq: "common", category: "神經", urgency: "semi-urgent", detail: "大型犬好發，進行性後肢無力伴排便控制喪失。", workup: ["神經學檢查", "MRI（排除其他）", "SOD1 基因檢測"] },
        { zh: "肛門括約肌損傷", en: "Anal sphincter damage", species: "both", freq: "common", category: "外科/創傷", urgency: "non-urgent", detail: "外傷、手術（肛門腺摘除術）後損傷。", workup: ["肛門反射", "肛門觸診"] },
        { zh: "結腸炎", en: "Colitis", species: "both", freq: "common", category: "消化道", urgency: "semi-urgent", detail: "急迫性腹瀉導致儲存型失禁。", workup: ["糞便檢查", "結腸鏡"] },
        { zh: "肛周疾病", en: "Perianal disease", species: "both", freq: "uncommon", category: "肛門/直腸", urgency: "semi-urgent", detail: "肛門瘻管或腫瘤破壞括約肌。", workup: ["肛周檢查"] },
        { zh: "脊髓疾病", en: "Spinal cord disease", species: "both", freq: "uncommon", category: "神經", urgency: "urgent", detail: "椎間盤突出、脊髓腫瘤、外傷等影響排便控制。", workup: ["神經學檢查", "脊椎 MRI"] }
      ]
    },
    {
      id: "flatulence",
      zhName: "脹氣/腸鳴音",
      enName: "Flatulence / Borborygmus",
      section: "1.2",
      sectionName: "消化道／腹腔",
      description: "排氣增加或腸蠕動音增強。常與飲食或消化功能相關。",
      differentials: [
        { zh: "飲食因素", en: "Dietary factors", species: "both", freq: "common", category: "飲食", urgency: "non-urgent", detail: "高纖維飲食、乳製品（乳糖不耐）、變質食物。最常見原因。", workup: ["飲食史", "飲食試驗"] },
        { zh: "吞氣症", en: "Aerophagia", species: "both", freq: "common", category: "行為", urgency: "non-urgent", detail: "競爭性進食、緊張的動物進食過快吞入大量空氣。", workup: ["觀察進食行為"] },
        { zh: "胰外分泌功能不足", en: "Exocrine pancreatic insufficiency (EPI)", species: "both", freq: "uncommon", category: "消化", urgency: "non-urgent", detail: "消化酶不足導致食物發酵產氣。", workup: ["TLI"] },
        { zh: "炎症性腸病", en: "Inflammatory bowel disease (IBD)", species: "both", freq: "common", category: "消化", urgency: "semi-urgent", detail: "慢性腸道發炎影響消化吸收，食物發酵。", workup: ["腸道切片", "Cobalamin/Folate"] },
        { zh: "小腸細菌過度增生", en: "Small intestinal bacterial overgrowth", species: "both", freq: "uncommon", category: "消化", urgency: "non-urgent", detail: "異常細菌發酵產生過多氣體。", workup: ["Cobalamin/Folate", "經驗性抗生素試驗"] }
      ]
    },
    {
      id: "sneezing",
      zhName: "噴嚏/鼻分泌物",
      enName: "Sneezing / Nasal Discharge",
      section: "1.3",
      sectionName: "心血管／呼吸",
      description: "反覆打噴嚏及/或鼻腔分泌物（漿液性、黏液性、膿性或血性）。需區分單側或雙側。",
      differentials: [
        { zh: "上呼吸道感染", en: "Upper respiratory infection", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "犬：犬瘟熱、犬傳染性支氣管炎。貓：疱疹病毒、杯狀病毒、披衣菌。", workup: ["PCR 病原檢測", "分泌物培養"] },
        { zh: "鼻腔異物", en: "Nasal foreign body", species: "both", freq: "common", category: "物理性", urgency: "urgent", detail: "草芒、植物碎片等。通常急性發作、單側。", workup: ["鼻鏡", "鼻腔 X 光/CT"] },
        { zh: "鼻腔腫瘤", en: "Nasal neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腺癌、鱗狀細胞癌、淋巴瘤等。中老年動物，常單側漸進為雙側。", workup: ["鼻腔 CT", "鼻鏡＋切片"] },
        { zh: "黴菌性鼻炎", en: "Fungal rhinitis (Aspergillosis)", species: "dog", freq: "uncommon", category: "感染", urgency: "semi-urgent", detail: "麴菌感染，犬常見。慢性鼻分泌物伴鼻甲骨破壞。", workup: ["鼻腔 CT", "鼻鏡（菌斑）", "血清學"] },
        { zh: "過敏性鼻炎", en: "Allergic rhinitis", species: "both", freq: "common", category: "免疫", urgency: "non-urgent", detail: "對環境過敏原的鼻腔反應。漿液性分泌物。", workup: ["排除其他原因", "過敏原檢測"] },
        { zh: "牙根膿瘍", en: "Tooth root abscess", species: "both", freq: "common", category: "口腔", urgency: "semi-urgent", detail: "上顎牙根感染穿透鼻腔底部，造成口鼻瘻管。單側膿性鼻分泌物。", workup: ["口腔 X 光", "口腔檢查"] },
        { zh: "淋巴漿細胞性鼻炎", en: "Lymphoplasmacytic rhinitis", species: "both", freq: "common", category: "發炎", urgency: "non-urgent", detail: "慢性特發性鼻炎，排除其他原因後診斷。", workup: ["鼻腔 CT", "切片"] },
        { zh: "鼻咽息肉", en: "Nasopharyngeal polyp", species: "cat", freq: "common", category: "發炎", urgency: "semi-urgent", detail: "貓常見。從中耳或耳咽管長入鼻咽。", workup: ["口咽檢查", "耳鏡", "CT"] }
      ]
    },
    {
      id: "epistaxis",
      zhName: "鼻出血",
      enName: "Epistaxis",
      section: "1.3",
      sectionName: "心血管／呼吸",
      description: "鼻腔出血。需區分單側（多為局部病因）或雙側（可能為全身性凝血問題）。",
      differentials: [
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "common", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒（老鼠藥）、DIC、血小板減少、von Willebrand 病。雙側鼻出血需優先排除。", workup: ["PT/aPTT", "血小板計數", "BMBT", "von Willebrand 因子"] },
        { zh: "鼻腔腫瘤", en: "Nasal neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腺癌、鱗狀細胞癌、軟骨肉瘤等。中老年，可能單側。", workup: ["鼻腔 CT", "鼻鏡＋切片"] },
        { zh: "鼻腔感染", en: "Nasal infection", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "細菌、黴菌（麴菌）感染破壞黏膜。", workup: ["鼻腔 CT", "培養", "鼻鏡"] },
        { zh: "外傷", en: "Trauma", species: "both", freq: "common", category: "創傷", urgency: "urgent", detail: "頭部創傷、異物。", workup: ["頭部 X 光/CT"] },
        { zh: "高血壓", en: "Systemic hypertension", species: "both", freq: "uncommon", category: "心血管", urgency: "semi-urgent", detail: "全身性高血壓導致鼻腔微血管破裂。貓 CKD 常見併發症。", workup: ["血壓測量", "BUN/Cre"] },
        { zh: "牙根膿瘍", en: "Tooth root abscess", species: "both", freq: "common", category: "口腔", urgency: "semi-urgent", detail: "上顎牙根感染穿透至鼻腔。", workup: ["口腔 X 光"] },
        { zh: "血管肉瘤（Angiostrongylus）", en: "Angiostrongylus vasorum", species: "dog", freq: "uncommon", category: "感染", urgency: "urgent", detail: "肺蟲感染可導致凝血障礙及鼻出血。", workup: ["Baermann 法", "抗原檢測"] },
        { zh: "血小板疾病", en: "Platelet disorders", species: "both", freq: "uncommon", category: "血液", urgency: "urgent", detail: "免疫介導性血小板減少（IMTP）為犬最常見後天性血小板減少原因。", workup: ["CBC", "血小板計數", "骨髓檢查"] }
      ]
    },
    {
      id: "haemoptysis",
      zhName: "咳血",
      enName: "Haemoptysis",
      section: "1.3",
      sectionName: "心血管／呼吸",
      description: "咳出含血的分泌物。需與吐血及鼻出血區分。代表下呼吸道或肺實質出血。",
      differentials: [
        { zh: "肺腫瘤", en: "Pulmonary neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "原發性肺腫瘤或轉移性腫瘤。", workup: ["胸腔 X 光", "CT", "支氣管鏡＋灌洗"] },
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "common", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒、DIC、血小板疾病。", workup: ["PT/aPTT", "血小板計數"] },
        { zh: "肺炎", en: "Pneumonia", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "細菌性、黴菌性肺炎伴肺實質出血。", workup: ["胸腔 X 光", "支氣管灌洗＋培養"] },
        { zh: "肺水腫", en: "Pulmonary oedema", species: "both", freq: "common", category: "心血管", urgency: "urgent", detail: "心因性（左心衰竭）或非心因性肺水腫。可能咳出粉紅色泡沫痰。", workup: ["胸腔 X 光", "心臟超音波", "NT-proBNP"] },
        { zh: "肺蟲感染", en: "Lungworm (Angiostrongylus/Aelurostrongylus)", species: "both", freq: "uncommon", category: "感染", urgency: "semi-urgent", detail: "犬：Angiostrongylus vasorum。貓：Aelurostrongylus abstrusus。", workup: ["Baermann 法", "抗原檢測", "糞便檢查"] },
        { zh: "肺部栓塞", en: "Pulmonary thromboembolism", species: "both", freq: "uncommon", category: "心血管", urgency: "emergency", detail: "血栓阻塞肺血管導致肺梗塞出血。常繼發於其他疾病。", workup: ["CT 血管攝影", "D-dimer"] },
        { zh: "外傷", en: "Trauma (pulmonary contusion)", species: "both", freq: "common", category: "創傷", urgency: "urgent", detail: "胸部撞擊傷導致肺挫傷出血。", workup: ["胸腔 X 光"] }
      ]
    },
    {
      id: "exercise-intolerance",
      zhName: "運動不耐",
      enName: "Exercise Intolerance",
      section: "1.3",
      sectionName: "心血管／呼吸",
      description: "運動能力下降，容易疲累。可能與心血管、呼吸、代謝或神經肌肉疾病相關。",
      differentials: [
        { zh: "充血性心衰竭", en: "Congestive heart failure (CHF)", species: "both", freq: "common", category: "心血管", urgency: "urgent", detail: "心輸出量不足無法應付運動需求。犬：瓣膜疾病、DCM。貓：HCM。", workup: ["心臟超音波", "胸腔 X 光", "NT-proBNP"] },
        { zh: "心律不整", en: "Cardiac arrhythmia", species: "both", freq: "common", category: "心血管", urgency: "urgent", detail: "運動時心律不整加重，導致心輸出量不穩定。", workup: ["心電圖", "Holter 監測"] },
        { zh: "呼吸道疾病", en: "Respiratory disease", species: "both", freq: "common", category: "呼吸", urgency: "semi-urgent", detail: "上呼吸道阻塞（喉麻痺、氣管塌陷）、胸腔積液、肺纖維化等。", workup: ["胸腔 X 光", "喉鏡", "支氣管鏡"] },
        { zh: "貧血", en: "Anaemia", species: "both", freq: "common", category: "血液", urgency: "semi-urgent", detail: "氧氣運輸能力下降。", workup: ["CBC", "網織紅血球計數"] },
        { zh: "甲狀腺低下", en: "Hypothyroidism", species: "dog", freq: "common", category: "內分泌", urgency: "non-urgent", detail: "代謝率降低、肌肉無力。", workup: ["Total T4", "Free T4", "TSH"] },
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "semi-urgent", detail: "運動後肌肉疲勞加重，休息後改善。", workup: ["AChR 抗體", "Edrophonium 試驗"] },
        { zh: "肌肉病變", en: "Myopathy", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "semi-urgent", detail: "先天性或後天性肌肉病變（多發性肌炎等）。", workup: ["CK", "肌電圖", "肌肉切片"] },
        { zh: "愛迪生氏症", en: "Hypoadrenocorticism (Addison's)", species: "dog", freq: "uncommon", category: "內分泌", urgency: "urgent", detail: "間歇性虛弱，壓力時惡化。典型型有電解質異常；非典型(atypical)僅皮質醇缺乏，電解質正常。", workup: ["電解質", "ACTH 刺激試驗"] },
        { zh: "肺動脈高壓", en: "Pulmonary hypertension", species: "both", freq: "uncommon", category: "心血管", urgency: "urgent", detail: "肺動脈壓力升高導致右心負荷增加。", workup: ["心臟超音波（三尖瓣反流速度）"] }
      ]
    },
    {
      id: "trembling",
      zhName: "顫抖/發抖",
      enName: "Trembling / Shivering",
      section: "1.5",
      sectionName: "神經系統",
      description: "不自主的節律性肌肉運動。需與癲癇發作區分。可為生理性（寒冷、恐懼）或病理性。",
      differentials: [
        { zh: "生理性（寒冷/恐懼）", en: "Physiological (cold/fear)", species: "both", freq: "common", category: "生理", urgency: "non-urgent", detail: "最常見原因。低溫環境、疼痛、恐懼或焦慮。", workup: ["環境與行為評估"] },
        { zh: "疼痛", en: "Pain", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent", detail: "任何來源的疼痛均可導致顫抖。", workup: ["完整理學檢查", "疼痛評估"] },
        { zh: "中毒", en: "Toxin exposure", species: "both", freq: "common", category: "中毒", urgency: "urgent", detail: "有機磷、除蟲菊、巧克力/咖啡因、蝸牛藥（metaldehyde）、馬錢子鹼等。", workup: ["中毒史", "相應毒物檢測"] },
        { zh: "低血糖", en: "Hypoglycaemia", species: "both", freq: "common", category: "代謝", urgency: "urgent", detail: "幼年動物、胰島素瘤、愛迪生氏症。", workup: ["血糖"] },
        { zh: "低血鈣", en: "Hypocalcaemia", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent", detail: "產後低血鈣（子癇）、副甲狀腺低下。", workup: ["離子鈣", "PTH"] },
        { zh: "小腦疾病", en: "Cerebellar disease", species: "both", freq: "uncommon", category: "神經", urgency: "semi-urgent", detail: "小腦損傷導致意向性震顫（movement時加重）。", workup: ["神經學檢查", "腦部 MRI"] },
        { zh: "白狗搖擺症候群", en: "Corticosteroid-responsive tremor syndrome", species: "dog", freq: "uncommon", category: "神經", urgency: "semi-urgent", detail: "又稱白狗搖擺病。全身性震顫，好發小型白色犬但任何犬種可發生。類固醇反應良好。", workup: ["神經學檢查", "腦脊髓液分析", "MRI"] },
        { zh: "肝性腦病", en: "Hepatic encephalopathy", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent", detail: "肝功能不全導致氨等毒素蓄積。", workup: ["膽汁酸", "血氨", "肝臟超音波"] }
      ]
    },
    {
      id: "ataxia",
      zhName: "共濟失調",
      enName: "Ataxia",
      section: "1.5",
      sectionName: "神經系統",
      description: "運動協調障礙。可分為前庭性（頭歪斜、眼球震顫）、小腦性（意向性震顫、過度測距）及本體感覺性（踩棉花感）。",
      differentials: [
        { zh: "前庭疾病", en: "Vestibular disease", species: "both", freq: "common", category: "前庭", urgency: "semi-urgent", detail: "周邊型（內耳炎、特發性）或中樞型（腦幹）。伴頭歪斜、眼球震顫。", workup: ["神經學檢查", "耳鏡", "腦部 MRI"] },
        { zh: "椎間盤疾病", en: "Intervertebral disc disease (IVDD)", species: "dog", freq: "common", category: "脊椎", urgency: "urgent", detail: "犬最常見的脊髓疾病。臘腸犬等軟骨營養障礙品種好發。", workup: ["神經學檢查", "脊椎 MRI/CT", "脊髓攝影"] },
        { zh: "退化性脊髓病", en: "Degenerative myelopathy (CDRM)", species: "dog", freq: "common", category: "脊椎", urgency: "non-urgent", detail: "大型犬好發，進行性後肢本體感覺喪失。", workup: ["排除性診斷", "SOD1 基因檢測"] },
        { zh: "腦腫瘤", en: "Intracranial neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腦膜瘤、膠質瘤等。中老年動物漸進性神經症狀。", workup: ["腦部 MRI", "腦脊髓液"] },
        { zh: "腦炎", en: "Encephalitis", species: "both", freq: "uncommon", category: "感染/免疫", urgency: "urgent", detail: "感染性（犬瘟熱、FIP、弓形蟲）或免疫介導性（GME、NME）。", workup: ["腦脊髓液分析", "腦部 MRI", "病原 PCR"] },
        { zh: "小腦疾病", en: "Cerebellar disease", species: "both", freq: "uncommon", category: "神經", urgency: "semi-urgent", detail: "先天性（貓小腦發育不全）或後天性。意向性震顫、過度測距。", workup: ["腦部 MRI"] },
        { zh: "纖維軟骨栓塞", en: "Fibrocartilaginous embolism (FCE)", species: "both", freq: "common", category: "脊椎", urgency: "urgent", detail: "脊髓血管栓塞導致急性非疼痛性脊髓損傷。大型犬好發。", workup: ["脊椎 MRI"] },
        { zh: "中毒", en: "Toxin exposure", species: "both", freq: "common", category: "中毒", urgency: "urgent", detail: "Metronidazole 毒性、重金屬、有機磷等。", workup: ["用藥史", "毒物篩檢"] },
        { zh: "代謝性腦病", en: "Metabolic encephalopathy", species: "both", freq: "uncommon", category: "代謝", urgency: "urgent", detail: "肝性腦病、尿毒症性腦病、電解質失衡。", workup: ["生化全套", "膽汁酸", "電解質"] }
      ]
    },
    {
      id: "paresis-paralysis",
      zhName: "輕癱/癱瘓",
      enName: "Paresis / Paralysis",
      section: "1.5",
      sectionName: "神經系統",
      description: "自主運動能力部分喪失（輕癱）或完全喪失（癱瘓）。依據受影響範圍分為單肢、雙前肢、雙後肢或四肢。",
      differentials: [
        { zh: "椎間盤疾病", en: "Intervertebral disc disease (IVDD)", species: "dog", freq: "common", category: "脊椎", urgency: "emergency", detail: "犬最常見脊髓壓迫原因。Hansen Type I（急性）好發於臘腸犬等品種。", workup: ["神經學檢查（定位）", "脊椎 MRI/CT"] },
        { zh: "脊髓創傷", en: "Spinal cord trauma", species: "both", freq: "common", category: "創傷", urgency: "emergency", detail: "骨折、脫臼、撞擊傷。", workup: ["脊椎 X 光", "MRI"] },
        { zh: "纖維軟骨栓塞", en: "Fibrocartilaginous embolism (FCE)", species: "both", freq: "common", category: "血管", urgency: "urgent", detail: "急性非疼痛性、非進行性脊髓損傷。大型犬好發。", workup: ["脊椎 MRI"] },
        { zh: "退化性脊髓病", en: "Degenerative myelopathy (CDRM)", species: "dog", freq: "common", category: "退化", urgency: "non-urgent", detail: "進行性後肢無力，德國牧羊犬等好發。", workup: ["排除性診斷", "SOD1 基因檢測"] },
        { zh: "脊髓腫瘤", en: "Spinal neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "urgent", detail: "硬膜外、硬膜內、髓內腫瘤。", workup: ["脊椎 MRI", "腦脊髓液"] },
        { zh: "多發性神經根炎", en: "Polyradiculoneuritis", species: "dog", freq: "uncommon", category: "免疫", urgency: "urgent", detail: "急性上行性四肢輕癱，類似 Guillain-Barré。", workup: ["肌電圖", "腦脊髓液"] },
        { zh: "重症肌無力", en: "Myasthenia gravis", species: "both", freq: "uncommon", category: "神經肌肉", urgency: "semi-urgent", detail: "運動後惡化的肌肉無力。", workup: ["AChR 抗體", "Edrophonium 試驗"] },
        { zh: "壁蝨麻痺", en: "Tick paralysis", species: "both", freq: "uncommon", category: "感染", urgency: "emergency", detail: "壁蝨神經毒素導致急性上行性麻痺。", workup: ["全身體表檢查（找壁蝨）"] },
        { zh: "脊椎畸形", en: "Vertebral malformation", species: "dog", freq: "uncommon", category: "脊椎", urgency: "semi-urgent", detail: "先天性脊椎分節或形成異常。英國鬥牛犬等短頭犬好發。", workup: ["脊椎X光", "CT/MRI", "神經學定位"] },
        { zh: "主動脈血栓栓塞", en: "Aortic thromboembolism (ATE)", species: "cat", freq: "common", category: "心血管", urgency: "emergency", detail: "貓HCM最危急併發症。急性後肢癱瘓、疼痛、冰冷、無脈搏。", workup: ["心臟超音波", "後肢評估", "D-dimer"] }
      ]
    },
    {
      id: "coma-stupor",
      zhName: "昏迷/嗜睡",
      enName: "Coma / Stupor",
      section: "1.5",
      sectionName: "神經系統",
      description: "意識程度嚴重降低。嗜睡可被強刺激短暫喚醒；昏迷完全無反應。需緊急處理。",
      differentials: [
        { zh: "頭部外傷", en: "Head trauma", species: "both", freq: "common", category: "創傷", urgency: "emergency", detail: "顱內出血、腦水腫。交通事故、高處墜落。", workup: ["神經學檢查", "腦部 CT/MRI"] },
        { zh: "中毒", en: "Toxin exposure", species: "both", freq: "common", category: "中毒", urgency: "emergency", detail: "乙二醇、大麻、巴比妥類、鎮靜劑等。", workup: ["中毒史", "毒物篩檢"] },
        { zh: "代謝性腦病", en: "Metabolic encephalopathy", species: "both", freq: "common", category: "代謝", urgency: "emergency", detail: "肝性腦病、尿毒症、嚴重低血糖、電解質失衡。", workup: ["血糖", "BUN/Cre", "膽汁酸", "電解質"] },
        { zh: "腦血管意外", en: "Cerebrovascular accident (Stroke)", species: "both", freq: "uncommon", category: "血管", urgency: "emergency", detail: "腦梗塞或出血。急性發作。", workup: ["腦部 MRI"] },
        { zh: "顱內腫瘤", en: "Intracranial neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "emergency", detail: "嚴重腫瘤佔位效應或腦疝。", workup: ["腦部 MRI/CT"] },
        { zh: "癲癇重積狀態", en: "Status epilepticus", species: "both", freq: "common", category: "神經", urgency: "emergency", detail: "持續或反覆癲癇發作後的意識障礙。緊急狀況。", workup: ["血糖", "電解質", "腦部 MRI"] },
        { zh: "嚴重休克", en: "Shock", species: "both", freq: "common", category: "多系統", urgency: "emergency", detail: "任何原因的嚴重休克導致腦灌流不足。", workup: ["血壓", "乳酸"] }
      ]
    },
    {
      id: "blindness",
      zhName: "失明/視力障礙",
      enName: "Blindness / Visual Impairment",
      section: "1.6",
      sectionName: "眼科",
      description: "部分或完全喪失視力。可為突發或漸進性。需區分眼球疾病與神經性原因。",
      differentials: [
        { zh: "白內障", en: "Cataracts", species: "both", freq: "common", category: "眼球", urgency: "non-urgent", detail: "水晶體混濁。犬常見（糖尿病、遺傳性）。", workup: ["裂隙燈檢查", "血糖"] },
        { zh: "青光眼", en: "Glaucoma", species: "both", freq: "common", category: "眼球", urgency: "emergency", detail: "眼壓升高導致視神經損傷。", workup: ["眼壓計"] },
        { zh: "視網膜剝離", en: "Retinal detachment", species: "both", freq: "uncommon", category: "眼球", urgency: "urgent", detail: "高血壓、感染等。貓常見於高血壓。", workup: ["眼底檢查", "血壓"] },
        { zh: "進行性視網膜萎縮", en: "Progressive retinal atrophy (PRA)", species: "dog", freq: "common", category: "遺傳", urgency: "non-urgent", detail: "遺傳性視網膜退化。先夜盲後全盲。", workup: ["眼底檢查", "視網膜電圖"] },
        { zh: "突發後天性視網膜退化", en: "SARDS", species: "dog", freq: "uncommon", category: "眼球", urgency: "urgent", detail: "突發性完全失明，眼底初期正常。", workup: ["視網膜電圖（ERG 平坦）"] },
        { zh: "高血壓性視網膜病變", en: "Hypertensive retinopathy", species: "cat", freq: "common", category: "眼球", urgency: "urgent", detail: "貓 CKD 或甲亢引起高血壓損傷視網膜。", workup: ["血壓", "BUN/Cre", "T4"] },
        { zh: "顱內疾病", en: "Intracranial disease", species: "both", freq: "uncommon", category: "神經", urgency: "urgent", detail: "枕葉腫瘤、腦炎影響視覺皮質。", workup: ["腦部 MRI"] }
      ]
    },
    {
      id: "vaginal-discharge",
      zhName: "陰道分泌物",
      enName: "Vaginal / Vulval Discharge",
      section: "1.8",
      sectionName: "生殖系統",
      description: "陰道或外陰的異常分泌物。需區分類型及是否與發情周期相關。",
      differentials: [
        { zh: "子宮蓄膿", en: "Pyometra", species: "both", freq: "common", category: "子宮", urgency: "urgent", detail: "未絕育母畜。開放型(open-cervix)有膿性分泌物；閉鎖型(closed-cervix)無分泌物更危急。常在發情後1-2月發生。", workup: ["腹部超音波", "CBC"] },
        { zh: "陰道炎", en: "Vaginitis", species: "both", freq: "common", category: "陰道", urgency: "non-urgent", detail: "幼年或成年型。黏液膿性分泌物。", workup: ["陰道鏡", "分泌物培養"] },
        { zh: "正常發情", en: "Normal oestrus", species: "both", freq: "common", category: "生理", urgency: "non-urgent", detail: "發情期的血性或漿液性分泌物。", workup: ["陰道細胞學"] },
        { zh: "子宮/陰道腫瘤", en: "Uterine/vaginal neoplasia", species: "both", freq: "uncommon", category: "腫瘤", urgency: "semi-urgent", detail: "TVT、平滑肌瘤等。", workup: ["陰道鏡", "細胞學/切片"] },
        { zh: "產後分泌物", en: "Post-partum discharge", species: "both", freq: "common", category: "生理", urgency: "non-urgent", detail: "正常產後惡露。異常持續需排除感染。", workup: ["腹部超音波"] }
      ]
    },
    {
      id: "pollakiuria",
      zhName: "頻尿/排尿困難",
      enName: "Pollakiuria / Dysuria / Stranguria",
      section: "1.9",
      sectionName: "泌尿系統",
      description: "排尿頻率增加、排尿疼痛或排尿時過度用力。通常代表下泌尿道疾病。",
      differentials: [
        { zh: "貓下泌尿道疾病", en: "FLUTD", species: "cat", freq: "common", category: "泌尿", urgency: "urgent", detail: "包括特發性膀胱炎、結石、尿道栓子等。", workup: ["尿液分析", "腹部 X 光/超音波"] },
        { zh: "貓特發性膀胱炎", en: "Feline idiopathic cystitis (FIC)", species: "cat", freq: "common", category: "泌尿", urgency: "semi-urgent", detail: "貓最常見下泌尿道疾病(50-65%)。排除感染、結石後診斷。與壓力相關。", workup: ["尿液分析", "尿液培養（排除）", "腹部X光/超音波"] },
        { zh: "泌尿道感染", en: "Urinary tract infection (UTI)", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "細菌性膀胱炎。母犬較公犬常見。", workup: ["尿液分析＋培養"] },
        { zh: "泌尿道結石", en: "Urolithiasis", species: "both", freq: "common", category: "泌尿", urgency: "semi-urgent", detail: "膀胱或尿道結石。", workup: ["腹部 X 光", "超音波", "尿液分析"] },
        { zh: "膀胱腫瘤", en: "Bladder neoplasia (TCC)", species: "dog", freq: "uncommon", category: "腫瘤", urgency: "semi-urgent", detail: "移行細胞癌。老年犬。", workup: ["腹部超音波", "尿液細胞學"] },
        { zh: "前列腺疾病", en: "Prostatic disease", species: "dog", freq: "common", category: "泌尿生殖", urgency: "semi-urgent", detail: "前列腺炎、良性增生、腫瘤。", workup: ["直腸觸診", "超音波"] },
        { zh: "尿道阻塞", en: "Urethral obstruction", species: "both", freq: "common", category: "泌尿", urgency: "emergency", detail: "結石或栓子阻塞尿道。公貓/公犬較常見。急診。", workup: ["理學檢查", "X 光", "電解質"] }
      ]
    },
    {
      id: "haematuria",
      zhName: "血尿",
      enName: "Haematuria",
      section: "1.9",
      sectionName: "泌尿系統",
      description: "尿液含血。需區分全程血尿、初段或末段血尿以定位出血位置。",
      differentials: [
        { zh: "泌尿道感染", en: "Urinary tract infection (UTI)", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "膀胱炎、腎盂腎炎。", workup: ["尿液分析＋培養"] },
        { zh: "泌尿道結石", en: "Urolithiasis", species: "both", freq: "common", category: "泌尿", urgency: "semi-urgent", detail: "結石摩擦黏膜出血。", workup: ["腹部 X 光", "超音波"] },
        { zh: "膀胱腫瘤", en: "Bladder neoplasia (TCC)", species: "dog", freq: "uncommon", category: "腫瘤", urgency: "semi-urgent", detail: "移行細胞癌等。", workup: ["超音波", "尿液細胞學"] },
        { zh: "凝血障礙", en: "Coagulopathy", species: "both", freq: "uncommon", category: "血液", urgency: "urgent", detail: "抗凝血劑中毒、血小板疾病。", workup: ["PT/aPTT", "血小板計數"] },
        { zh: "前列腺疾病", en: "Prostatic disease", species: "dog", freq: "common", category: "泌尿生殖", urgency: "semi-urgent", detail: "前列腺炎、增生、腫瘤。", workup: ["直腸觸診", "超音波"] },
        { zh: "創傷", en: "Trauma", species: "both", freq: "uncommon", category: "創傷", urgency: "urgent", detail: "膀胱或尿道創傷。", workup: ["影像學"] }
      ]
    },
    {
      id: "urinary-incontinence",
      zhName: "尿失禁",
      enName: "Urinary Incontinence",
      section: "1.9",
      sectionName: "泌尿系統",
      description: "無法自主控制排尿。母犬絕育後最常見。",
      differentials: [
        { zh: "尿道括約肌功能不全", en: "USMI", species: "dog", freq: "common", category: "泌尿", urgency: "non-urgent", detail: "絕育母犬最常見原因。休息或睡覺時漏尿。", workup: ["尿液分析", "尿道壓力測定"] },
        { zh: "異位輸尿管", en: "Ectopic ureter", species: "both", freq: "uncommon", category: "先天性", urgency: "semi-urgent", detail: "先天性。幼年即持續漏尿。", workup: ["CT 尿路攝影", "膀胱鏡"] },
        { zh: "神經性膀胱", en: "Neurogenic bladder", species: "both", freq: "uncommon", category: "神經", urgency: "semi-urgent", detail: "上或下運動神經元病變。", workup: ["神經學檢查", "脊椎 MRI"] },
        { zh: "泌尿道感染", en: "Urinary tract infection (UTI)", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "膀胱炎導致急迫性漏尿。", workup: ["尿液分析＋培養"] },
        { zh: "多尿症", en: "Polyuria", species: "both", freq: "common", category: "代謝", urgency: "non-urgent", detail: "任何 PU/PD 原因均可表現為尿失禁。", workup: ["尿比重", "血糖", "BUN/Cre"] }
      ]
    },
    {
      id: "hyperthermia",
      zhName: "體溫過高/發燒",
      enName: "Hyperthermia / Pyrexia",
      section: "2.1",
      sectionName: "一般理學檢查",
      description: "體溫高於正常值（犬/貓 > 39.2°C）。需區分發燒（調節中樞重設）與非發燒性高體溫（中暑）。",
      differentials: [
        { zh: "感染性疾病", en: "Infectious disease", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "最常見發燒原因。細菌、病毒、黴菌、原蟲等。", workup: ["CBC", "血液培養", "尿液培養", "影像學"] },
        { zh: "免疫介導性疾病", en: "Immune-mediated disease", species: "both", freq: "common", category: "免疫", urgency: "semi-urgent", detail: "IMHA、IMTP、多發性關節炎、SLE 等。", workup: ["CBC", "Coombs", "ANA", "關節液"] },
        { zh: "腫瘤", en: "Neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "semi-urgent", detail: "腫瘤性發燒，淋巴瘤、白血病等。", workup: ["影像學", "細胞學"] },
        { zh: "不明原因發燒", en: "Fever of unknown origin", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent", detail: "經初步檢查無法確定原因。", workup: ["反覆檢查", "骨髓", "關節液"] },
        { zh: "中暑", en: "Heat stroke", species: "both", freq: "common", category: "環境", urgency: "emergency", detail: "非發燒性高體溫。高溫環境、短頭犬。", workup: ["體溫監測", "DIC 篩檢"] },
        { zh: "組織壞死", en: "Tissue necrosis", species: "both", freq: "uncommon", category: "多系統", urgency: "semi-urgent", detail: "手術後、創傷、胰臟炎。", workup: ["臨床評估"] },
        { zh: "肝簇蟲感染", en: "Hepatozoon felis", species: "cat", freq: "rare", category: "感染", urgency: "semi-urgent", detail: "蜱蟲傳播原蟲。發燒、嗜睡、肌肉疼痛。地中海/熱帶地區。", workup: ["血液抹片", "PCR", "肌肉切片"] },
        { zh: "細胞弓形蟲病", en: "Cytauxzoonosis", species: "cat", freq: "rare", category: "感染", urgency: "emergency", detail: "北美蜱蟲傳播。急性致死性。高燒、黃疸、呼吸窘迫。", workup: ["血液抹片", "PCR", "支持療法"] }
      ]
    },
    {
      id: "lymphadenopathy",
      zhName: "淋巴結腫大",
      enName: "Enlarged Lymph Nodes",
      section: "2.1",
      sectionName: "一般理學檢查",
      description: "體表或內臟淋巴結觸診增大。可為局部或全身性。",
      differentials: [
        { zh: "淋巴瘤", en: "Lymphoma", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "多中心型最常見。全身性淋巴結無痛性腫大。", workup: ["淋巴結抽吸細胞學", "流式細胞儀"] },
        { zh: "反應性增生", en: "Reactive hyperplasia", species: "both", freq: "common", category: "發炎", urgency: "non-urgent", detail: "對感染/發炎的反應性增大。", workup: ["細胞學", "感染篩檢"] },
        { zh: "局部感染", en: "Regional infection", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "引流區域感染導致局部淋巴結腫大。", workup: ["感染源檢查"] },
        { zh: "轉移性腫瘤", en: "Metastatic neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "惡性腫瘤轉移至區域淋巴結。", workup: ["細胞學/切片"] },
        { zh: "全身性感染", en: "Systemic infection", species: "both", freq: "uncommon", category: "感染", urgency: "semi-urgent", detail: "立克次體、黴菌等。", workup: ["血清學", "培養"] }
      ]
    },
    {
      id: "jaundice",
      zhName: "黃疸",
      enName: "Jaundice / Icterus",
      section: "2.2",
      sectionName: "消化道理學檢查",
      description: "皮膚、黏膜及鞏膜黃染。分為溶血前性、肝性及阻塞性。",
      differentials: [
        { zh: "免疫介導性溶血", en: "IMHA", species: "both", freq: "common", category: "血液", urgency: "emergency", detail: "溶血前性黃疸最常見原因。大量紅血球破壞。", workup: ["CBC", "Coombs", "血抹片"] },
        { zh: "肝炎/膽管肝炎", en: "Hepatitis / Cholangiohepatitis", species: "both", freq: "common", category: "肝膽", urgency: "urgent", detail: "肝性黃疸。犬：慢性肝炎。貓：膽管炎。", workup: ["肝指數", "膽汁酸", "超音波", "肝臟切片"] },
        { zh: "膽道阻塞", en: "Bile duct obstruction", species: "both", freq: "uncommon", category: "肝膽", urgency: "urgent", detail: "膽管結石、胰臟腫瘤壓迫。ALP/GGT 顯著升高。", workup: ["超音波（膽管擴張）", "肝指數"] },
        { zh: "胰臟炎", en: "Pancreatitis", species: "both", freq: "common", category: "消化", urgency: "semi-urgent", detail: "壓迫膽管或引起肝損傷。貓三體炎常見。", workup: ["fPLI/cPLI", "超音波"] },
        { zh: "肝脂肪沉積", en: "Hepatic lipidosis", species: "cat", freq: "common", category: "肝膽", urgency: "urgent", detail: "貓特有。厭食後大量脂肪堆積在肝臟。", workup: ["肝指數", "超音波", "肝臟細胞學"] },
        { zh: "鉤端螺旋體病", en: "Leptospirosis", species: "dog", freq: "uncommon", category: "感染", urgency: "urgent", detail: "急性肝腎損傷。", workup: ["Leptospira MAT", "PCR"] },
        { zh: "FIP", en: "Feline infectious peritonitis (FIP)", species: "cat", freq: "uncommon", category: "感染", urgency: "urgent", detail: "高球蛋白、腹水。", workup: ["球蛋白", "腹水分析"] },
        { zh: "其他溶血性疾病", en: "Other haemolytic diseases", species: "both", freq: "uncommon", category: "血液", urgency: "urgent", detail: "洋蔥中毒、鋅中毒、Babesia、M. haemofelis。", workup: ["CBC", "血抹片", "PCR"] }
      ]
    },
    {
      id: "abdominal-distension",
      zhName: "腹部膨大",
      enName: "Abdominal Distension",
      section: "2.2",
      sectionName: "消化道理學檢查",
      description: "腹部外觀增大。器官腫大、液體蓄積、氣體、腫瘤或肌肉張力降低均可引起。",
      differentials: [
        { zh: "腹水", en: "Ascites", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent", detail: "腹腔液體蓄積。右心衰竭、肝病、低白蛋白等。", workup: ["腹腔穿刺", "超音波"] },
        { zh: "庫欣氏症", en: "Hyperadrenocorticism (Cushing's)", species: "dog", freq: "common", category: "內分泌", urgency: "non-urgent", detail: "腹部肌肉萎縮＋肝腫大（垂腹）。", workup: ["LDDS", "ACTH 刺激"] },
        { zh: "胃擴張/扭轉", en: "GDV", species: "dog", freq: "common", category: "急診", urgency: "emergency", detail: "大型深胸犬。急性膨大、休克。緊急手術。", workup: ["腹部 X 光"] },
        { zh: "腹腔腫瘤", en: "Abdominal neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "脾臟、肝臟等腫瘤。", workup: ["超音波", "細胞學"] },
        { zh: "妊娠", en: "Pregnancy", species: "both", freq: "common", category: "生殖", urgency: "non-urgent", detail: "未絕育母畜需排除。", workup: ["超音波"] },
        { zh: "子宮蓄膿", en: "Pyometra", species: "both", freq: "common", category: "生殖", urgency: "urgent", detail: "子宮積膿。開放型(open-cervix)或閉鎖型(closed-cervix)，氣腫型(emphysematous)預後差。", workup: ["超音波", "CBC"] },
        { zh: "臟器腫大", en: "Organomegaly", species: "both", freq: "common", category: "多系統", urgency: "semi-urgent", detail: "肝、脾、腎腫大。", workup: ["超音波/X 光"] }
      ]
    },
    {
      id: "ascites",
      zhName: "腹水",
      enName: "Ascites",
      section: "2.3",
      sectionName: "心肺理學檢查",
      description: "腹腔液體異常蓄積。需穿刺取液分析以區分漏出液、修正漏出液、滲出液。",
      differentials: [
        { zh: "右心衰竭", en: "Right-sided heart failure", species: "both", freq: "common", category: "心血管", urgency: "urgent", detail: "修正漏出液。心包膜積液、DCM、三尖瓣疾病。", workup: ["心臟超音波", "腹水分析"] },
        { zh: "肝臟疾病", en: "Hepatic disease", species: "both", freq: "common", category: "肝膽", urgency: "semi-urgent", detail: "門脈高壓＋低白蛋白。", workup: ["肝指數", "白蛋白", "超音波"] },
        { zh: "低白蛋白血症", en: "Hypoalbuminaemia", species: "both", freq: "common", category: "代謝", urgency: "semi-urgent", detail: "PLE、PLN、肝合成不足。純漏出液。", workup: ["白蛋白", "UPC"] },
        { zh: "腹腔腫瘤", en: "Abdominal neoplasia", species: "both", freq: "common", category: "腫瘤", urgency: "urgent", detail: "腫瘤性滲出或血腹。", workup: ["腹水細胞學", "超音波"] },
        { zh: "FIP", en: "Feline infectious peritonitis (FIP)", species: "cat", freq: "common", category: "感染", urgency: "urgent", detail: "高蛋白滲出液。", workup: ["腹水分析", "Rivalta 試驗"] },
        { zh: "膀胱破裂", en: "Uroabdomen", species: "both", freq: "uncommon", category: "泌尿", urgency: "emergency", detail: "腹水 Cre > 血清 Cre。", workup: ["腹水/血清 Cre 比較"] },
        { zh: "腹膜炎", en: "Peritonitis", species: "both", freq: "uncommon", category: "感染", urgency: "emergency", detail: "敗血性腹膜炎。滲出液。", workup: ["腹水細胞學＋培養"] }
      ]
    },
    {
      id: "heart-murmur",
      zhName: "心雜音",
      enName: "Heart Murmur",
      section: "2.3",
      sectionName: "心肺理學檢查",
      description: "聽診異常心音。需記錄等級（I-VI）、時相、最響點。",
      differentials: [
        { zh: "二尖瓣退化", en: "MMVD", species: "dog", freq: "common", category: "心血管", urgency: "semi-urgent", detail: "犬最常見心臟病。小型犬好發。", workup: ["心臟超音波", "胸腔 X 光"] },
        { zh: "肥厚型心肌病", en: "HCM", species: "cat", freq: "common", category: "心血管", urgency: "semi-urgent", detail: "貓最常見心臟病。", workup: ["心臟超音波", "NT-proBNP"] },
        { zh: "主動脈瓣狹窄", en: "Aortic stenosis", species: "dog", freq: "common", category: "先天性", urgency: "semi-urgent", detail: "先天性。大型犬好發。", workup: ["心臟超音波"] },
        { zh: "肺動脈瓣狹窄", en: "Pulmonic stenosis", species: "dog", freq: "common", category: "先天性", urgency: "semi-urgent", detail: "先天性。英國鬥牛犬等好發。", workup: ["心臟超音波"] },
        { zh: "擴張型心肌病", en: "DCM", species: "dog", freq: "common", category: "心血管", urgency: "semi-urgent", detail: "大型犬好發。", workup: ["心臟超音波", "Holter"] },
        { zh: "動脈導管未閉", en: "PDA", species: "dog", freq: "uncommon", category: "先天性", urgency: "semi-urgent", detail: "連續性機器樣雜音。", workup: ["心臟超音波"] },
        { zh: "生理性雜音", en: "Innocent murmur", species: "both", freq: "common", category: "生理", urgency: "non-urgent", detail: "幼年動物低等級雜音，通常隨成長消失。", workup: ["追蹤聽診"] },
        { zh: "貧血性雜音", en: "Anaemic murmur", species: "both", freq: "common", category: "血液", urgency: "semi-urgent", detail: "血液黏度降低產生功能性雜音。", workup: ["CBC"] },
        { zh: "心內淋巴瘤", en: "Intracardiac lymphoma", species: "both", freq: "rare", category: "腫瘤", urgency: "urgent", detail: "淋巴瘤侵犯心臟。可致心衰竭、心律不整、心包膜積液。", workup: ["心臟超音波", "心包膜液細胞學", "全身影像學"] },
        { zh: "牛磺酸缺乏性心肌病", en: "Taurine-deficiency cardiomyopathy", species: "both", freq: "uncommon", category: "心血管", urgency: "urgent", detail: "特定品種犬貓（Cocker Spaniel、貓）飲食缺乏牛磺酸。可逆性DCM。", workup: ["血漿牛磺酸濃度", "心臟超音波", "飲食史"] },
        { zh: "心包膜積液", en: "Pericardial effusion", species: "both", freq: "uncommon", category: "心血管", urgency: "emergency", detail: "心臟填塞可致急性休克。腫瘤（血管肉瘤）、特發性、心衰竭。", workup: ["心臟超音波", "心包膜穿刺", "腫瘤篩檢"] }
      ]
    },
    {
      id: "alopecia",
      zhName: "脫毛",
      enName: "Alopecia",
      section: "2.4",
      sectionName: "皮膚理學檢查",
      description: "毛髮部分或完全脫落。對稱性常為內分泌原因；不對稱常為感染、免疫、腫瘤。",
      differentials: [
        { zh: "甲狀腺低下", en: "Hypothyroidism", species: "dog", freq: "common", category: "內分泌", urgency: "non-urgent", detail: "雙側對稱脫毛，軀幹為主，不搔癢。", workup: ["Total T4", "Free T4", "TSH"] },
        { zh: "庫欣氏症", en: "Hyperadrenocorticism (Cushing's)", species: "dog", freq: "common", category: "內分泌", urgency: "non-urgent", detail: "雙側對稱脫毛，皮膚變薄。伴 PU/PD。", workup: ["LDDS", "ACTH 刺激"] },
        { zh: "蠕形蟎", en: "Demodicosis", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "局灶型或全身型。幼年犬常見。", workup: ["皮膚刮搔"] },
        { zh: "皮黴菌感染", en: "Dermatophytosis", species: "both", freq: "common", category: "感染", urgency: "semi-urgent", detail: "圓形脫毛斑。人畜共通。", workup: ["Wood's 燈", "DTM 培養"] },
        { zh: "跳蚤過敏", en: "Flea allergy dermatitis (FAD)", species: "both", freq: "common", category: "免疫", urgency: "non-urgent", detail: "搔癢性脫毛。犬腰薦部，貓腹部。", workup: ["體表檢查", "除蚤試驗"] },
        { zh: "異位性皮膚炎", en: "Atopic dermatitis", species: "both", freq: "common", category: "免疫", urgency: "non-urgent", detail: "搔抓造成繼發性脫毛。", workup: ["排除診斷", "過敏原檢測"] },
        { zh: "食物過敏", en: "Food adverse reaction", species: "both", freq: "common", category: "免疫", urgency: "non-urgent", detail: "非季節性搔癢及脫毛。", workup: ["排除飲食試驗"] }
      ]
    },
    {
      id: "red-eye",
      zhName: "紅眼",
      enName: "Red Eye",
      section: "2.6",
      sectionName: "眼科理學檢查",
      description: "眼球表面或周圍發紅。需區分結膜充血、鞏膜注射、角膜新血管及前房出血。",
      differentials: [
        { zh: "結膜炎", en: "Conjunctivitis", species: "both", freq: "common", category: "結膜", urgency: "non-urgent", detail: "最常見紅眼原因。", workup: ["眼科檢查", "螢光素染色"] },
        { zh: "角膜潰瘍", en: "Corneal ulcer", species: "both", freq: "common", category: "角膜", urgency: "urgent", detail: "螢光素染色陽性。疼痛、畏光。", workup: ["螢光素染色", "裂隙燈"] },
        { zh: "青光眼", en: "Glaucoma", species: "both", freq: "common", category: "眼球", urgency: "emergency", detail: "眼壓升高。緊急處理。", workup: ["眼壓計"] },
        { zh: "前葡萄膜炎", en: "Anterior uveitis", species: "both", freq: "common", category: "眼球", urgency: "urgent", detail: "虹膜及睫狀體發炎。瞳孔縮小。", workup: ["裂隙燈", "眼壓", "全身篩檢"] },
        { zh: "乾眼症", en: "KCS", species: "dog", freq: "common", category: "淚液", urgency: "semi-urgent", detail: "淚液分泌不足。", workup: ["Schirmer 淚液試驗"] },
        { zh: "前房出血", en: "Hyphaema", species: "both", freq: "uncommon", category: "眼球", urgency: "urgent", detail: "前房可見血液。外傷、凝血障礙、腫瘤。", workup: ["眼科檢查", "血壓", "凝血篩檢"] }
      ]
    }    ,
    {id:"abdominal-pain",zhName:"急性腹痛",enName:"Acute Abdominal Pain",section:"1.2",sectionName:"消化道／腹腔",description:"腹部觸診疼痛，表現為弓背、不願移動、腹部緊繃。急性腹痛為急診最常見主訴之一。",differentials:[{zh:"胰臟炎",en:"Pancreatitis",species:"both",freq:"common",category:"消化",urgency:"urgent",detail:"犬嘔吐腹痛明顯，貓症狀較隱匿。",workup:["fPLI/cPLI","腹部超音波","CBC"]},{zh:"腸阻塞/異物",en:"GI foreign body",species:"both",freq:"common",category:"消化",urgency:"urgent",detail:"嘔吐、脫水、腸管擴張。線性異物貓特別常見。",workup:["腹部X光","腹部超音波"]},{zh:"胃擴張扭轉(GDV)",en:"GDV",species:"dog",freq:"common",category:"急診",urgency:"emergency",detail:"大型深胸犬。非產性乾嘔、腹部急性膨大、休克。需立即手術。",workup:["腹部X光","急診手術"]},{zh:"腹膜炎",en:"Peritonitis",species:"both",freq:"uncommon",category:"感染",urgency:"emergency",detail:"腸穿孔、膀胱破裂。可致敗血性休克。",workup:["腹水分析＋培養","腹部超音波"]},{zh:"子宮蓄膿",en:"Pyometra",species:"both",freq:"common",category:"生殖",urgency:"urgent",detail:"未絕育母畜。閉鎖型更危急。",workup:["腹部超音波","CBC"]},{zh:"脾臟扭轉/破裂",en:"Splenic torsion/Rupture",species:"dog",freq:"uncommon",category:"急診",urgency:"emergency",detail:"脾臟腫瘤破裂致急性血腹。",workup:["FAST scan","腹部超音波"]},{zh:"尿道阻塞",en:"Urethral obstruction",species:"both",freq:"common",category:"泌尿",urgency:"emergency",detail:"公貓急診。膀胱極度膨大、高血鉀。",workup:["理學檢查","電解質","X光"]},{zh:"腸套疊",en:"Intussusception",species:"both",freq:"uncommon",category:"消化",urgency:"urgent",detail:"幼年動物常見。嘔吐、血便。",workup:["腹部超音波"]}]},
    {id:"head-tilt",zhName:"頭歪斜",enName:"Head Tilt",section:"1.5",sectionName:"神經系統",description:"頭部持續歪向一側。前庭系統異常典型表現，需區分周邊型與中樞型。",differentials:[{zh:"特發性前庭症候群",en:"Idiopathic vestibular disease",species:"both",freq:"common",category:"前庭",urgency:"semi-urgent",detail:"老犬/老貓最常見。急性發作預後良好。",workup:["神經學檢查","排除其他原因"]},{zh:"中內耳炎",en:"Otitis media/interna",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"外耳炎延伸。可伴Horner syndrome。",workup:["耳鏡","頭部CT/MRI"]},{zh:"鼻咽息肉",en:"Nasopharyngeal polyp",species:"cat",freq:"common",category:"發炎",urgency:"semi-urgent",detail:"貓常見，尤其年輕貓。",workup:["口咽檢查","耳鏡","CT"]},{zh:"腦幹腫瘤",en:"Brainstem neoplasia",species:"both",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"中樞型前庭：垂直眼球震顫、方向變化型。",workup:["腦部MRI","腦脊髓液"]},{zh:"腦炎(GME/NME)",en:"Encephalitis",species:"both",freq:"uncommon",category:"免疫",urgency:"urgent",detail:"免疫介導性腦炎。多灶性神經症狀。",workup:["腦脊髓液","腦部MRI"]},{zh:"甲狀腺低下",en:"Hypothyroidism",species:"dog",freq:"uncommon",category:"內分泌",urgency:"non-urgent",detail:"前庭神經病變。重要可治療病因。",workup:["Total T4","Free T4","TSH"]},{zh:"Metronidazole中毒",en:"Metronidazole toxicity",species:"both",freq:"uncommon",category:"中毒",urgency:"urgent",detail:"高劑量或長期使用。",workup:["用藥史","停藥後觀察"]}]},
    {id:"pallor-cyanosis",zhName:"蒼白/發紺",enName:"Pallor / Cyanosis",section:"2.1",sectionName:"一般理學檢查",description:"黏膜蒼白或發藍。蒼白指向貧血、休克；發紺指向嚴重低血氧。",differentials:[{zh:"免疫介導性溶血性貧血",en:"IMHA",species:"both",freq:"common",category:"免疫",urgency:"emergency",detail:"急性溶血。可伴黃疸、發燒。",workup:["CBC/PCV","Coombs","血抹片","膽紅素"]},{zh:"急性出血",en:"Acute haemorrhage",species:"both",freq:"common",category:"多系統",urgency:"emergency",detail:"外傷、脾臟腫瘤破裂、凝血障礙。",workup:["PCV","FAST scan","PT/aPTT"]},{zh:"休克",en:"Shock",species:"both",freq:"common",category:"多系統",urgency:"emergency",detail:"心搏過速、末梢冰冷、CRT延長。",workup:["血壓","乳酸","血氣"]},{zh:"慢性貧血",en:"Anaemia",species:"both",freq:"common",category:"血液",urgency:"semi-urgent",detail:"CKD、骨髓疾病、慢性出血。",workup:["CBC","網狀紅血球"]},{zh:"呼吸衰竭（發紺）",en:"Respiratory failure",species:"both",freq:"common",category:"呼吸",urgency:"emergency",detail:"嚴重肺水腫、氣胸。",workup:["胸腔X光","血氧","血氣分析"]},{zh:"高鐵血紅素血症",en:"Methemoglobinaemia",species:"both",freq:"uncommon",category:"中毒",urgency:"emergency",detail:"對乙醯氨基酚（貓）。巧克力色血液。",workup:["MetHb測定","暴露史"]},{zh:"DIC",en:"DIC",species:"both",freq:"uncommon",category:"多系統",urgency:"emergency",detail:"消耗性凝血病變。大量消耗凝血因子+血小板導致出血與蒼白。繼發於敗血症、腫瘤。",workup:["PT/aPTT","D-dimer","血小板","血抹片"]}]},
    {id:"nystagmus",zhName:"眼球震顫",enName:"Nystagmus",section:"1.5",sectionName:"神經系統",description:"眼球不自主節律性運動。水平/旋轉型多為周邊前庭；垂直/方向變化型多為中樞。",differentials:[{zh:"周邊前庭疾病",en:"Peripheral vestibular disease",species:"both",freq:"common",category:"前庭",urgency:"semi-urgent",detail:"水平或旋轉型。最常見為特發性。",workup:["神經學檢查","耳鏡"]},{zh:"中內耳炎",en:"Otitis media/interna",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"外耳炎延伸至中內耳。",workup:["耳鏡","頭部CT/MRI"]},{zh:"中樞前庭疾病",en:"Central vestibular disease",species:"both",freq:"uncommon",category:"神經",urgency:"urgent",detail:"垂直型或方向變化型。伴意識改變。",workup:["腦部MRI","腦脊髓液"]},{zh:"小腦疾病",en:"Cerebellar disease",species:"both",freq:"uncommon",category:"神經",urgency:"semi-urgent",detail:"小腦損傷導致震盪型眼球震顫。",workup:["腦部MRI"]}]},
    {id:"stertor-stridor",zhName:"喘鳴/吸氣音異常",enName:"Stertor / Stridor",section:"1.3",sectionName:"心血管／呼吸",description:"Stertor：鼻咽部低沉鼾聲。Stridor：喉部高亢哨音。定位上呼吸道阻塞。",differentials:[{zh:"短頭犬阻塞性呼吸道症候群",en:"BOAS",species:"dog",freq:"common",category:"呼吸",urgency:"semi-urgent",detail:"法鬥、巴哥、英鬥。",workup:["臨床評估","喉鏡（鎮靜下）"]},{zh:"喉頭麻痺",en:"Laryngeal paralysis",species:"dog",freq:"common",category:"呼吸",urgency:"urgent",detail:"老年大型犬。吸氣性stridor。",workup:["喉鏡（輕度鎮靜）"]},{zh:"鼻咽息肉",en:"Nasopharyngeal polyp",species:"cat",freq:"common",category:"發炎",urgency:"semi-urgent",detail:"貓常見。Stertor為主。",workup:["口咽檢查","CT"]},{zh:"喉部水腫",en:"Laryngeal oedema",species:"both",freq:"uncommon",category:"免疫",urgency:"emergency",detail:"急性過敏反應。快速進展。",workup:["臨床評估","緊急處理"]},{zh:"氣管塌陷",en:"Tracheal collapse",species:"dog",freq:"common",category:"呼吸",urgency:"semi-urgent",detail:"小型犬。典型鵝叫咳嗽。",workup:["頸胸X光","透視","支氣管鏡"]}]},
    {id:"petechiae-ecchymoses",zhName:"瘀斑/點狀出血",enName:"Petechiae / Ecchymoses",section:"2.1",sectionName:"一般理學檢查",description:"皮膚或黏膜出血點或出血斑。直接指向血小板或血管異常。",differentials:[{zh:"免疫介導性血小板減少",en:"IMTP",species:"both",freq:"common",category:"免疫",urgency:"urgent",detail:"犬最常見後天性血小板減少。",workup:["CBC","血抹片","骨髓"]},{zh:"壁蝨傳染病",en:"Tick-borne disease (Haemoparasites)",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"Ehrlichia、Anaplasma。",workup:["4Dx SNAP","PCR"]},{zh:"DIC",en:"DIC",species:"both",freq:"uncommon",category:"多系統",urgency:"emergency",detail:"消耗性凝血病變。",workup:["PT/aPTT","D-dimer","血抹片"]},{zh:"抗凝血劑中毒",en:"Anticoagulant rodenticide",species:"both",freq:"common",category:"中毒",urgency:"emergency",detail:"老鼠藥中毒。PT顯著延長。",workup:["PT/aPTT","維生素K反應"]},{zh:"血管炎",en:"Vasculitis",species:"both",freq:"rare",category:"免疫",urgency:"semi-urgent",detail:"免疫介導性血管壁損傷。",workup:["皮膚切片"]},{zh:"免疫介導性溶血性貧血",en:"IMHA",species:"both",freq:"uncommon",category:"免疫",urgency:"emergency",detail:"Evans syndrome (IMHA+IMTP同時發生)。溶血+血小板減少導致瘀點。",workup:["CBC/PCV","Coombs","血抹片","膽紅素"]}]},
    {id:"halitosis-stomatitis",zhName:"口臭/口炎",enName:"Halitosis / Stomatitis",section:"1.2",sectionName:"消化道／腹腔",description:"口腔異味或口腔黏膜發炎。可提示口腔或全身性疾病。",differentials:[{zh:"牙周病",en:"Periodontal disease",species:"both",freq:"common",category:"口腔",urgency:"non-urgent",detail:"最常見口臭原因。",workup:["口腔檢查（需鎮靜）","口腔X光"]},{zh:"貓慢性齦口炎",en:"Feline chronic gingivostomatitis",species:"cat",freq:"common",category:"口腔",urgency:"semi-urgent",detail:"可能與FCV相關。嚴重疼痛。",workup:["口腔檢查","FIV/FeLV","切片"]},{zh:"口腔腫瘤",en:"Oral neoplasia",species:"both",freq:"common",category:"腫瘤",urgency:"urgent",detail:"鱗狀細胞癌、纖維肉瘤。",workup:["口腔檢查","細胞學/切片","CT"]},{zh:"腎衰竭（尿毒味）",en:"Renal failure",species:"both",freq:"common",category:"腎臟",urgency:"urgent",detail:"氨味/尿毒味。可伴口腔潰瘍。",workup:["BUN/Cre","電解質"]},{zh:"糖尿病酮酸中毒",en:"DKA",species:"both",freq:"uncommon",category:"內分泌",urgency:"emergency",detail:"甜水果味。嚴重代謝性酸中毒。",workup:["血糖","尿酮","血氣","電解質"]}]},
    {id:"peripheral-oedema",zhName:"水腫",enName:"Peripheral Oedema",section:"2.1",sectionName:"一般理學檢查",description:"皮下組織液體蓄積。可為局部或全身性。",differentials:[{zh:"低白蛋白血症",en:"Hypoalbuminaemia",species:"both",freq:"common",category:"代謝",urgency:"semi-urgent",detail:"PLE/PLN/肝病。膠體滲透壓降低。",workup:["白蛋白","UPC"]},{zh:"右心衰竭",en:"Right-sided heart failure",species:"both",freq:"common",category:"心血管",urgency:"urgent",detail:"靜脈回流受阻。",workup:["心臟超音波","胸腔X光"]},{zh:"淋巴管阻塞",en:"Lymphatic obstruction",species:"both",freq:"uncommon",category:"腫瘤",urgency:"semi-urgent",detail:"局部水腫。",workup:["影像學","細胞學"]},{zh:"蛇咬/昆蟲螫傷",en:"Envenomation",species:"both",freq:"uncommon",category:"中毒",urgency:"urgent",detail:"局部急性腫脹。",workup:["理學檢查","PT/aPTT"]}]},
    {id:"otitis-externa",zhName:"外耳炎",enName:"Otitis Externa",section:"2.4",sectionName:"皮膚理學檢查",description:"外耳道發炎。門診最常見主訴之一。反覆外耳炎需查找原發過敏病因。",differentials:[{zh:"異位性皮膚炎",en:"Atopic dermatitis",species:"dog",freq:"common",category:"過敏",urgency:"non-urgent",detail:"最常見潛在原因。耳朵常為最早症狀。",workup:["排除其他過敏原","皮內試驗"]},{zh:"食物不良反應",en:"Food adverse reaction",species:"both",freq:"common",category:"過敏",urgency:"non-urgent",detail:"非季節性。",workup:["排除飲食試驗（8-12週）"]},{zh:"耳疥蟲",en:"Otodectes (ear mites)",species:"both",freq:"common",category:"寄生蟲",urgency:"non-urgent",detail:"深色乾耳垢。幼年動物常見。",workup:["耳鏡","耳垢顯微鏡"]},{zh:"細菌/酵母菌感染",en:"Bacterial/yeast infection",species:"both",freq:"common",category:"感染",urgency:"non-urgent",detail:"常為繼發感染。Pseudomonas（綠膿桿菌）為頑固性外耳炎常見病原，需特殊抗生素。",workup:["耳垢細胞學","培養"]},{zh:"異物",en:"Foreign body",species:"both",freq:"common",category:"物理性",urgency:"semi-urgent",detail:"草芒。通常單側急性。",workup:["耳鏡"]}]},
    {id:"tachycardia-bradycardia",zhName:"心搏過速/心搏過緩",enName:"Tachycardia / Bradycardia",section:"2.3",sectionName:"心肺理學檢查",description:"心率異常增快或減慢。犬正常60-140bpm，貓正常140-220bpm。",differentials:[{zh:"疼痛（過速）",en:"Pain",species:"both",freq:"common",category:"多系統",urgency:"semi-urgent",detail:"交感神經活化。",workup:["疼痛評估"]},{zh:"貧血（過速）",en:"Anaemia",species:"both",freq:"common",category:"血液",urgency:"semi-urgent",detail:"代償性心搏過速。",workup:["CBC/PCV"]},{zh:"心衰竭（過速）",en:"Congestive heart failure (CHF)",species:"both",freq:"common",category:"心血管",urgency:"urgent",detail:"交感神經代償。",workup:["心臟超音波","NT-proBNP"]},{zh:"高血鉀（過緩）",en:"Hyperkalaemia",species:"both",freq:"common",category:"代謝",urgency:"emergency",detail:"尿道阻塞、Addison's。ECG異常。",workup:["電解質","ECG"]},{zh:"房室傳導阻滯（過緩）",en:"AV block",species:"both",freq:"uncommon",category:"心血管",urgency:"urgent",detail:"二度或三度可致昏厥。",workup:["ECG","Holter"]},{zh:"顱內壓升高（過緩）",en:"Increased ICP",species:"both",freq:"uncommon",category:"神經",urgency:"emergency",detail:"Cushing反射。",workup:["神經學檢查","腦部CT/MRI"]}]},
    {id:"horner-syndrome",zhName:"Horner 症候群",enName:"Horner Syndrome",section:"1.5",sectionName:"神經系統",description:"交感神經傳導損傷。縮瞳+眼球內陷+第三眼瞼突出+上眼瞼下垂。",differentials:[{zh:"特發性",en:"Idiopathic",species:"both",freq:"common",category:"神經",urgency:"non-urgent",detail:"最常見。通常6-8週自行恢復。",workup:["排除其他原因"]},{zh:"中內耳炎",en:"Otitis media/interna",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"交感神經鼓室段損傷。",workup:["耳鏡","頭部CT/MRI"]},{zh:"頸部/胸腔腫瘤",en:"Cervical/thoracic neoplasia",species:"both",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"臂神經叢或縱膈腔腫瘤。",workup:["胸腔X光","CT"]},{zh:"外傷",en:"Trauma",species:"both",freq:"common",category:"創傷",urgency:"urgent",detail:"頭頸部外傷。",workup:["理學檢查","影像學"]}]},
    {id:"oliguria-anuria",zhName:"少尿/無尿",enName:"Oliguria / Anuria",section:"1.9",sectionName:"泌尿系統",description:"尿量顯著減少或完全無尿。與「頻尿」完全不同。需緊急處理。",differentials:[{zh:"急性腎損傷",en:"Acute kidney injury (AKI)",species:"both",freq:"common",category:"腎臟",urgency:"emergency",detail:"毒素、缺血、感染。",workup:["BUN/Cre","電解質","尿量監測","超音波"]},{zh:"尿道阻塞",en:"Urethral obstruction",species:"both",freq:"common",category:"泌尿",urgency:"emergency",detail:"公貓急診！膀胱極度膨大。",workup:["理學檢查","電解質","X光"]},{zh:"休克",en:"Shock",species:"both",freq:"common",category:"多系統",urgency:"emergency",detail:"嚴重低血壓。",workup:["血壓","乳酸"]},{zh:"腎後性阻塞",en:"Post-renal obstruction",species:"both",freq:"uncommon",category:"泌尿",urgency:"emergency",detail:"雙側輸尿管結石、膀胱破裂。",workup:["超音波","造影"]}]},
    {id:"cutaneous-masses",zhName:"皮膚腫塊",enName:"Cutaneous Masses",section:"2.4",sectionName:"皮膚理學檢查",description:"皮膚或皮下可觸及的腫塊。飼主就診最常見原因之一。",differentials:[{zh:"肥大細胞瘤",en:"Mast cell tumour",species:"both",freq:"common",category:"腫瘤",urgency:"urgent",detail:"犬最常見皮膚惡性腫瘤。外觀多變。",workup:["細針抽吸細胞學"]},{zh:"脂肪瘤",en:"Lipoma",species:"dog",freq:"common",category:"腫瘤",urgency:"non-urgent",detail:"良性。軟、可移動。浸潤型脂肪瘤(infiltrative lipoma)會侵入肌肉筋膜，需手術廣泛切除。",workup:["細針抽吸細胞學"]},{zh:"組織球瘤",en:"Histiocytoma",species:"dog",freq:"common",category:"腫瘤",urgency:"non-urgent",detail:"年輕犬。通常自發消退。",workup:["細胞學"]},{zh:"膿瘍",en:"Abscess",species:"both",freq:"common",category:"感染",urgency:"semi-urgent",detail:"咬傷後貓最常見。",workup:["細針抽吸","培養"]},{zh:"軟組織肉瘤",en:"Soft tissue sarcoma",species:"both",freq:"uncommon",category:"腫瘤",urgency:"urgent",detail:"局部侵襲性。",workup:["細胞學","CT（術前）"]},{zh:"乳腺腫瘤",en:"Mammary carcinoma",species:"both",freq:"common",category:"腫瘤",urgency:"urgent",detail:"母犬50%惡性，貓85-90%惡性。未絕育母畜風險高。",workup:["細針抽吸細胞學","胸腔X光（轉移）","手術切除"]}]},
    {id:"facial-nerve-paralysis",zhName:"顏面神經麻痺",enName:"Facial Nerve Paralysis",section:"1.5",sectionName:"神經系統",description:"第七對腦神經損傷。無法閉眼、唇下垂、耳下垂。",differentials:[{zh:"特發性",en:"Idiopathic",species:"both",freq:"common",category:"神經",urgency:"non-urgent",detail:"最常見原因。類似Bell's palsy。",workup:["排除其他原因"]},{zh:"中內耳炎",en:"Otitis media/interna",species:"both",freq:"common",category:"感染",urgency:"urgent",detail:"顏面神經穿過中耳。常伴頭歪斜。",workup:["耳鏡","頭部CT/MRI"]},{zh:"甲狀腺低下",en:"Hypothyroidism",species:"dog",freq:"uncommon",category:"內分泌",urgency:"non-urgent",detail:"周邊神經病變。",workup:["Total T4","Free T4"]},{zh:"腦幹疾病",en:"Brainstem disease",species:"both",freq:"uncommon",category:"神經",urgency:"urgent",detail:"腫瘤、腦炎。伴其他腦神經異常。",workup:["腦部MRI","腦脊髓液"]}]},
    {id:"cachexia-muscle-wasting",zhName:"肌肉萎縮/惡病質",enName:"Cachexia / Muscle Wasting",section:"1.1",sectionName:"全身性／系統性／代謝",description:"肌肉量進行性減少。與單純體重減輕不同，著重蛋白質代謝異常。",differentials:[{zh:"惡性腫瘤",en:"Cancer cachexia",species:"both",freq:"common",category:"腫瘤",urgency:"urgent",detail:"腫瘤相關細胞激素導致蛋白分解。",workup:["影像學","細胞學"]},{zh:"慢性心臟病",en:"Cardiac cachexia",species:"both",freq:"common",category:"心血管",urgency:"semi-urgent",detail:"心衰竭導致惡病質。",workup:["心臟超音波","NT-proBNP"]},{zh:"慢性腎臟病",en:"Chronic kidney disease (CKD)",species:"both",freq:"common",category:"腎臟",urgency:"semi-urgent",detail:"尿毒症致蛋白消耗。",workup:["BUN/Cre/SDMA"]},{zh:"庫欣氏症",en:"Hyperadrenocorticism (Cushing's)",species:"dog",freq:"common",category:"內分泌",urgency:"non-urgent",detail:"選擇性肌肉萎縮伴垂腹。",workup:["LDDS","ACTH刺激"]},{zh:"甲狀腺亢進",en:"Hyperthyroidism",species:"cat",freq:"common",category:"內分泌",urgency:"semi-urgent",detail:"代謝率增加消耗肌肉。",workup:["Total T4"]}]}


],
sections: {
  "1.1":{name:"全身性／系統性／代謝",icon:"&#x2695;"},
  "1.2":{name:"消化道／腹腔",icon:"&#x1F4A7;"},
  "1.3":{name:"心血管／呼吸",icon:"&#x1F4A8;"},
  "1.4":{name:"皮膚",icon:"&#x1F9B4;"},
  "1.5":{name:"神經系統",icon:"&#x1F9E0;"},
  "1.6":{name:"眼科",icon:"&#x1F441;"},
  "1.7":{name:"肌肉骨骼",icon:"&#x1F9B4;"},
  "1.8":{name:"生殖系統",icon:"&#x2640;"},
  "1.9":{name:"泌尿系統",icon:"&#x1F4A7;"},
  "2.1":{name:"一般理學檢查",icon:"&#x1FA7A;"},
  "2.2":{name:"消化道理學檢查",icon:"&#x1F4CB;"},
  "2.3":{name:"心肺理學檢查",icon:"&#x1F3E5;"},
  "2.4":{name:"皮膚理學檢查",icon:"&#x1F52C;"},
  "2.5":{name:"神經理學檢查",icon:"&#x1F9E0;"},
  "2.6":{name:"眼科理學檢查",icon:"&#x1F441;"},
  "2.7":{name:"肌肉骨骼理學檢查",icon:"&#x1F9B4;"},
  "2.8":{name:"泌尿生殖理學檢查",icon:"&#x1F52C;"}
}};

// ======= AGE BIAS DATA (BUG-02) =======
const AGE_BIAS = {
  "Abdominal neoplasia":"senior","Bladder neoplasia":"senior","Bladder neoplasia (TCC)":"senior",
  "Bone neoplasia":"senior","Brainstem neoplasia":"senior","CKD":"senior",
  "Cancer cachexia":"senior","Cardiac arrhythmia":"senior","Cardiac cachexia":"senior",
  "Cardiac disease":"senior","Cataracts":"senior","Cervical/thoracic neoplasia":"senior",
  "Chronic bronchitis":"senior","Chronic kidney disease":"senior","Chronic kidney disease (CKD)":"senior",
  "Colorectal disease (colitis, neoplasia)":"senior","Colorectal neoplasia":"senior",
  "Congenital brain malformation":"juvenile","Congenital heart disease":"juvenile",
  "DCM":"senior","Degenerative myelopathy":"senior","Degenerative myelopathy (CDRM)":"senior",
  "Diabetes mellitus":"senior","GI neoplasia":"senior","Glaucoma":"senior","HCM":"senior",
  "Hip dysplasia":"juvenile","Hyperadrenocorticism":"senior","Hyperadrenocorticism (Cushing's)":"senior",
  "Hypertensive retinopathy":"senior","Hypothyroidism":"senior",
  "Immune-mediated polyarthritis":"senior","Immune-mediated polyarthritis (IMPA)":"senior",
  "Intervertebral disc disease":"senior","Intervertebral disc disease (IVDD)":"senior",
  "Intracranial neoplasia":"senior","Lymphoma":"senior","Metastatic neoplasia":"senior",
  "Nasal neoplasia":"senior","Neoplasia":"senior","Neoplasia (pharyngeal/tonsillar)":"senior",
  "Oesophageal neoplasia":"senior","Oral / pharyngeal neoplasia":"senior","Oral neoplasia":"senior",
  "Osteoarthritis (OA)":"senior","Pancreatitis":"senior",
  "Perianal disease":"senior","Portosystemic shunt (PSS)":"juvenile",
  "Pulmonary neoplasia":"senior","Renal dysplasia":"juvenile","Septic arthritis":"senior",
  "Soft tissue sarcoma":"senior","Spinal neoplasia":"senior","Structural heart disease":"senior",
  "Uterine/vaginal neoplasia":"senior","Juvenile hypoglycaemia":"juvenile",
  "Panosteitis":"juvenile","Vascular ring anomaly (PRAA)":"juvenile",
  "Intestinal parasites":"juvenile","Idiopathic epilepsy":"adult",
  // Sprint 3-2: AGE_BIAS for new-symptoms diseases
  "Idiopathic vestibular disease":"senior","Nasopharyngeal polyp":"juvenile",
  "BOAS":"any","Laryngeal paralysis":"senior","Tracheal collapse":"senior",
  "Mast cell tumour":"senior","Lipoma":"senior","Histiocytoma":"juvenile",
  "Sebaceous gland tumour":"senior","Periodontal disease":"senior",
  "Feline chronic gingivostomatitis":"any","Oral neoplasia":"senior",
  "Renal failure":"senior","Renal failure (uraemic breath)":"senior",
  "DKA":"any","DKA (fruity breath)":"any",
  "Otodectes":"juvenile","Atopic dermatitis":"juvenile",
  "AKI":"any","Acute kidney injury":"any",
  "Methemoglobinaemia":"any","IMHA":"any","IMTP":"any",
  "Anticoagulant rodenticide":"any","Tick-borne disease (Haemoparasites)":"any",
  "Laryngeal oedema":"any","Laryngeal/tracheal neoplasia":"senior",
  "Idiopathic facial paralysis":"senior",
  "Peripheral vestibular disease":"senior","Central vestibular disease":"any",
  "Congenital nystagmus":"juvenile",
  "Pain":"any","Anaemia":"any","Heart failure":"senior",
  "Hyperkalaemia":"any","AV block":"senior","Increased ICP":"any",
  "Hypoalbuminaemia":"any","Right-sided heart failure":"senior",
  "Envenomation":"any","Snake/insect envenomation":"any",
  "Polyneuritis":"any","Neuromuscular disease":"any","PLE":"any"
};

// ======= APP STATE =======
const state = {
  activeSymptom: null,
  speciesFilter: "all",
  ageFilter: "all",
  selectedMultiSymptoms: [],
  selectedLabs: [],
  activeTab: "single",
  searchQuery: "",
  collapsedSections: {},
  sortMode: "category", // "category" | "urgency" | "frequency"
  expandedCards: new Set(),
  recentSymptoms: JSON.parse(sessionStorage.getItem("recentSymptoms") || "[]"),
  searchFocusIdx: -1
};

// ======= HELPERS =======
function resolveSearch(query) {
  const q = query.toLowerCase().trim();
  for (const [slang, medical] of Object.entries(SYNONYMS)) {
    if (q === slang.toLowerCase() || q.includes(slang.toLowerCase())) return medical.toLowerCase();
  }
  return q;
}

const TIER1_KEYWORDS = ["CBC","X光","理學檢查","尿液分析","血糖","電解質","血壓","眼壓","觸診","體溫","PCV","糞便","心電圖","尿比重","BUN","Cre","SDMA","血抹片","ECG","飲食史","用藥史","暴露史","排除","果糖胺","fPLI","cPLI","SNAP","4Dx","乳酸","NT-proBNP","血氣","疼痛評估","神經學檢查","FAST scan","耳鏡","耳垢","口腔檢查","臨床評估","品種評估"];
function isTier1(w) { return TIER1_KEYWORDS.some(k => w.includes(k)); }

const URGENCY_LABELS = {
  emergency: "\u{1F534} 急診 Emergency",
  urgent: "\u{1F7E0} 緊急 Urgent",
  "semi-urgent": "\u{1F7E1} 半緊急",
  "non-urgent": "\u{1F7E2} 非緊急"
};
const URGENCY_ORDER = { emergency: 0, urgent: 1, "semi-urgent": 2, "non-urgent": 3 };
const FREQ_ORDER = { common: 0, uncommon: 1, rare: 2 };

function getAgeBias(d) {
  // Exact match first
  if (AGE_BIAS[d.en]) return AGE_BIAS[d.en];
  // Fuzzy match: check if AGE_BIAS key is contained in d.en or vice versa
  const enLower = d.en.toLowerCase();
  for (const [key, val] of Object.entries(AGE_BIAS)) {
    const keyLower = key.toLowerCase();
    if (enLower.includes(keyLower) || keyLower.includes(enLower)) return val;
  }
  return "any";
}

function countAllDx() {
  let c = 0; DB.symptoms.forEach(s => c += s.differentials.length); return c;
}

function addRecentSymptom(id) {
  state.recentSymptoms = state.recentSymptoms.filter(x => x !== id);
  state.recentSymptoms.unshift(id);
  if (state.recentSymptoms.length > 10) state.recentSymptoms.pop();
  sessionStorage.setItem("recentSymptoms", JSON.stringify(state.recentSymptoms));
}

let _debounceTimer = null;
function debounce(fn, ms) { clearTimeout(_debounceTimer); _debounceTimer = setTimeout(fn, ms); }

// ======= RENDER WELCOME (UX-01) =======
function renderWelcome() {
  const totalDx = countAllDx();
  const el = document.getElementById("welcome");
  const recentHtml = state.recentSymptoms.length > 0 ? `
    <div class="quick-start" style="margin-top:1rem;">
      <h3>\u{1F4D6} 最近查看</h3>
      <div class="quick-links">${state.recentSymptoms.map(id => {
        const s = DB.symptoms.find(x => x.id === id);
        return s ? `<button class="quick-link" onclick="navigateToSymptom('${id}')">${s.zhName}</button>` : "";
      }).join("")}</div>
    </div>` : "";

  el.innerHTML = `
    <div class="icon">\u{1FA7A}</div>
    <h2>選擇臨床症狀開始查詢</h2>
    <p>從左側選單點選症狀，或使用搜尋框輸入關鍵字。<br>支援飼主用語如「拉肚子」「頭歪一邊」「肚子痛」等。</p>
    <div class="welcome-stats">
      <div class="welcome-stat"><span class="num">${DB.symptoms.length}</span><span class="label">臨床症狀</span></div>
      <div class="welcome-stat"><span class="num">${totalDx}</span><span class="label">鑑別診斷</span></div>
      <div class="welcome-stat"><span class="num">${LAB_DB.abnormalities.length}</span><span class="label">實驗室指標</span></div>
    </div>
    <div class="quick-start">
      <h3>\u{26A1} 急診常見症狀</h3>
      <div class="quick-links">
        <button class="quick-link emergency" onclick="navigateToSymptom('dyspnoea')">呼吸困難</button>
        <button class="quick-link emergency" onclick="navigateToSymptom('seizures')">癲癇發作</button>
        <button class="quick-link emergency" onclick="navigateToSymptom('syncope')">昏厥</button>
        <button class="quick-link emergency" onclick="navigateToSymptom('pallor-cyanosis')">蒼白/發紺</button>
        <button class="quick-link" onclick="navigateToSymptom('vomiting')">嘔吐</button>
        <button class="quick-link" onclick="navigateToSymptom('diarrhoea')">腹瀉</button>
        <button class="quick-link" onclick="navigateToSymptom('polyuria-polydipsia')">多尿/多渴</button>
        <button class="quick-link" onclick="navigateToSymptom('skin-pruritus')">搔癢</button>
      </div>
    </div>
    ${recentHtml}
    <div class="quick-start" style="margin-top:1.2rem;padding:0.8rem 1rem;background:var(--card-bg);border-radius:8px;border:1px dashed var(--border);">
      <h3 style="font-size:0.85rem;margin-bottom:0.4rem;">\u{1F4A1} 快速上手</h3>
      <ol style="font-size:0.8rem;color:var(--text-light);margin:0;padding-left:1.2rem;line-height:1.7;">
        <li>從左側選單或搜尋框選擇症狀</li>
        <li>使用物種/年齡篩選縮小範圍，點擊卡片查看建議檢查</li>
        <li>切換「多症狀交叉比對」或「實驗室數據查詢」進行進階分析</li>
      </ol>
    </div>`;
}

// ======= RENDER SIDEBAR (UX-12 animation) =======
function renderSidebar() {
  const sidebar = document.getElementById("sidebar");
  let html = "";
  const sectionMap = {};
  DB.symptoms.forEach(s => {
    if (!sectionMap[s.section]) sectionMap[s.section] = [];
    sectionMap[s.section].push(s);
  });
  for (const sec in sectionMap) {
    const sInfo = DB.sections[sec];
    const collapsed = state.collapsedSections[sec];
    html += `<div class="sidebar-section ${collapsed ? 'collapsed' : ''}" data-sec="${sec}">
      <div class="sidebar-section-title" data-sec="${sec}" role="button" aria-expanded="${!collapsed}" tabindex="0">
        <span class="arrow">\u25B8</span> ${sInfo.icon} ${sec} ${sInfo.name}
        <span class="count">(${sectionMap[sec].length})</span>
      </div>
      <div class="symptom-list-wrap" style="max-height:${collapsed ? '0' : (sectionMap[sec].length * 55) + 'px'};">`;
    sectionMap[sec].forEach(s => {
      html += `<button class="symptom-btn" data-id="${s.id}" role="option" tabindex="0">${s.zhName}<span class="en-name">${s.enName}</span></button>`;
    });
    html += `</div></div>`;
  }
  sidebar.innerHTML = html;

  sidebar.querySelectorAll(".sidebar-section-title").forEach(title => {
    const handler = (e) => {
      if (e.type === "keydown" && e.key !== "Enter" && e.key !== " ") return;
      e.preventDefault(); e.stopPropagation();
      const sec = title.dataset.sec;
      state.collapsedSections[sec] = !state.collapsedSections[sec];
      const section = title.closest(".sidebar-section");
      const wrap = section.querySelector(".symptom-list-wrap");
      section.classList.toggle("collapsed");
      title.setAttribute("aria-expanded", !state.collapsedSections[sec]);
      if (!state.collapsedSections[sec]) {
        wrap.style.maxHeight = wrap.scrollHeight + "px";
      } else {
        wrap.style.maxHeight = "0";
      }
    };
    title.addEventListener("click", handler);
    title.addEventListener("keydown", handler);
  });

  sidebar.querySelectorAll(".symptom-btn").forEach(btn => {
    btn.addEventListener("click", () => handleSidebarClick(btn.dataset.id));
    btn.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); handleSidebarClick(btn.dataset.id); }
    });
  });
}

function handleSidebarClick(id) {
  if (state.activeTab === "single") {
    state.activeSymptom = id;
    // P1-02: Reset filters when switching symptoms via sidebar
    state.speciesFilter = "all"; state.ageFilter = "all"; state.sortMode = "category";
    state.expandedCards.clear();
    addRecentSymptom(id);
    renderSymptomDetail();
    updateSidebarActive();
    updateHash();
  } else if (state.activeTab === "multi") {
    toggleMultiSymptom(id);
  }
  document.getElementById("sidebar").classList.remove("open");
  document.getElementById("sidebarOverlay").classList.remove("active");
}

// UX-02: scrollIntoView
function updateSidebarActive() {
  document.querySelectorAll(".symptom-btn").forEach(b => b.classList.remove("active"));
  if (state.activeSymptom && state.activeTab === "single") {
    const btn = document.querySelector(`.symptom-btn[data-id="${state.activeSymptom}"]`);
    if (btn) {
      btn.classList.add("active");
      const section = btn.closest(".sidebar-section");
      if (section && section.classList.contains("collapsed")) {
        const sec = section.dataset.sec;
        state.collapsedSections[sec] = false;
        section.classList.remove("collapsed");
        const wrap = section.querySelector(".symptom-list-wrap");
        if (wrap) wrap.style.maxHeight = wrap.scrollHeight + "px";
        section.querySelector(".sidebar-section-title").setAttribute("aria-expanded", "true");
      }
      btn.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }
  }
}

// ======= URL HASH ROUTING (UX-15) =======
function updateHash() {
  if (state.activeSymptom) {
    history.replaceState(null, "", `#symptom=${state.activeSymptom}`);
  }
}
function loadFromHash() {
  const hash = location.hash;
  if (hash.startsWith("#symptom=")) {
    const id = hash.replace("#symptom=", "");
    const sym = DB.symptoms.find(s => s.id === id);
    if (sym) { navigateToSymptom(id); return true; }
  }
  return false;
}

// ======= NAVIGATE TO SYMPTOM =======
function navigateToSymptom(id) {
  const sym = DB.symptoms.find(s => s.id === id);
  if (!sym) {
    // Sprint 3-4: Guard for orphan references — friendly message instead of silent failure
    const mc = document.querySelector(".main-content");
    if (mc) {
      const detail = document.getElementById("symptomDetail");
      if (detail) detail.innerHTML = `<div class="welcome" style="margin-top:2rem"><div class="icon">🚧</div><h2>此症狀資料建置中</h2><p>「<strong>${id}</strong>」目前尚未收錄於資料庫中，將在後續版本更新。<br>請嘗試使用搜尋功能找到相近的症狀。</p></div>`;
      document.getElementById("welcome").style.display = "none";
    }
    return;
  }
  state.activeSymptom = id;
  state.activeTab = "single";
  state.speciesFilter = "all"; state.ageFilter = "all"; state.sortMode = "category";
  document.title = sym.zhName + " \u2014 \u5c0f\u52d5\u7269\u9451\u5225\u8a3a\u65b7\u8f14\u52a9\u7cfb\u7d71";
  addRecentSymptom(id);
  document.querySelectorAll(".tab-btn").forEach(b => { b.classList.remove("active"); b.setAttribute("aria-selected","false"); });
  const singleTab = document.querySelector('[data-tab="single"]');
  singleTab.classList.add("active"); singleTab.setAttribute("aria-selected","true");
  document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
  document.getElementById("tab-single").classList.add("active");
  renderSymptomDetail();
  updateSidebarActive();
  updateHash();
  // Scroll main content to top
  const mc = document.querySelector(".main-content");
  if (mc) mc.scrollTop = 0;
  // Clear search
  const input = document.getElementById("globalSearch");
  input.value = ""; state.searchQuery = "";
  document.getElementById("searchHint").classList.remove("visible");
  document.getElementById("searchResults").classList.remove("visible");
  document.getElementById("searchClear").classList.remove("visible");
  resetSidebarFilter();
}

function resetSidebarFilter() {
  document.querySelectorAll(".symptom-btn").forEach(b => b.style.display = "");
}

// ======= RENDER SYMPTOM DETAIL (BUG-01/02, UX-04/05/10/11) =======
function renderSymptomDetail() {
  const symptom = DB.symptoms.find(s => s.id === state.activeSymptom);
  if (!symptom) return;
  document.getElementById("welcome").style.display = "none";
  const container = document.getElementById("symptomDetail");
  container.style.display = "block";

  const totalCount = symptom.differentials.length;
  let filtered = symptom.differentials;

  // Species filter
  if (state.speciesFilter === "dog") filtered = filtered.filter(d => d.species === "dog" || d.species === "both");
  if (state.speciesFilter === "cat") filtered = filtered.filter(d => d.species === "cat" || d.species === "both");

  // BUG-02: Age filter using AGE_BIAS
  if (state.ageFilter !== "all") {
    filtered = filtered.filter(d => {
      const bias = getAgeBias(d);
      return bias === "any" || bias === state.ageFilter;
    });
  }

  // UX-10: Sort mode
  let sortedFiltered = [...filtered];
  if (state.sortMode === "urgency") {
    sortedFiltered.sort((a, b) => (URGENCY_ORDER[a.urgency] ?? 4) - (URGENCY_ORDER[b.urgency] ?? 4));
  } else if (state.sortMode === "frequency") {
    sortedFiltered.sort((a, b) => (FREQ_ORDER[a.freq] ?? 1) - (FREQ_ORDER[b.freq] ?? 1));
  }

  // Group by category or flat list
  const groups = {};
  if (state.sortMode === "category") {
    sortedFiltered.forEach(d => {
      if (!groups[d.category]) groups[d.category] = [];
      groups[d.category].push(d);
    });
  } else if (state.sortMode === "urgency") {
    // P1-05: Group by urgency level for visual context
    sortedFiltered.forEach(d => {
      const uLabel = d.urgency ? (URGENCY_LABELS[d.urgency] || "未分類") : "未標註";
      if (!groups[uLabel]) groups[uLabel] = [];
      groups[uLabel].push(d);
    });
  } else {
    groups["_flat"] = sortedFiltered;
  }

  // Count urgency
  let emergencyCount = filtered.filter(d => d.urgency === "emergency").length;
  let urgentCount = filtered.filter(d => d.urgency === "urgent").length;

  // UX-11: Related symptoms bar with context
  let relatedHtml = "";
  const related = RELATED_SYMPTOMS[symptom.id];
  if (related && related.length > 0) {
    const links = related.map(rid => {
      const rs = DB.symptoms.find(s => s.id === rid);
      return rs ? `<a href="#symptom=${rid}" onclick="event.preventDefault();navigateToSymptom('${rid}')" title="點擊查看「${rs.zhName}」的鑑別診斷" tabindex="0">${rs.zhName}</a>` : "";
    }).filter(Boolean).join(" ");
    if (links) relatedHtml = `<div class="related-bar"><strong>\u{1F4A1} 常見伴隨症狀：</strong>臨床上常與 ${links} 同時出現，建議一併評估。</div>`;
  }

  // UX-05: Dynamic stats with filter info
  let filterDesc = [];
  if (state.speciesFilter !== "all") filterDesc.push(state.speciesFilter === "dog" ? "犬" : "貓");
  if (state.ageFilter !== "all") filterDesc.push(state.ageFilter === "juvenile" ? "<1歲" : state.ageFilter === "adult" ? "1-7歲" : ">7歲");
  const filterNote = filterDesc.length > 0 ? `（篩選：${filterDesc.join("、")}）` : "";
  const statsText = filtered.length < totalCount
    ? `\u{1F4CA} 顯示 ${filtered.length}/${totalCount} 項鑑別診斷${filterNote}`
    : `\u{1F4CA} 共 ${filtered.length} 項鑑別診斷`;

  let html = `
    <div class="symptom-header">
      <h2>${symptom.zhName}</h2>
      <div class="en">${symptom.enName} \u2014 ${symptom.section}</div>
      <div class="description">${symptom.description}</div>
    </div>
    ${relatedHtml}
    <div class="filter-bar">
      <label>物種：</label>
      <button class="filter-chip ${state.speciesFilter==='all'?'active':''}" data-species="all" title="顯示所有物種">全部</button>
      <button class="filter-chip ${state.speciesFilter==='dog'?'active-dog':''}" data-species="dog" title="僅顯示犬好發疾病">\u{1F436} 犬</button>
      <button class="filter-chip ${state.speciesFilter==='cat'?'active-cat':''}" data-species="cat" title="僅顯示貓好發疾病">\u{1F431} 貓</button>
      <div class="filter-divider"></div>
      <label>年齡：</label>
      <button class="filter-chip ${state.ageFilter==='all'?'active':''}" data-age="all" title="顯示所有年齡">全部</button>
      <button class="filter-chip ${state.ageFilter==='juvenile'?'active':''}" data-age="juvenile" title="顯示幼年好發疾病">&lt;1歲</button>
      <button class="filter-chip ${state.ageFilter==='adult'?'active':''}" data-age="adult" title="顯示成年好發疾病">1-7歲</button>
      <button class="filter-chip ${state.ageFilter==='senior'?'active':''}" data-age="senior" title="顯示老年好發疾病">&gt;7歲</button>
      <div class="sort-toggle">
        <button class="sort-btn ${state.sortMode==='category'?'active':''}" data-sort="category" title="按疾病分類分組">分類</button>
        <button class="sort-btn ${state.sortMode==='urgency'?'active':''}" data-sort="urgency" title="按緊急度排序">急度</button>
        <button class="sort-btn ${state.sortMode==='frequency'?'active':''}" data-sort="frequency" title="按常見度排序">頻率</button>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stat-item">${statsText}</div>
      <div class="stat-item">\u{1F3F7} ${Object.keys(groups).length === 1 && "_flat" in groups ? filtered.length + " 項" : Object.keys(groups).length + " 個分類"}${state.sortMode === "urgency" ? "（按緊急度排列）" : state.sortMode === "frequency" ? "（按發生頻率排列）" : ""}</div>
      ${emergencyCount > 0 ? `<div class="stat-item stat-emergency">\u{1F534} ${emergencyCount} 項急診</div>` : ""}
      ${urgentCount > 0 ? `<div class="stat-item" style="color:var(--urgent);">\u{1F7E0} ${urgentCount} 項緊急</div>` : ""}
      <button class="expand-all-btn" id="expandAllBtn" title="展開或收合所有卡片">\u25BC 全部展開</button>
    </div>`;

  if (state.sortMode === "category" || state.sortMode === "urgency") {
    for (const cat in groups) {
      html += `<div class="category-group"><div class="category-title"><span class="cat-icon">\u25CF</span> ${cat}</div>`;
      groups[cat].forEach((d, i) => { html += renderDxCard(d, `${symptom.id}-${cat}-${i}`); });
      html += `</div>`;
    }
  } else {
    groups["_flat"].forEach((d, i) => { html += renderDxCard(d, `${symptom.id}-flat-${i}`); });
  }

  container.innerHTML = html;

  // Event listeners
  container.querySelectorAll(".filter-chip[data-species]").forEach(chip => {
    chip.addEventListener("click", () => { state.speciesFilter = chip.dataset.species; renderSymptomDetail(); });
  });
  container.querySelectorAll(".filter-chip[data-age]").forEach(chip => {
    chip.addEventListener("click", () => { state.ageFilter = chip.dataset.age; renderSymptomDetail(); });
  });
  container.querySelectorAll(".sort-btn").forEach(btn => {
    btn.addEventListener("click", () => { state.sortMode = btn.dataset.sort; renderSymptomDetail(); });
  });
  // UX-04: card expand with state persistence
  container.querySelectorAll(".dx-card").forEach(card => {
    const uid = card.dataset.uid;
    if (state.expandedCards.has(uid)) card.classList.add("expanded");
    card.addEventListener("click", () => {
      card.classList.toggle("expanded");
      if (card.classList.contains("expanded")) state.expandedCards.add(uid);
      else state.expandedCards.delete(uid);
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); card.click(); }
    });
  });
  // Expand all button
  const expandBtn = document.getElementById("expandAllBtn");
  if (expandBtn) {
    expandBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      const cards = container.querySelectorAll(".dx-card");
      const allExpanded = [...cards].every(c => c.classList.contains("expanded"));
      cards.forEach(c => {
        if (allExpanded) { c.classList.remove("expanded"); state.expandedCards.delete(c.dataset.uid); }
        else { c.classList.add("expanded"); state.expandedCards.add(c.dataset.uid); }
      });
      expandBtn.textContent = allExpanded ? "\u25BC 全部展開" : "\u25B2 全部收合";
    });
  }
}

// ======= RENDER DX CARD (BUG-03: tooltips + aria) =======
function renderDxCard(d, uid) {
  const speciesTitle = d.species === "both" ? "犬貓皆可發生" : d.species === "dog" ? "犬好發" : "貓好發";
  const speciesTags = d.species === "both"
    ? `<span class="tag tag-dog" title="犬好發" aria-label="犬">犬</span><span class="tag tag-cat" title="貓好發" aria-label="貓">貓</span>`
    : d.species === "dog" ? `<span class="tag tag-dog" title="犬好發" aria-label="犬">犬</span>` : `<span class="tag tag-cat" title="貓好發" aria-label="貓">貓</span>`;
  const freqLabel = d.freq === "common" ? "常見" : d.freq === "rare" ? "罕見" : "少見";
  const freqTag = `<span class="tag tag-${d.freq}" title="發生頻率：${freqLabel}" aria-label="${freqLabel}">${freqLabel}</span>`;
  const urgencyTag = d.urgency ? `<span class="urgency-badge urgency-${d.urgency}" title="${URGENCY_LABELS[d.urgency]||""}" aria-label="${URGENCY_LABELS[d.urgency]||""}">${URGENCY_LABELS[d.urgency]||""}</span>` : "";

  let detailHtml = `<div class="dx-detail"><div class="dx-detail-section"><strong>\u{1F4DD} 說明</strong>${d.detail}</div>`;
  if (d.workup && d.workup.length) {
    const t1 = d.workup.filter(isTier1);
    const t2 = d.workup.filter(w => !isTier1(w));
    detailHtml += `<div class="dx-detail-section"><strong>\u{1F9EA} 建議檢查</strong>`;
    if (t1.length > 0) {
      detailHtml += `<div class="workup-tier"><span class="workup-tier-label tier1-label">第一線（門診可做）</span><ul>${t1.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;
    }
    if (t2.length > 0) {
      detailHtml += `<div class="workup-tier"><span class="workup-tier-label tier2-label">第二線（需轉診/特殊設備）</span><ul>${t2.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;
    }
    detailHtml += `</div>`;
  }
  detailHtml += `</div>`;

  return `<div class="dx-card freq-${d.freq}${d.urgency ? ' has-urgency-'+d.urgency : ''}" data-uid="${uid}" role="button" tabindex="0" aria-expanded="false" aria-label="${d.zh} (${d.en}) - ${freqLabel} - ${speciesTitle}">
    <div class="dx-card-header">
      <div><div class="dx-name">${d.zh} ${urgencyTag} <span class="dx-expand-icon" aria-hidden="true">\u25BC</span></div><div class="dx-name-en">${d.en}</div></div>
      <div class="dx-tags">${freqTag}${speciesTags}</div>
    </div>${detailHtml}</div>`;
}

// ======= MULTI-SYMPTOM (UX-03: clear all + search) =======
function toggleMultiSymptom(id) {
  const idx = state.selectedMultiSymptoms.indexOf(id);
  if (idx >= 0) state.selectedMultiSymptoms.splice(idx, 1);
  else state.selectedMultiSymptoms.push(id);
  renderMultiSymptomPanel();
  renderMultiResults();
}

function renderMultiSymptomPanel() {
  const container = document.getElementById("selectedSymptoms");
  if (state.selectedMultiSymptoms.length === 0) {
    container.innerHTML = '<span style="color:var(--text-light);font-size:0.85rem;">點擊左側症狀或下方按鈕加入...</span>';
  } else {
    let tagsHtml = state.selectedMultiSymptoms.map(id => {
      const s = DB.symptoms.find(x => x.id === id);
      return `<span class="selected-tag">${s.zhName}<span class="remove" data-id="${id}" title="移除此症狀">&times;</span></span>`;
    }).join("");
    tagsHtml += `<button class="clear-all-btn" id="clearAllMulti" title="清除所有已選症狀">清除全部 (${state.selectedMultiSymptoms.length})</button>`;
    container.innerHTML = tagsHtml;
    container.querySelectorAll(".remove").forEach(btn => {
      btn.addEventListener("click", e => { e.stopPropagation(); toggleMultiSymptom(btn.dataset.id); });
    });
    document.getElementById("clearAllMulti").addEventListener("click", () => {
      state.selectedMultiSymptoms = [];
      renderMultiSymptomPanel();
      renderMultiResults();
    });
  }

  const searchInput = document.getElementById("multiSymptomSearch");
  const filter = (searchInput ? searchInput.value.toLowerCase() : "").trim();

  const btnContainer = document.getElementById("multiSymptomButtons");
  const filtered = filter ? DB.symptoms.filter(s => s.zhName.includes(filter) || s.enName.toLowerCase().includes(filter)) : DB.symptoms;
  // P1-04: Group buttons by section for easier navigation
  const sectionMap = {};
  filtered.forEach(s => {
    if (!sectionMap[s.section]) sectionMap[s.section] = [];
    sectionMap[s.section].push(s);
  });
  let btnsHtml = "";
  for (const sec in sectionMap) {
    const sInfo = DB.sections[sec];
    btnsHtml += `<div class="lab-group-title">${sInfo.icon} ${sInfo.name}</div><div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-bottom:0.5rem;">`;
    sectionMap[sec].forEach(s => {
      const active = state.selectedMultiSymptoms.includes(s.id);
      btnsHtml += `<button class="filter-chip ${active?'active':''}" data-id="${s.id}" title="${s.enName}">${s.zhName}</button>`;
    });
    btnsHtml += `</div>`;
  }
  btnContainer.innerHTML = btnsHtml;
  btnContainer.querySelectorAll(".filter-chip").forEach(btn => {
    btn.addEventListener("click", () => toggleMultiSymptom(btn.dataset.id));
  });
}

function renderMultiResults() {
  const container = document.getElementById("multiResults");
  if (state.selectedMultiSymptoms.length < 2) {
    container.innerHTML = '<p style="color:var(--text-light);text-align:center;padding:2rem;">請選擇至少 2 個症狀以進行交叉比對</p>';
    return;
  }
  const dxMap = {};
  state.selectedMultiSymptoms.forEach(symId => {
    const sym = DB.symptoms.find(s => s.id === symId);
    if (!sym) return;
    sym.differentials.forEach(d => {
      const key = d.en;
      if (!dxMap[key]) dxMap[key] = { ...d, matchCount: 0, matchedSymptoms: [] };
      dxMap[key].matchCount++;
      dxMap[key].matchedSymptoms.push(sym.zhName);
    });
  });
  const results = Object.values(dxMap).filter(d => d.matchCount >= 2).sort((a, b) => {
    if (b.matchCount !== a.matchCount) return b.matchCount - a.matchCount;
    return (URGENCY_ORDER[a.urgency] ?? 4) - (URGENCY_ORDER[b.urgency] ?? 4);
  });
  const total = state.selectedMultiSymptoms.length;
  if (results.length === 0) {
    container.innerHTML = `<p style="color:var(--text-light);text-align:center;padding:2rem;">未找到同時出現在 2 個以上所選症狀中的疾病。<br><span style="font-size:0.82rem;">嘗試減少症狀數量，或使用「單一症狀查詢」分別查看。</span></p>`;
    return;
  }
  let html = `<h4>\u{1F3AF} 交叉比對結果（${results.length} 項符合 \u2265 2 個症狀）</h4>`;
  results.forEach((d, i) => {
    const pct = Math.round((d.matchCount / total) * 100);
    const barW = Math.max(20, pct);
    const urgencyTag = d.urgency ? `<span class="urgency-badge urgency-${d.urgency}">${URGENCY_LABELS[d.urgency]||""}</span>` : "";
    html += `<div class="dx-card freq-${d.freq}" data-uid="multi-${i}" role="button" tabindex="0" aria-expanded="false">
      <div class="dx-card-header"><div>
        <div class="dx-name">${d.zh} ${urgencyTag} <span class="match-score">符合 ${d.matchCount}/${total} (${pct}%)</span><span class="match-bar" style="width:${barW}px;"></span></div>
        <div class="dx-name-en">${d.en}</div>
        <div style="font-size:0.76rem;color:var(--info);margin-top:0.2rem;">相關症狀：${d.matchedSymptoms.join("\u3001")}</div>
      </div><div class="dx-tags">
        ${d.species==="both"?'<span class="tag tag-dog">犬</span><span class="tag tag-cat">貓</span>':d.species==="dog"?'<span class="tag tag-dog">犬</span>':'<span class="tag tag-cat">貓</span>'}
      </div></div>
      <div class="dx-detail"><div class="dx-detail-section"><strong>\u{1F4DD} 說明</strong>${d.detail}</div>
        ${d.workup?(()=>{const t1=d.workup.filter(isTier1),t2=d.workup.filter(w=>!isTier1(w));let wh='<div class="dx-detail-section"><strong>\u{1F9EA} 建議檢查</strong>';if(t1.length>0)wh+=`<div class="workup-tier"><span class="workup-tier-label tier1-label">第一線（門診可做）</span><ul>${t1.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;if(t2.length>0)wh+=`<div class="workup-tier"><span class="workup-tier-label tier2-label">第二線（進階/轉診）</span><ul>${t2.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;return wh+'</div>';})():""}</div></div>`;
  });
  container.innerHTML = html;
  container.querySelectorAll(".dx-card").forEach(card => {
    card.addEventListener("click", () => card.classList.toggle("expanded"));
    card.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); card.click(); } });
  });
}

// ======= LAB TAB =======
function toggleLab(id) {
  const idx = state.selectedLabs.indexOf(id);
  if (idx >= 0) state.selectedLabs.splice(idx, 1);
  else state.selectedLabs.push(id);
  renderLabPanel();
  renderLabResults();
}

function renderLabPanel() {
  const container = document.getElementById("selectedLabs");
  if (state.selectedLabs.length === 0) {
    container.innerHTML = '<span style="color:var(--text-light);font-size:0.85rem;">點擊下方檢驗項目加入...</span>';
  } else {
    let tagsHtml = state.selectedLabs.map(id => {
      const lab = LAB_DB.abnormalities.find(x => x.id === id);
      return `<span class="selected-tag">${lab.zhName}<span class="remove" data-id="${id}" title="移除此檢驗項目">&times;</span></span>`;
    }).join("");
    if (state.selectedLabs.length > 1) {
      tagsHtml += `<button class="clear-all-btn" id="clearAllLabs" title="清除所有已選檢驗">清除全部</button>`;
    }
    container.innerHTML = tagsHtml;
    container.querySelectorAll(".remove").forEach(btn => {
      btn.addEventListener("click", e => { e.stopPropagation(); toggleLab(btn.dataset.id); });
    });
    const clearBtn = document.getElementById("clearAllLabs");
    if (clearBtn) clearBtn.addEventListener("click", () => { state.selectedLabs = []; renderLabPanel(); renderLabResults(); });
  }
  const btnContainer = document.getElementById("labButtons");
  const cats = {};
  LAB_DB.abnormalities.forEach(lab => {
    if (!cats[lab.category]) cats[lab.category] = [];
    cats[lab.category].push(lab);
  });
  let html = "";
  for (const cat in cats) {
    html += `<div class="lab-group-title">${cat}</div><div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-bottom:0.5rem;">`;
    cats[cat].forEach(lab => {
      const active = state.selectedLabs.includes(lab.id);
      html += `<button class="filter-chip ${active?'active':''}" data-labid="${lab.id}" title="${lab.enName}">${lab.zhName}</button>`;
    });
    html += `</div>`;
  }
  btnContainer.innerHTML = html;
  btnContainer.querySelectorAll(".filter-chip").forEach(btn => {
    btn.addEventListener("click", () => toggleLab(btn.dataset.labid));
  });
}

function renderLabResults() {
  const container = document.getElementById("labResults");
  if (state.selectedLabs.length === 0) {
    container.innerHTML = '<p style="color:var(--text-light);text-align:center;padding:2rem;">選擇至少 1 個檢驗異常項目</p>';
    return;
  }
  if (state.selectedLabs.length === 1) {
    const lab = LAB_DB.abnormalities.find(x => x.id === state.selectedLabs[0]);
    let html = `<h4>\u{1F52C} 「${lab.zhName}」(${lab.enName}) 的可能病因</h4>`;
    lab.differentials.forEach((d, i) => { html += renderDxCard(d, `lab-${i}`); });
    container.innerHTML = html;
    container.querySelectorAll(".dx-card").forEach(card => {
      card.addEventListener("click", () => card.classList.toggle("expanded"));
      card.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); card.click(); } });
    });
    return;
  }
  const dxMap = {};
  state.selectedLabs.forEach(labId => {
    const lab = LAB_DB.abnormalities.find(x => x.id === labId);
    if (!lab) return;
    lab.differentials.forEach(d => {
      const key = d.en;
      if (!dxMap[key]) dxMap[key] = { ...d, matchCount: 0, matchedLabs: [] };
      dxMap[key].matchCount++;
      dxMap[key].matchedLabs.push(lab.zhName);
    });
  });
  const results = Object.values(dxMap).sort((a, b) => b.matchCount - a.matchCount);
  const total = state.selectedLabs.length;
  let html = `<h4>\u{1F52C} 實驗室交叉比對結果</h4>`;
  results.forEach((d, i) => {
    const urgencyTag = d.urgency ? `<span class="urgency-badge urgency-${d.urgency}">${URGENCY_LABELS[d.urgency]||""}</span>` : "";
    html += `<div class="dx-card freq-${d.freq}" data-uid="labr-${i}" role="button" tabindex="0" aria-expanded="false">
      <div class="dx-card-header"><div>
        <div class="dx-name">${d.zh} ${urgencyTag} ${d.matchCount>1?`<span class="match-score">符合 ${d.matchCount}/${total} 項異常</span>`:""}</div>
        <div class="dx-name-en">${d.en}</div>
        ${d.matchCount>1?`<div style="font-size:0.76rem;color:var(--info);margin-top:0.2rem;">相關異常：${d.matchedLabs.join("\u3001")}</div>`:""}
      </div><div class="dx-tags">
        ${d.species==="both"?'<span class="tag tag-dog">犬</span><span class="tag tag-cat">貓</span>':d.species==="dog"?'<span class="tag tag-dog">犬</span>':'<span class="tag tag-cat">貓</span>'}
      </div></div>
      <div class="dx-detail"><div class="dx-detail-section"><strong>\u{1F4DD} 說明</strong>${d.detail}</div>
        ${d.workup?(()=>{const t1=d.workup.filter(isTier1),t2=d.workup.filter(w=>!isTier1(w));let wh='<div class="dx-detail-section"><strong>\u{1F9EA} 建議檢查</strong>';if(t1.length>0)wh+=`<div class="workup-tier"><span class="workup-tier-label tier1-label">第一線（門診可做）</span><ul>${t1.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;if(t2.length>0)wh+=`<div class="workup-tier"><span class="workup-tier-label tier2-label">第二線（進階/轉診）</span><ul>${t2.map(w=>`<li>${w}</li>`).join("")}</ul></div>`;return wh+'</div>';})():""}</div></div>`;
  });
  container.innerHTML = html;
  container.querySelectorAll(".dx-card").forEach(card => {
    card.addEventListener("click", () => card.classList.toggle("expanded"));
    card.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); card.click(); } });
  });
}

// ======= TABS =======
function initTabs() {
  const tabBtns = document.querySelectorAll(".tab-btn");
  function activateTab(btn) {
    state.activeTab = btn.dataset.tab;
    tabBtns.forEach(b => { b.classList.remove("active"); b.setAttribute("aria-selected","false"); b.setAttribute("tabindex","-1"); });
    btn.classList.add("active"); btn.setAttribute("aria-selected","true"); btn.setAttribute("tabindex","0"); btn.focus();
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    document.getElementById(`tab-${state.activeTab}`).classList.add("active");
    if (state.activeTab === "multi") { renderMultiSymptomPanel(); renderMultiResults(); }
    if (state.activeTab === "lab") { renderLabPanel(); renderLabResults(); }
    updateSidebarActive();
  }
  tabBtns.forEach(btn => {
    btn.addEventListener("click", () => activateTab(btn));
    btn.addEventListener("keydown", (e) => {
      const tabs = [...tabBtns];
      const idx = tabs.indexOf(btn);
      if (e.key === "ArrowRight" || e.key === "ArrowDown") { e.preventDefault(); activateTab(tabs[(idx + 1) % tabs.length]); }
      if (e.key === "ArrowLeft" || e.key === "ArrowUp") { e.preventDefault(); activateTab(tabs[(idx - 1 + tabs.length) % tabs.length]); }
    });
  });
}

// ======= SEARCH (BUG-01, UX-09: debounce + clear + auto-navigate) =======
function initSearch() {
  const input = document.getElementById("globalSearch");
  const hint = document.getElementById("searchHint");
  const clearBtn = document.getElementById("searchClear");
  const resultsEl = document.getElementById("searchResults");

  clearBtn.addEventListener("click", () => {
    input.value = ""; state.searchQuery = "";
    clearBtn.classList.remove("visible");
    hint.classList.remove("visible");
    resultsEl.classList.remove("visible");
    resetSidebarFilter();
    input.focus();
  });

  input.addEventListener("input", () => {
    debounce(() => {
      state.searchQuery = input.value.trim();
      const resolved = resolveSearch(state.searchQuery);
      const original = state.searchQuery.toLowerCase();

      clearBtn.classList.toggle("visible", !!state.searchQuery);

      if (resolved !== original && state.searchQuery) {
        hint.textContent = `\u{1F4A1} 搜尋「${state.searchQuery}」\u2192 顯示「${resolved}」相關結果`;
        hint.classList.add("visible");
      } else {
        hint.classList.remove("visible");
      }

      const q = resolved || original;
      if (!q) {
        resultsEl.classList.remove("visible");
        resetSidebarFilter();
        return;
      }

      // BUG-01: Find matched symptoms and show dropdown
      const matched = DB.symptoms.filter(sym => {
        return sym.zhName.toLowerCase().includes(q) || sym.enName.toLowerCase().includes(q) ||
          sym.zhName.toLowerCase().includes(original) || sym.enName.toLowerCase().includes(original) ||
          sym.differentials.some(d => d.zh.toLowerCase().includes(q) || d.en.toLowerCase().includes(q) ||
            d.zh.toLowerCase().includes(original) || d.en.toLowerCase().includes(original));
      });

      // Update sidebar filtering
      document.querySelectorAll(".symptom-btn").forEach(btn => {
        const id = btn.dataset.id;
        btn.style.display = matched.some(s => s.id === id) ? "" : "none";
      });

      // BUG-01: Auto-navigate if unique match; else show result list
      if (matched.length === 1) {
        resultsEl.classList.remove("visible");
        navigateToSymptom(matched[0].id);
      } else if (matched.length > 1) {
        state.searchFocusIdx = -1;
        resultsEl.innerHTML = matched.map((s, i) => {
          const dxCount = s.differentials.length;
          return `<div class="search-result-item" data-id="${s.id}" data-idx="${i}" role="option">
            <div><strong>${s.zhName}</strong> <span class="sr-en">${s.enName}</span></div>
            <span class="sr-count">${dxCount} 項鑑別</span>
          </div>`;
        }).join("");
        resultsEl.classList.add("visible");
        resultsEl.querySelectorAll(".search-result-item").forEach(item => {
          item.addEventListener("click", () => { navigateToSymptom(item.dataset.id); });
        });
      } else {
        resultsEl.innerHTML = '<div style="padding:0.8rem;color:var(--text-light);font-size:0.85rem;text-align:center;">未找到相關症狀</div>';
        resultsEl.classList.add("visible");
      }
    }, 200);
  });

  // UX-08: Keyboard nav in search results
  input.addEventListener("keydown", (e) => {
    const items = resultsEl.querySelectorAll(".search-result-item");
    if (!items.length || !resultsEl.classList.contains("visible")) {
      if (e.key === "Escape") {
        input.value = ""; state.searchQuery = "";
        clearBtn.classList.remove("visible");
        hint.classList.remove("visible");
        resultsEl.classList.remove("visible");
        resetSidebarFilter();
      }
      return;
    }
    if (e.key === "ArrowDown") {
      e.preventDefault();
      state.searchFocusIdx = Math.min(state.searchFocusIdx + 1, items.length - 1);
      items.forEach((it, i) => it.classList.toggle("focused", i === state.searchFocusIdx));
      items[state.searchFocusIdx].scrollIntoView({ block: "nearest" });
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      state.searchFocusIdx = Math.max(state.searchFocusIdx - 1, 0);
      items.forEach((it, i) => it.classList.toggle("focused", i === state.searchFocusIdx));
      items[state.searchFocusIdx].scrollIntoView({ block: "nearest" });
    } else if (e.key === "Enter" && state.searchFocusIdx >= 0) {
      e.preventDefault();
      navigateToSymptom(items[state.searchFocusIdx].dataset.id);
    } else if (e.key === "Escape") {
      resultsEl.classList.remove("visible");
      state.searchFocusIdx = -1;
    }
  });

  // Close results when clicking outside
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".search-bar") && !e.target.closest(".search-results")) {
      resultsEl.classList.remove("visible");
    }
  });
}

// ======= MOBILE SIDEBAR =======
function initMobileSidebar() {
  document.getElementById("sidebarToggle").addEventListener("click", () => {
    document.getElementById("sidebar").classList.toggle("open");
    document.getElementById("sidebarOverlay").classList.toggle("active");
  });
  document.getElementById("sidebarOverlay").addEventListener("click", () => {
    document.getElementById("sidebar").classList.remove("open");
    document.getElementById("sidebarOverlay").classList.remove("active");
  });
}

// ======= DARK MODE (UX-16) =======
function initTheme() {
  const toggle = document.getElementById("themeToggle");
  const saved = localStorage.getItem("theme");
  if (saved === "dark") { document.documentElement.setAttribute("data-theme", "dark"); toggle.textContent = "\u2600\uFE0F 淺色模式"; }
  toggle.addEventListener("click", () => {
    const isDark = document.documentElement.getAttribute("data-theme") === "dark";
    if (isDark) {
      document.documentElement.removeAttribute("data-theme");
      localStorage.setItem("theme", "light");
      toggle.textContent = "\u{1F319} 深色模式";
    } else {
      document.documentElement.setAttribute("data-theme", "dark");
      localStorage.setItem("theme", "dark");
      toggle.textContent = "\u2600\uFE0F 淺色模式";
    }
  });
}

// ======= EXPORT (UX-17) =======
function initExport() {
  document.getElementById("exportBtn").addEventListener("click", () => {
    const data = { symptoms: DB.symptoms, labDB: LAB_DB.abnormalities, sections: DB.sections, exportDate: new Date().toISOString() };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "vet-ddx-export.json"; a.click();
    URL.revokeObjectURL(url);
  });
}

// ======= DISCLAIMER (UX-13) =======
function initDisclaimer() {
  const el = document.getElementById("disclaimer");
  const btn = document.getElementById("disclaimerDismiss");
  if (sessionStorage.getItem("disclaimerDismissed")) { el.classList.add("hidden"); }
  btn.addEventListener("click", () => {
    el.classList.add("hidden");
    sessionStorage.setItem("disclaimerDismissed", "1");
  });
}

// ======= MULTI SYMPTOM SEARCH =======
function initMultiSymptomSearch() {
  const input = document.getElementById("multiSymptomSearch");
  input.addEventListener("input", () => { renderMultiSymptomPanel(); });
}

// ======= KEYBOARD NAV (UX-08) =======
function initKeyboardNav() {
  document.addEventListener("keydown", (e) => {
    // ESC to clear/close
    if (e.key === "Escape") {
      const resultsEl = document.getElementById("searchResults");
      if (resultsEl.classList.contains("visible")) {
        resultsEl.classList.remove("visible");
        return;
      }
      // Collapse all expanded cards
      document.querySelectorAll(".dx-card.expanded").forEach(c => c.classList.remove("expanded"));
      state.expandedCards.clear();
    }
    // Ctrl+K or / to focus search
    if ((e.ctrlKey && e.key === "k") || (e.key === "/" && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName))) {
      e.preventDefault();
      document.getElementById("globalSearch").focus();
    }
  });
}

// ======= PRINT (UX-07) =======
function initPrint() {
  document.getElementById("printBtn").addEventListener("click", () => {
    document.body.setAttribute("data-print-date", new Date().toLocaleString("zh-TW"));
    window.print();
  });
}

// ======= INIT =======
document.addEventListener("DOMContentLoaded", () => {
  renderWelcome();
  renderSidebar();
  initTabs();
  initSearch();
  initMobileSidebar();
  initTheme();
  initExport();
  initDisclaimer();
  initMultiSymptomSearch();
  initKeyboardNav();
  initPrint();
  renderMultiSymptomPanel();
  renderLabPanel();
  // UX-15: Load from hash
  if (!loadFromHash()) { renderWelcome(); }
});
</script>
</body>
</html>
